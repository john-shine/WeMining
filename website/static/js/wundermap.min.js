var wundermap;(function(a){wundermap={map:null,options:{iconsdomain:"http://icons.wxug.com",units:"english",brand:null,RadSatSync:true,StreetsOverlay:false,moveToTop:false,infobox:{disableAutoPan:false,position:null},timezone:{"short":"UTC","long":"UTC",offset:{text:"+0000",hours:0}}},layers:{},date:null,date_is_changed:false,locked_:false,utils:{},selmarker:null,imageFormat:"png",firstIdle:false,classNames:{timelordWarning:"timelord-warning",timelordAware:"timelord-aware"}};wundermap.setOptions=function(c){a.extend(true,wundermap.options,c);wundermap.map=wundermap.options.map};wundermap.getMapTypeId=function(d){var c={map:google.maps.MapTypeId.ROADMAP,sat:google.maps.MapTypeId.SATELLITE,hyb:google.maps.MapTypeId.HYBRID,ter:google.maps.MapTypeId.TERRAIN,wui:"wumaps"};return c[d]||d};wundermap.getMapTypes=function(d){var f=[];for(var e in google.maps.MapTypeId){f.push(google.maps.MapTypeId[e])}var c=["polarnavy_vector","polarnavy_raster"];if(d=="google"){return f}else{if(d=="wund"){return c}else{return f.concat(c)}}};wundermap.addMapTypes=function(d){d.mapTypes.set("polarnavy_vector",new google.maps.ImageMapType({getTileUrl:function(g,e){var f=g.x%(1<<e);return"http://timelord.wunderground.com/basemaps/marine/vector/m"+e+"/XG"+f+"/YG"+g.y+".png"},tileSize:new google.maps.Size(256,256),maxZoom:15,name:"PolarNavyVector",alt:"PolarNavy (Vector)"}));d.mapTypes.set("polarnavy_raster",new google.maps.ImageMapType({getTileUrl:function(g,e){var f=g.x%(1<<e);return"http://timelord.wunderground.com/basemaps/marine/raster/m"+e+"/XG"+f+"/YG"+g.y+".png"},tileSize:new google.maps.Size(256,256),maxZoom:15,name:"PolarNavyRaster",alt:"PolarNavy (Raster)"}));var c=a("<div>Map data &copy; Polar Navy</div>");wundermap.addHTMLControl({container:c,position:google.maps.ControlPosition.BOTTOM_RIGHT,styles:{display:"none",margin:"5px",width:"auto"}});google.maps.event.addListener(d,"maptypeid_changed",function(){var e=d.getMapTypeId();if(wui.arrayContains(e,["polarnavy_vector","polarnavy_raster"])){c.show()}else{c.hide()}})};wundermap.initialize=function(){if(this.options.debug==1){wui.log("wundermap.initialize")}if(this.options.customMapTypes){this.addMapTypes(this.map)}if(this.options.datepicker){this.timelord.initialize()}var n={name:"wundermap",sidebarPrefix:"wundermap"};var k={fn_getStaticURL:function(){return wundermap.options.iconsdomain+"/graphics/clear.gif"}};var d=new wundermap.ImageLayer(this.map,n,k,0);d.setMap(this.map);var h=0;for(var e=0;e<this.options.layers.length;e++){var l=this.options.layers[e];var c=l.active||0;var g=this.layers[l.layer];if(!g){wui.log("Error: layer is undefined: "+l.layer);continue}g.initialize(this.map,l);if(wundermap.utils.isCheckedValue(c)){if(!g.elt_radio[0]){g.toggle(true)}else{if(h<1){h++;g.toggle(true)}else{g.setRadioButton(false)}}}else{g.setCheckbox(false);g.setRadioButton(false)}}if(this.options.RadSatSync===true){this.RadSatSync.initialize()}this.setupAccordion();for(var f in this.layers){var g=this.layers[f];if(g.active_){g.elt_titleBar.trigger("click")}}this.search.initialize("#mapSearchForm","#mapSearchBox","#mapFavorites");var m=this;google.maps.event.addListener(this,"infowindowopen",function(){m.locked_=true});google.maps.event.addListener(this,"infowindowclose",function(){m.locked_=false});google.maps.event.addListener(this.map,"idle",function(){wundermap.firstIdle=true;var o={eventname:"idle"};if(m.options.debug==1){wui.log("google Event: idle")}if(m.locked_===true){m.locked_=false}else{m.refresh(o);m.closeInfoBox()}});if(this.options.linkToThisPage){google.maps.event.addListener(this.map,"idle",function(){m.makeLinkToThisPage()});google.maps.event.addListener(this.map,"maptypeid_changed",function(){m.makeLinkToThisPage()});google.maps.event.addListener(wundermap,"layertoggled",function(p,o){m.makeLinkToThisPage()});google.maps.event.addListener(wundermap,"datepicker_changed",function(o,p){m.makeLinkToThisPage()});google.maps.event.addListener(wundermap,"settings_changed",function(o){m.makeLinkToThisPage()});m.makeLinkToThisPage();if(this.options.linkToThisPage.panel){this.setupLinkToThisPagePanel()}}if(this.options.linkToSavePrefs){a(this.options.linkToSavePrefs.button).click(function(o){o.preventDefault();m.savePreferences()})}if(this.options.linkToSettings&&this.options.linkToSettings.panel){this.setupLinkToSettingsPanel()}if(this.options.logo!==false){this.addLogoControl(this.options.logo)}if(this.options.continentControls){this.addControlsZoomContinent(this.options.continentControls)}if(this.options.zoomQuickControls){this.addControlsZoomQuick(this.options.zoomQuickControls)}if(this.options.StreetsOverlay){this.StreetsOverlay.initialize()}if(this.options.fullScreen){wundermap.setupFullScreen()}if(a("#map_panel_button")[0]){this.addHTMLControl({controlText:"",index:-1,position:google.maps.ControlPosition.TOP_RIGHT,styles:{width:"30px"}})}if(a.browser.msie&&b(a.browser.version.charAt(0))<7){this.imageFormat="gif"}this.showPin();this.hacksHacks();google.maps.event.trigger(this,"load")};wundermap.hacksHacks=function(){a(".slider_bg .slider_knob").remove()};wundermap.refresh=function(e){this.imagemap_container.refresh(e);for(var c in this.layers){var d=this.layers[c];if(d.active_){d.refresh(e)}}};wundermap.resize=function(){google.maps.event.trigger(wundermap.map,"resize")};wundermap.getLinkToThisPage=function(d){var c="?"+this.toQueryString(d);return c};wundermap.makeLinkToThisPage=function(){var e=this.options.linkToThisPage;if(!e){return}var d=this.getLinkToThisPage();if(e.rawlink){a(e.rawlink).attr("href",d);if(e.rawlink_input){var c=(a(e.rawlink)[0])?a(e.rawlink)[0].href:"";a(e.rawlink_input).val(c)}}return d};wundermap.setupLinkToThisPagePanel=function(){var g=this.options.linkToThisPage;if(!g){return}var f=a(g.rawlink);var c=a(g.panel.shortlink);var e=a(g.panel.shortlink_input);var h=a(g.panel.button);var d=a(g.panel.panel);var l=a(g.panel.fb_share);var k=g.panel.buttonActiveClass;if(!f[0]||!c[0]||!h[0]||!d[0]){return}h.click(function(o){d.toggleClass("none");if(d.hasClass("none")){if(k){h.removeClass(k)}return}else{if(k){h.addClass(k)}}var n=f[0].href;if(!n||n.length<1){return}var m="/miniurl/api.php?url="+encodeURIComponent(n);c.attr("href","javascript:void(0)");e.val("");a.ajax({url:m,success:function(q,p){c.attr("href",q);e.val(q);l.attr("href","http://www.facebook.com/sharer.php?u="+encodeURIComponent(q)+"&t="+encodeURIComponent(document.title))},error:function(){wui.log("Ajax MiniURL failed")}})})};wundermap.setupLinkToSettingsPanel=function(){var d=this.options.linkToSettings;if(!d){return}var e=a(d.panel.button);var c=a(d.panel.panel);var f=d.panel.buttonActiveClass;if(!e[0]||!c[0]){return}e.click(function(g){c.toggleClass("none");if(c.hasClass("none")){if(f){e.removeClass(f)}}else{if(f){e.addClass(f)}}})};wundermap.setupFullScreen=function(){var c=this.options.fullScreen;if(!c){return}var d=a(c.button);var e=a(c.content);var g=c.buttonActiveClass;d.bind("click",function(h){if(!wui.fullscreen.supported){wui.log("Sorry, your browser does not support full screen mode")}else{if(wui.fullscreen.active){wui.fullscreen.exit()}else{wui.fullscreen.enter(e[0])}}});a(document).bind("fullscreenchange mozfullscreenchange webkitfullscreenchange",function(){f()});function f(){if(wui.fullscreen.active){if(g){d.addClass(g)}}else{if(g){d.removeClass(g)}}}};wundermap.getPrefs=function(e){var e=a.extend(true,{},{exclude:null,only:null,type:""},e);var g=false;var f=this.map;var h={lat:f.getCenter().lat().toFixed(5),lon:f.getCenter().lng().toFixed(5),zoom:f.getZoom(),type:f.getMapTypeId()};if(this.top){var d=this.layers[this.top];if(d&&d.active_){h.top=this.top}}if(this.options.datepicker&&this.date_is_changed){h.date=a("#map_datepicker_date").val();h.time=a("#map_datepicker_time").val()}if(e.type!="prefscookie"){h.units=(this.options.units=="metric")?"metric":"english";if(this.search&&this.search.marker){var c=this.search.marker.getPosition();if(f.getBounds().contains(c)){h.pin=this.search.title;h.plat=c.lat().toFixed(5);h.plon=c.lng().toFixed(5);g=true}}if(!g&&this.options.pin&&this.options.pin.title){var c=new google.maps.LatLng(this.options.pin.lat,this.options.pin.lon);if(f.getBounds()&&f.getBounds().contains(c)){h.pin=this.options.pin.title;h.plat=this.options.pin.lat;h.plon=this.options.pin.lon;g=true}}}if(e.only&&a.isArray(e.only)){a.each(h,function(k,l){if(!wui.arrayContains(k,e.only)){delete h[k]}})}if(e.exclude&&a.isArray(e.exclude)){a.each(h,function(k,l){if(wui.arrayContains(k,e.exclude)){delete h[k]}})}return h};wundermap.toQueryString=function(g){var g=a.extend(true,{},{exclude:null,only:null,type:"querystring"},g);var k=this.getPrefs(g);var c=[];var h=true;if(g.only&&a.isArray(g.only)&&!wui.arrayContains("layers",g.only)){h=false}if(g.exclude&&a.isArray(g.exclude)&&wui.arrayContains("layers",g.exclude)){h=false}if(h){for(var e in this.layers){var f=this.layers[e];if(f.initialized_===true){c.push(f.toQueryString())}}}var d=a.param(k);if(c.length>0){d+="&"+c.join("&")}return d};wundermap.toPrefsObject=function(d){var d=a.extend(true,{},{exclude:null,only:null,prefix:"GMAP",type:"prefscookie"},d);var f={};var l=this.getPrefs(d);var c=true;if(d.only&&a.isArray(d.only)&&!wui.arrayContains("layers",d.only)){c=false}if(d.exclude&&a.isArray(d.exclude)&&wui.arrayContains("layers",d.exclude)){c=false}if(c){for(var h in this.layers){var g=this.layers[h];if(g.initialized_===true){a.extend(l,g.toPrefsObject())}}}for(var m in l){var k=m.toUpperCase().replace(".","");var e=l[m];if(e===true){e=1}if(e===false){e=0}if(e!==null){f[d.prefix+k]=e}}return f};wundermap.savePreferences=function(h){var f=this.options.linkToSavePrefs||{};var k=f.loadingClass||"ajax-loading";var g={};var d=this.toPrefsObject(h);var e=0;for(var c in d){g["setprefs."+e+".key"]=c;g["setprefs."+e+".val"]=d[c];e++}a(f.button).addClass(k);a.ajax({url:"/auto/wui/geo/PrefDump/index.html",type:"POST",data:g,dataType:"html",success:function(m,l,n){a(f.button).removeClass(k)},error:function(n,l,m){a(f.button).removeClass(k);wui.log("Error: failed to save wundermap preferences")}})};wundermap.showPin=function(){var e=this.options.pin;if(e&&e.title){var c=new google.maps.LatLng(e.lat,e.lon);var d=new google.maps.Marker({clickable:true,map:wundermap.map,position:c,title:e.title});google.maps.event.addListener(d,"click",function(h){var g=this.getPosition().lat().toFixed(4);var k=this.getPosition().lng().toFixed(4);var f=wundermap.getBalloonContentPin(e);wundermap.openInfoBox({content:f,marker:this})})}};wundermap.getBalloonContentPin=function(d){var c='<div class="PinBalloon">';if(d.type=="earthquake"){c+='<div class="infobox-title">Earthquake</div>'}else{c+='<div class="infobox-title">Information</div>'}c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">'+d.title+"</div>";c+='<div class="p10"><a href="/cgi-bin/findweather/hdfForecast?query='+d.lat+","+d.lon+'">View Conditions</a></div>';c+="</div>";return c};wundermap.showMapSize=function(){};wundermap.setupAccordion=function(){var c=this.options.accordionSpeed||"slow";var d=a(".accordion-header");d.click(function(k){var m=a(this);var h=m.next(".accordion-content");var f="accordion-header-selected";var g=a(k.target).is("input[type=checkbox]");var l=(g&&k.target.checked);if(g&&l){m.addClass(f);h.slideDown(c)}else{if(g&&!l){m.removeClass(f);h.slideUp(c)}else{if(m.hasClass(f)){m.removeClass(f);h.slideUp(c)}else{m.addClass(f);h.slideDown(c)}}}});d.mouseenter(function(f){a(this).addClass("accordion-header-hover")}).mouseleave(function(f){a(this).removeClass("accordion-header-hover")})};wundermap.getActiveLayers=function(){var e=[];for(var c in this.layers){var d=this.layers[c];if(d.active_){e.push(d)}}return e};wundermap.isActiveLayer=function(c){return(this.layers[c]&&this.layers[c].active_)?true:false};wundermap.timelord=function(){};wundermap.timelord.initialize=function(){this.elt_container=a("#map_datepicker");this.elt_slider=a("#map_datepicker_jog_control");this.elt_date=a("#map_datepicker_date");this.elt_time=a("#map_datepicker_time");this.elt_cal_btn=a("#map_datepicker_cal");this.elt_pretty=a("#map_datepicker_pretty");this.elt_incrementors_container=this.elt_container.find(".cal-incrementors");this.elt_incrementors=this.elt_container.find(".cal-incrementors a");var g={"cal-year-minus":function(k){k.setFullYear(k.getFullYear()-1)},"cal-month-minus":function(k){k.setMonth(k.getMonth()-1)},"cal-day-minus":function(k){k.setDate(k.getDate()-1)},"cal-hour-minus":function(k){k.setHours(k.getHours()-1)},"cal-now":function(k){k.setTime((new Date()).getTime())},"cal-hour-plus":function(k){k.setHours(k.getHours()+1)},"cal-day-plus":function(k){k.setDate(k.getDate()+1)},"cal-month-plus":function(k){k.setMonth(k.getMonth()+1)},"cal-year-plus":function(k){k.setFullYear(k.getFullYear()+1)}};var h=null;var d=1000;var c=wundermap.options.datepicker.date;var f=wundermap.options.datepicker.time||"00:00:00";var e=c.replace(/-/gi,"/")+" "+f+" GMT";wundermap.date=new Date(e);wundermap.userdate=this.getDateInUserTime(wundermap.date);this.displayDate(wundermap.date);if(wundermap.options.datepicker.is_changed=="1"){wundermap.date_is_changed=true}this.elt_incrementors.click(function(m){var k=a(this).attr("data-cal-increment");var n=new Date(wundermap.date.getTime());var l=g[k];if(l){l(n);wundermap.date.setTime(n.getTime());wundermap.timelord.displayDate(wundermap.date);wundermap.timelord.saveDate(wundermap.date)}if(k=="cal-now"){wundermap.timelord.handleNow()}return false});this.elt_container.mouseenter(function(){wundermap.timelord.show()}).mouseleave(function(){wundermap.timelord.hide()});this.elt_date.datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,onSelect:function(m,k){var l=a(this).datepicker("getDate");wundermap.date.setUTCFullYear(l.getFullYear());wundermap.date.setUTCMonth(l.getMonth());wundermap.date.setUTCDate(l.getDate());wundermap.timelord.displayDate(wundermap.date);wundermap.timelord.saveDate(wundermap.date)}});this.elt_date.datepicker("hide");this.elt_cal_btn.click(function(k){wundermap.timelord.elt_date.datepicker("show")})};wundermap.timelord.getDateInUserTime=function(c){var e=new Date(c.getTime());e.setUTCHours(e.getUTCHours()+wundermap.options.timezone.offset.hours);return e};wundermap.timelord.saveDate=function(c){var e=this.getDateInUserTime(c);wundermap.date.setTime(c.getTime());wundermap.userdate.setTime(e.getTime());wundermap.date_is_changed=true;google.maps.event.trigger(wundermap,"datepicker_changed",wundermap.date,wundermap.userdate)};wundermap.timelord.displayDate=function(h){var c=wui.date.strftime("%Y-%m-%d",h,true);var g=wui.date.strftime("%H:00",h,true);wundermap.timelord.elt_date.val(c);wundermap.timelord.elt_time.val(g);wundermap.timelord.elt_pretty.text(h.toUTCString());var k=this.getDateInUserTime(h);var e=wundermap.options.timezone["long"]+" (GMT"+wundermap.options.timezone.offset.text+")";var f=wui.date.strftime("%a, %d %b %Y, %H:%M ",k,true)+'<span title="'+e+'">'+wundermap.options.timezone["short"]+"</span>";wundermap.timelord.elt_pretty.attr("title",h.toUTCString());wundermap.timelord.elt_pretty.html(f)};wundermap.timelord.set=function(c){if(a.type(c)=="date"){var c=c}else{if(a.type(c)=="number"){var c=new Date(c*1000)}else{if(a.type(c)=="string"){var c=new Date(c)}else{wui.log("Error: invalid argument to timelord.set");return}}}wundermap.timelord.displayDate(c);wundermap.timelord.saveDate(c)};wundermap.timelord.get=function(){return wundermap.date};wundermap.timelord.handleNow=function(){wundermap.date_is_changed=false};wundermap.timelord.show=function(){this.elt_incrementors_container.stop().show()};wundermap.timelord.hide=function(){this.elt_incrementors_container.delay(800).hide(0)};wundermap.timelord.showMe=function(){this.elt_incrementors_container.toggle()};wundermap.timelord.getTooltipButton=function(c){return a('<span class="hasTimelord"></span>')};wundermap.timelord.getTooltipContent=function(e,d){var c="<div>Time control is available for this layer.";if(e.text){c+="You can select a date in this range:<br />"+e.text}c+='<br /><a href="javascript:void(0);" onclick="wundermap.timelord.showMe();">show me</a>';c+="</div>";return c};wundermap.StreetsOverlay={imageMapType:null,initialize:function(){this.imageMapType=new google.maps.ImageMapType({getTileUrl:function(c,d){var e=c.x%(1<<d);return"http://mt0.google.com/vt/v=apt.116&x="+e+"&y="+c.y+"&z="+d+"&s=G&lyrs=h"},tileSize:new google.maps.Size(256,256),isPng:false,maxZoom:20,name:"lyrs=h"});google.maps.event.addListener(wundermap.map,"maptypeid_changed",function(){wundermap.StreetsOverlay.refresh()});google.maps.event.addListener(wundermap,"imagelayer_moved",function(){wundermap.StreetsOverlay.refresh()});this.refresh()},hide:function(){wundermap.utils.removeOverlayMapTypeByName("lyrs=h")},show:function(){if(this.imageMapType){wundermap.map.overlayMapTypes.insertAt(0,this.imageMapType)}},refresh:function(){this.hide();var c=wundermap.map.getMapTypeId();if(c==google.maps.MapTypeId.HYBRID){this.show()}}};wundermap.setHighlight=function(c){if(!this.selmarker&&c){this.selmarker=new google.maps.Marker({clickable:false,flat:true,icon:new google.maps.MarkerImage("http://stationicon.wunderground.com/gmapselected.png",new google.maps.Size(64,64),null,new google.maps.Point(32,32)),map:wundermap.map,optimized:false,position:c})}else{if(c){this.selmarker.setPosition(c);this.selmarker.setVisible(true)}else{if(this.selmarker){this.selmarker.setVisible(false)}}}};wundermap.zoomIn=function(){var d=this.map.getZoom();if(wundermap.infobox){var c=wundermap.infobox.getPosition();this.closeInfoBox();this.map.setOptions({center:c,zoom:d+1})}else{this.map.setZoom(d+1)}};wundermap.zoomTo=function(e,f,d){var c=new google.maps.LatLng(e,f);this.closeInfoBox();this.map.setOptions({center:c,zoom:d})};wundermap.addControlToMap=function(c){var d=c.controlPosition;if(!d){return}wundermap.map.controls[d].push(c.container)};wundermap.addHTMLControl=function(e){var d=e.container;if(!d||!d[0]){d=a("<div></div>")}if(e.controlClass){d.addClass(e.controlClass)}if(e.controlText){d.html(e.controlText)}if(e.printable===false){d.addClass("noPrint")}if(e.styles){d.css(e.styles)}if(e.image){var f=e.title||"";d.html('<img src="'+e.image+'" alt="" title="'+f+'" />')}if(e.eventType){d.bind(e.eventType,e.eventFunction)}if(wui.defined(e.index)){d[0].index=e.index}var c=e.position||google.maps.ControlPosition.LEFT_BOTTOM;this.addControlToMap({container:d[0],controlPosition:c})};wundermap.addControlsZoomContinent=function(d){var c=d.geoIp;d.eventType="click";d.controlClass="mapQuickJumpDefault";d.printable=false;if(c){d.controlText="Zoom to Home";d.eventFunction=function(){var e=new google.maps.LatLng(c.lat,c.lon);wundermap.map.setCenter(e);wundermap.map.setZoom(8)};this.addHTMLControl(d)}d.controlText="Zoom to U.S.";d.eventFunction=function(){var e=new google.maps.LatLng(39.2322531,-96.1523437);wundermap.map.setCenter(e);wundermap.map.setZoom(4)};this.addHTMLControl(d);d.controlText="Zoom to Europe";d.eventFunction=function(){var e=new google.maps.LatLng(51.8357775,12.65625);wundermap.map.setCenter(e);wundermap.map.setZoom(4)};this.addHTMLControl(d)};wundermap.addControlsZoomQuick=function(e){var e=a.extend({},{controlClass:null,controlButtonClass:"mapQuickJumpDefault",controlButtonClassActive:"mapQuickJumpActive",eventType:null,index:1,position:google.maps.ControlPosition.TOP_LEFT,printable:false,styles:{marginTop:"5px"}},e);var d=a("<div></div>");var f=a("<div>Local</div>").addClass(e.controlButtonClass).bind("click",function(k){wundermap.map.setZoom(10)});var h=a("<div>Region</div>").addClass(e.controlButtonClass).bind("click",function(k){wundermap.map.setZoom(7)});var g=a("<div>Continent</div>").addClass(e.controlButtonClass).bind("click",function(k){wundermap.map.setZoom(4)});d.append(f,h,g);e.container=d;this.addHTMLControl(e);var c=function(){var k=wundermap.map.getZoom();f.removeClass(e.controlButtonClassActive);h.removeClass(e.controlButtonClassActive);g.removeClass(e.controlButtonClassActive);if(k==10){f.addClass(e.controlButtonClassActive)}else{if(k==7){h.addClass(e.controlButtonClassActive)}else{if(k==4){g.addClass(e.controlButtonClassActive)}}}};c();google.maps.event.addListener(wundermap.map,"zoom_changed",c)};wundermap.addLogoControl=function(c){var c=a.extend(true,{},{image:wundermap.options.iconsdomain+"/i/wu_small.gif",position:google.maps.ControlPosition.RIGHT_BOTTOM,styles:{margin:"0 4px -2px 0"},title:"Weather layers powered by Weather Underground, Inc.",eventType:"dblclick",eventFunction:function(d){window.location="http://www.wunderground.com/cgi-bin/findweather/hdfForecast?query="+wundermap.map.getCenter().toUrlValue()}},c);this.addHTMLControl(c)};wundermap.RadSatSync={};wundermap.RadSatSync.initialize=function(){var c=wundermap.layers.Radar;var e=wundermap.layers.Satellite;var d=c.className;var f=e.className;google.maps.event.addListener(wundermap,"layertoggled",function(h,g){if(h!=d&&h!=f){return}if(h==d&&e.active_){e.refresh()}else{if(h==f&&c.active_){c.refresh()}}wundermap.RadSatSync.checkSyncedSidebarContent()});google.maps.event.addListener(wundermap,"datepicker_changed",function(g,h){wundermap.RadSatSync.checkSyncedSidebarContent()});google.maps.event.addListener(e,"settings_changed",function(){if(wundermap.RadSatSync.isSynced()){c.refresh()}});wundermap.RadSatSync.checkSyncedSidebarContent()};wundermap.RadSatSync.isSynced=function(){var c=wundermap.layers.Radar;var d=wundermap.layers.Satellite;var h=false;var e=new Date();var g=new Date(e.getTime()-1800*1000);var f=new Date(e.getTime()+3600*1000);if((wundermap.options.RadSatSync===true)&&(!wundermap.date||(wundermap.date>g&&wundermap.date<f))&&(d&&d.active_&&!d.disabled_&&!d.disabled_by_timelord_)&&(c&&c.active_&&!c.disabled_&&!c.disabled_by_timelord_)){h=true}return h};wundermap.RadSatSync.checkSyncedSidebarContent=function(){var f=wundermap.RadSatSync.isSynced();var e=[wundermap.layers.Radar,wundermap.layers.Satellite];for(var d=0;d<e.length;d++){var c=e[d];if(f){c.findId("hideWhenSynced").addClass("none");c.findId("showWhenSynced").removeClass("none")}else{c.findId("hideWhenSynced").removeClass("none");c.findId("showWhenSynced").addClass("none")}}};wundermap.utils.deg2rad=function(c){return c*(Math.PI/180)};wundermap.utils.limit=function(e,d,c){return Math.min(c,Math.max(d,e))};wundermap.utils.atoi=function(c){return parseInt(c,10)};var b=wundermap.utils.atoi;wundermap.utils.cleanDate=function(c){if(c.match(/\./)){return c.replace(/\./g,"-")}else{if(c.match(/\//g)){return c.replace(/\//g,"-")}}return c};wundermap.utils.splitDate=function(e,c){if(!c){c="-"}var f=e.split(c);f[0]=parseInt(f[0],10);f[1]=parseInt(f[1],10);if(f[2]){parseInt(f[2],10)}return f};wundermap.utils.removeOverlayMapTypeByName=function(e){var h=[];var g=wundermap.map.overlayMapTypes;var d=g.getLength();for(var f=d-1;f>=0;f--){var c=g.getAt(f);if(c.name==e){h.push(g.removeAt(f))}}return h};wundermap.utils.indexOfClosest=function(d,k){var c=d.length;if(c==0){return -1}if(c==1){return 0}var e=0;var g=Math.abs(d[0]-k);for(var f=1;f<c;f++){var h=Math.abs(d[f]-k);if(h<g){e=f;g=h}}return e};wundermap.utils.hasTimelordWarning=function(c){var d=!!(c.parents("."+wundermap.classNames.timelordWarning).length>0);return d};wundermap.utils.latLonDistKM=function(m,k){if(!m||!k){return 0}var h=6371;var f=(k.lat()-m.lat())*Math.PI/180;var g=(k.lng()-m.lng())*Math.PI/180;var e=Math.sin(f/2)*Math.sin(f/2)+Math.cos(m.lat()*Math.PI/180)*Math.cos(k.lat()*Math.PI/180)*Math.sin(g/2)*Math.sin(g/2);var n=2*Math.atan2(Math.sqrt(e),Math.sqrt(1-e));var l=h*n;return l};wundermap.utils.isCheckedValue=function(c){return(c===true||c=="on"||c=="1"||c===1)};wundermap.utils.isValidMeasurement=function(c){if(c===null){return false}else{if(typeof(c)=="undefined"){return false}else{if(c=="-999"){return false}else{if(c=="-9999"){return false}else{if(parseFloat(c)<=-999){return false}else{return true}}}}}};wundermap.utils.lookupWindString=function(c){if(c>360){c=c%360}if(c>=0&&c<11.25){return"N"}if(c>=11.25&&c<33.75){return"NNE"}if(c>=33.75&&c<67.5){return"NE"}if(c>=67.5&&c<78.75){return"ENE"}if(c>=78.75&&c<101.25){return"E"}if(c>=101.25&&c<123.75){return"ESE"}if(c>=123.75&&c<146.25){return"SE"}if(c>=146.25&&c<168.75){return"SSE"}if(c>=168.75&&c<191.25){return"S"}if(c>=191.25&&c<213.75){return"SSW"}if(c>=213.75&&c<236.25){return"SW"}if(c>=236.25&&c<258.75){return"WSW"}if(c>=258.75&&c<281.25){return"W"}if(c>=281.25&&c<303.75){return"WNW"}if(c>=303.75&&c<326.25){return"NW"}if(c>=326.25&&c<348.75){return"NNW"}if(c>=348.75){return"N"}return"-"};wundermap.utils.convertMonthStringToInt=function(c){if(c=="Jan"){return 1}if(c=="Feb"){return 2}if(c=="Mar"){return 3}if(c=="Apr"){return 4}if(c=="May"){return 5}if(c=="Jun"){return 6}if(c=="Jul"){return 7}if(c=="Aug"){return 8}if(c=="Sep"){return 9}if(c=="Oct"){return 10}if(c=="Nov"){return 11}if(c=="Dec"){return 12}return 0};wundermap.utils.convertTempIntoUnits=function(e,d,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(d)){return"-"}if(e=="metric"){return((d-32)/1.8).toFixed(c)}else{return(d-0).toFixed(c)}};wundermap.utils.getTempUnits=function(c){if(c=="metric"){return"C"}else{return"F"}};wundermap.utils.convertHeightIntoUnits=function(e,c,d){if(!d){d=0}if(!wundermap.utils.isValidMeasurement(c)){return"-"}if(e=="metric"){return((c*12*2.54/100)).toFixed(d)}else{return c}};wundermap.utils.getHeightUnits=function(c){if(c=="metric"){return"m"}else{return"ft"}};wundermap.utils.convertWindIntoUnits=function(e,g,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(g)){return"-"}var d=g/2.237;var f=d*3.6;if(e=="metric"){return(f).toFixed(c)}else{return parseFloat(g).toFixed(c)}};wundermap.utils.getWindUnits=function(c){if(c=="metric"){return"km/h"}else{return"mph"}};wundermap.utils.knotsToMph=function(e,f,c){if(!c){c=0}var d=f*1.15078;return d.toFixed(c)};wundermap.utils.convertKnotsIntoWindString=function(e,g,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(g)){return"-"}if(e=="metric"){var f=g*1.852;return f.toFixed(c)+" km/h"}else{var d=g*1.15078;return d.toFixed(c)+" mph"}};wundermap.utils.convertPressureIntoUnits=function(e,c,d){if(!d){d=0}if(!wundermap.utils.isValidMeasurement(c)){return"-"}if(e=="metric"){return(c*33.86).toFixed(d)}else{return c}};wundermap.utils.getPressureUnits=function(c){if(c=="metric"){return"hPa"}else{return"in"}};wundermap.utils.convertFlowRateIntoUnits=function(d,e,c){if(!c){c=0}if(d=="metric"){return(e*0.028316847).toFixed(c)}else{return e}};wundermap.utils.getFlowRateUnits=function(c){if(c=="metric"){return"m&sup3;/s"}else{return"cfs"}};wundermap.utils.convertRainIntoUnits=function(e,d,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(d)){return"-"}if(e=="metric"){return(d*2.54*10).toFixed(c)/10}else{return d}};wundermap.utils.getRainUnits=function(c){if(c=="metric"){return"cm"}else{return"in"}};wundermap.utils.convertRainIntoUnitsMM=function(e,d,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(d)){return"-"}if(e=="metric"){return(d*2.54*10).toFixed(c)}else{return d}};wundermap.utils.getRainUnitsMM=function(c){if(c=="metric"){return"mm"}else{return"in"}};wundermap.utils.convertWaveperiodIntoUnits=function(d,e,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(e)){return"-"}return parseFloat(e).toFixed(c)};wundermap.utils.convertWavedirIntoUnits=function(d,e,c){if(!c){c=0}if(!wundermap.utils.isValidMeasurement(e)){return"-"}return parseFloat(e).toFixed(c)};wundermap.utils.fixHour=function(e){var c=parseInt(e,10);if(c<=24){return e}else{var d=e.indexOf("00");if(d>-1&&d==e.length-2){return e.substring(0,d)}return e}};wundermap.search={title:"",marker:null};wundermap.search.initialize=function(g,h,f){var k=new google.maps.Geocoder();var d=a(g);var c=a(h);var e=a(f);d.bind("submit",function(l){k.geocode({address:c.val(),bounds:wundermap.map.getBounds()},wundermap.search.callback)});e.bind("change",function(o){var m=this.selectedIndex;if(m>0){var q=this.options[m].text;var s=this.options[m].value;var r=s.indexOf(",");var n=parseFloat(s.substring(0,r));var p=parseFloat(s.substring(r+1));var l=new google.maps.LatLng(n,p);wundermap.search.gotoLocation(l,q,10,null)}})};wundermap.search.callback=function(e,d){if(d!=google.maps.GeocoderStatus.OK){alert("Location not found. (error: "+d+")");return}var c=e[0].geometry.location;var g=e[0].formatted_address;var f=e[0].geometry.viewport;wundermap.search.gotoLocation(c,g,null,f)};wundermap.closeInfoBox=function(){if(wundermap.infobox){if(wundermap.infobox.hide){wundermap.infobox.hide()}else{wundermap.infobox.close()}}google.maps.event.trigger(wundermap,"infowindowclose")};wundermap.openInfoBox=function(c){var q=c.useInfoBox||true;if(!wui.defined(window.InfoBox)){q=false}if(wundermap.infobox_container){wundermap.infobox_container.remove()}if(wundermap.infobox){wundermap.infobox.close()}var e=a("<div></div>");e.append('<div class="infobox-pointer"></div>');if(c.title){e.append('<div class="infobox-title">'+c.title+"</div>")}if(c.content){e.append(c.content)}if(c.tabs){var f="infobox-tabs";var d=a("<div></div>").attr("id",f);var n=a("<ul></ul>").appendTo(d);for(var k=0;k<c.tabs.length;k++){var h=f+"-"+k;n.append('<li><a href="#'+h+'">'+c.tabs[k].title+"</a></li>");d.append('<div id="'+h+'">'+c.tabs[k].content+"</div>")}var r=a.extend(true,{},c.tabsOptions);d.tabs(r);d.appendTo(e)}if(c.footer){e.append(c.footer)}var g=e.find("#infobox-tabs");if(g[0]){g.tabs()}var l=null;if(wundermap.options.infobox.position!==null){var m=wundermap.imagemap_container.getProjection();if(a.isArray(wundermap.options.infobox.position)){var p=wundermap.options.infobox.position[0];var o=wundermap.options.infobox.position[1];l=m.fromContainerPixelToLatLng(new google.maps.Point(p,o))}}else{if(c.position){l=c.position}}if(!wundermap.infobox){if(q){wundermap.infobox=new InfoBox({pixelOffset:new google.maps.Size(9,-29),closeBoxMargin:"0px 0px 0px 0px",closeBoxURL:wundermap.options.iconsdomain+"/i/wu/wmTitleClose.png",position:l,disableAutoPan:wundermap.options.infobox.disableAutoPan});google.maps.event.addListener(wundermap.infobox,"closeclick",function(){google.maps.event.trigger(wundermap,"infowindowclose")})}else{wundermap.infobox=new google.maps.InfoWindow({position:l,disableAutoPan:wundermap.options.infobox.disableAutoPan})}}if(l){wundermap.infobox.setPosition(l)}if(c.styles){wundermap.infobox.setOptions({boxStyle:c.styles})}wundermap.infobox_container=e;wundermap.infobox.setContent(e[0]);if(wundermap.infobox.show){wundermap.infobox.show()}if(wundermap.options.infobox.position!==null){wundermap.infobox.open(wundermap.map)}else{wundermap.infobox.open(wundermap.map,c.marker)}if(q){google.maps.event.trigger(wundermap,"infowindowopen")}return wundermap.infobox};wundermap.search.gotoLocation=function(c,f,e,d){this.title=f;if(!this.marker){this.marker=new google.maps.Marker({clickable:true,map:wundermap.map,position:c,title:f});google.maps.event.addListener(this.marker,"click",function(k){var m=this.getTitle();var h=this.getPosition().lat().toFixed(4);var l=this.getPosition().lng().toFixed(4);var g='<div class="p10">This is your search result. <a href="/cgi-bin/findweather/hdfForecast?query='+h+","+l+'">View Conditions</a></div>';wundermap.openInfoBox({title:m,content:g,marker:this})})}else{this.marker.setPosition(c);this.marker.setTitle(f)}if(d){wundermap.map.fitBounds(d)}else{wundermap.map.setCenter(c);if(e){wundermap.map.setZoom(e)}}google.maps.event.trigger(wundermap.search,"viewchange")};wundermap.Layer=function(){this.initialized_=false};wundermap.Layer.prototype.constructor=wundermap.Layer;wundermap.Layer.prototype.initialize=function(c,m){this.initialized_=true;this.map_=c;this.options_=a.extend(true,{},{refreshTimeout:900,timelord:{showTooltip:false,text:"",triggerRefresh:true,min:new Date((new Date()).getTime()-300*1000),max:new Date((new Date()).getTime()+3600*1000)}},m);this.name_=this.options_.name;this.sidebarPrefix_=this.options_.sidebarPrefix;this.debug_=wundermap.options.debug||0;this.streets_=this.options_.streets||null;this.imagelayers_=[];this.markerlayers_=[];this.listeners_=[];this.listenersSetupParams_=[];this.clusters_={};this.unclustered_={};this.key_="";this.sliders_={};this.slidersSetupParams_=[];this.active_=false;this.disabled_=false;this.disabled_by_timelord_=false;this.queryString="";this.dataTables_=[];if(this.options_.defaultUI==1){this.createDefaultUI()}var k=this;this.elt_titleBar=this.findId();this.elt_titleBar.click(function(o){var n=a(o.target).is("input[type=checkbox]");if(!k.active_&&!n){k.toggle(true)}});this.elt_checkbox=this.findId("checkbox");this.elt_checkbox.click(function(n){k.toggle(this.checked)});this.elt_radio=this.findId("radio");this.elt_radioParent=this.findId("parent");this.elt_radio.click(function(n){k.radioButtonClick()});this.elt_options=this.findId("options");this.elt_legend=this.findId("legend");this.elt_displayAreaTab=this.findId("displayArea");this.elt_displayAreaTab2=this.findId("displayArea2");this.elt_printArea=this.findId("printArea");this.elt_moveToTop=null;this.setupTabs();if(wundermap.options.datepicker){var h=(this.options_.timelord&&this.options_.timelord.triggerRefresh);var d=google.maps.event.addListener(wundermap,"datepicker_changed",function(o,q){var n=k.disabled_;k.timelord_check_dates(o);var p=k.disabled_by_timelord_;if(!n){k.setDisabledByTimelord(p)}if(k.custom_check_dates&&!p){k.custom_check_dates(o)}if(k.active_&&(h||n||p)){k.refresh()}});d=google.maps.event.addListener(wundermap,"datepicker_step",function(n){});if(k.custom_check_dates){d=google.maps.event.addListener(this,"layertoggled",function(n){if(n&&!k.disabled_by_timelord_){k.custom_check_dates(wundermap.date)}})}this.timelord_check_dates(wundermap.date);if(!this.disabled){this.setDisabledByTimelord(this.disabled_by_timelord_)}if(wui.tooltip&&this.options_.timelord&&this.options_.timelord.showTooltip!==false){var e=this.elt_titleBar.find(".hasTimelord");if(!e[0]){e=wundermap.timelord.getTooltipButton(this.className);e.appendTo(this.elt_titleBar)}var g="";var f=this.elt_titleBar.find(".hasTimelordTooltip");if(f[0]){g=f.html()}if(!g){g=wundermap.timelord.getTooltipContent(this.options_.timelord,this.className)}var l=new wui.tooltip({button:e,content:g,position:{collision:"fit none"}})}}};wundermap.Layer.prototype.clearRefreshTimer=function(){if(this.refreshTimer_){window.clearTimeout(this.refreshTimer_);this.refreshTimer_=null}};wundermap.Layer.prototype.setRefreshTimer=function(){this.clearRefreshTimer();if(!this.options_.refreshTimeout){return}if(this.loading_||this.disabled_||this.disabled_by_timelord_||!this.active_){return}this.lastRefresh_=new Date();var d=this.options_.refreshTimeout*1000;var c=this;this.refreshTimer_=window.setTimeout(function(){if(c.loading_||c.disabled_||c.disabled_by_timelord_||!c.active_){c.clearRefreshTimer();return}c.refresh()},d)};wundermap.Layer.prototype.findId=function(d){var c="#"+this.sidebarPrefix_;if(d){c+="_"+d}return a(c)};wundermap.Layer.prototype.setCheckbox=function(c){this.elt_checkbox.filter("input[type=checkbox]").attr("checked",c)};wundermap.Layer.prototype.setRadioButton=function(c){this.elt_radio.filter("input[type=radio]").attr("checked",c);if(c){this.elt_radioParent.addClass("active").removeClass("inactive")}else{this.elt_radioParent.addClass("inactive").removeClass("active")}};wundermap.Layer.prototype.radioButtonClick=function(){for(var c in wundermap.layers){var d=wundermap.layers[c];if(d.initialized_===true){if(this.className==c){d.setRadioButton(true);d.toggle(true)}else{if(d.elt_radio[0]){d.setRadioButton(false);d.toggle(false)}}}}};wundermap.Layer.prototype.setLayerTimeout=function(){};wundermap.Layer.prototype.clearLayerTimeout=function(){};wundermap.Layer.prototype.toggle=function(c){this.setCheckbox(c);this.setRadioButton(c);if(c){this.active_=true;this.addComponents();if(this.streets_){this.streets_.attachTo(this.className)}this.elt_options.removeClass("none");this.elt_legend.removeClass("none");this.toggleMoveToTop(true);google.maps.event.trigger(this,"layertoggled",c)}else{this.active_=false;if(this.streets_){this.streets_.detachFrom(this.className)}this.removeComponents();this.elt_options.addClass("none");this.elt_legend.addClass("none");this.toggleMoveToTop(false);google.maps.event.trigger(this,"layertoggled",c);this.elt_printArea.empty();this.removeDataTables();wundermap.setHighlight(null);this.clearRefreshTimer()}this.updateQueryString();google.maps.event.trigger(wundermap,"layertoggled",this.className,c)};wundermap.Layer.prototype.createDefaultUI=function(){var c=a("#accordion");var g=this.sidebarPrefix_;var h=this.options_.title||this.className||this.options_.layer||"";var d='<div class="nobr accordion-header" id="'+g+'">';d+='<input type="checkbox" id="'+g+'_checkbox" value="" /> ';d+="<span>"+h+"</span>";d+="</div>";c.append(d);var f=this.findId();var e=this.findId("options").parent();f.insertBefore(e)};wundermap.Layer.prototype.setupTabs=function(){var f=this.elt_titleBar.next(".accordion-content");var e=f.find("ul.wundermapTabs");if(e[0]){var d=this;var c=false;e.show();f.tabs({show:function(h,g){if(c){f.slideDown("slow")}c=true;google.maps.event.trigger(d,"tabsshow",g);google.maps.event.trigger(wundermap,"tabsshow",d.name_,g)}})}};wundermap.Layer.prototype.addImageLayer=function(e){var c=this.imagelayers_.length;var d=new wundermap.ImageLayer(this.map_,this.options_,e,c);this.imagelayers_.push(d);if(this.disabled_){d.setDisabled(true)}if(this.disabled_by_timelord_){d.setDisabled(true)}return d};wundermap.Layer.prototype.addMarkerLayer=function(d){var c=this.markerlayers_.length;var e=new wundermap.MarkerLayer(this.map_,this.options_,d,c);this.markerlayers_.push(e);if(this.disabled_){e.setDisabled(true)}if(this.disabled_by_timelord_){e.setDisabled(true)}return e};wundermap.Layer.prototype.refresh=function(e){if(!wundermap.firstIdle){return}this.setRefreshTimer();for(var c=0;c<this.imagelayers_.length;c++){var d=this.imagelayers_[c];d.refresh(e)}for(var c=0;c<this.markerlayers_.length;c++){var f=this.markerlayers_[c];f.refresh(e)}};wundermap.Layer.prototype.setDisabled=function(c){this.disabled_=(c)?true:false;this.setDisabledComponents(c)};wundermap.Layer.prototype.setDisabledByTimelord=function(c){this.disabled_by_timelord_=(c)?true:false;this.setDisabledComponents(c)};wundermap.Layer.prototype.setDisabledComponents=function(d){for(var c=0;c<this.imagelayers_.length;c++){var e=this.imagelayers_[c];e.setDisabled(d)}for(var c=0;c<this.markerlayers_.length;c++){var f=this.markerlayers_[c];f.setDisabled(d)}};wundermap.Layer.prototype.addComponents=function(){var q=this;for(var n=0;n<this.imagelayers_.length;n++){var h=this.imagelayers_[n];h.setMap(this.map_);var g=google.maps.event.addListener(h,"imageload",function(r,s){if(r=="loadstart"){google.maps.event.trigger(q,"loadstart")}else{if(r=="load"){google.maps.event.trigger(q,"loadend")}else{google.maps.event.trigger(q,"loaderror",s)}}});this.listeners_.push(g);var g=google.maps.event.addListener(h,"settings_changed",function(){google.maps.event.trigger(q,"settings_changed")});this.listeners_.push(g)}for(var n=0;n<this.markerlayers_.length;n++){var p=this.markerlayers_[n];if(this.map_.getBounds()){p.refresh()}var g=google.maps.event.addListener(p,"layerload",function(r,s){if(r=="loadstart"){google.maps.event.trigger(q,"loadstart")}else{if(r=="load"){google.maps.event.trigger(q,"loadend")}else{google.maps.event.trigger(q,"loaderror",s)}}});this.listeners_.push(g)}for(var n=0;n<this.listenersSetupParams_.length;n++){var l=this.listenersSetupParams_[n];var e=l.id;var c=l.name;var f=l.eventname;if(e){var k=document.getElementById(this.sidebarPrefix_+"_"+e);if(k){var g=google.maps.event.addDomListener(k,f,function(){google.maps.event.trigger(q,"settings_changed");q.refresh({eventname:"settings_changed"})});this.listeners_.push(g)}}else{if(c){var o=document.getElementsByName(this.sidebarPrefix_+"_"+c);for(var m=0;m<o.length;m++){var k=o[m];var g=google.maps.event.addDomListener(k,f,function(){google.maps.event.trigger(q,"settings_changed");q.refresh({eventname:"settings_changed"})});this.listeners_.push(g)}}}}a.each(this.slidersSetupParams_,function(s,v){var w=v.id;if(!q.sliders_[w]){var t=q.findId(w+"_slider");var u=q.findId(w+"_value");var r=a.extend(true,{disabled:false,max:100,min:0,step:1,value:0,slide:function(x,y){u.text(y.value)},change:function(x,y){q.refresh();google.maps.event.trigger(q,"settings_changed")}},v.slider_opts);q.sliders_[w]=t.slider(r);u.text(r.value)}});for(var e in this.sliders_){this.sliders_[e].slider("enable")}var g;g=google.maps.event.addListener(this,"settings_changed",function(){q.updateQueryString();google.maps.event.trigger(wundermap,"settings_changed",this.className)});this.listeners_.push(g);var d="ajax-loading";g=google.maps.event.addListener(this,"loadstart",function(){this.elt_titleBar.addClass(d);google.maps.event.trigger(wundermap,"layerload",this.className,"loadstart",null)});this.listeners_.push(g);g=google.maps.event.addListener(this,"loadend",function(){this.elt_titleBar.removeClass(d);google.maps.event.trigger(wundermap,"layerload",this.className,"loadend",null)});this.listeners_.push(g);g=google.maps.event.addListener(this,"loaderror",function(r){this.elt_titleBar.removeClass(d);wui.log('Error while loading the "'+this.className+'" layer: \n'+(r?r:"(no details)"));google.maps.event.trigger(wundermap,"layerload",this.className,"loaderror",r)});this.listeners_.push(g)};wundermap.Layer.prototype.removeComponents=function(){while(this.listeners_.length>0){var f=this.listeners_.pop();google.maps.event.removeListener(f)}for(var c=0;c<this.imagelayers_.length;c++){var d=this.imagelayers_[c];d.setMap(null)}for(var c=0;c<this.markerlayers_.length;c++){var e=this.markerlayers_[c];e.removeOverlays()}for(var g in this.sliders_){this.sliders_[g].slider("disable")}};wundermap.Layer.prototype.timelord_check_dates=function(e){var c=this.options_.timelord;if(c&&((c.min&&e<c.min)||(c.max&&e>c.max))){if(this.debug_==1){wui.log("timelord out of bounds! layer: "+(this.className||this.name_))}this.elt_titleBar.addClass(wundermap.classNames.timelordWarning);this.disabled_by_timelord_=true;return false}else{this.disabled_by_timelord_=false;this.elt_titleBar.removeClass(wundermap.classNames.timelordWarning);return true}};wundermap.Layer.prototype.getAjaxOptions=function(){var c=this.imagelayers_[0];if(c&&!c.getDisabled()){return c.callbacks_.ajaxOptions||{}}else{return{}}};wundermap.Layer.prototype.getPrefs=function(c){return{}};wundermap.Layer.prototype.updateQueryString=function(){var f=this.name_;var g={};if(this.active_){g[f]="1";var d=this.getPrefs({type:"querystring"});if(d){var e=0;for(var c in d){var h=d[c];if(h!==null){g[f+"."+c]=h}if(e>50){break}e++}}}else{g[f]="0"}this.queryString=a.param(g)};wundermap.Layer.prototype.toQueryString=function(){if(!this.queryString){this.updateQueryString()}return this.queryString};wundermap.Layer.prototype.toPrefsObject=function(){var g=this.name_.toUpperCase();var h={};if(this.active_){h[g]="1";var d=this.getPrefs({type:"prefscookie"});if(d){var f=0;for(var c in d){var e=c.toUpperCase().replace(".","");var k=d[c];if(k!==null){h[g+e]=k}if(f>50){break}f++}}}else{h[g]="0"}return h};wundermap.Layer.prototype.getBalloonContent=function(g){if(a.isArray(g)){var c={};for(var f=0;f<g.length;f++){a.extend(c,g[f])}var g=c}var e='<div class="'+this.className+'Balloon">';e+='<div class="infobox-title">'+g.name+"</div>";e+='<div class="grt p10">';e+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';for(var d in g){if(a.inArray(d,["name","rect"])>-1){continue}e+='<tr><td class="nobr">'+d+':</td><td class="full">'+g[d]+"</td></tr>"}e+="</table>";e+="</div>";e+="</div>";return e};wundermap.Layer.prototype.getBalloonContentAds=function(e){var f=this.getBalloonContentAdsTitle(e);var d='<div class="'+this.className+'Balloon">';if(e.url_click){d+='<div class="infobox-title"><a target="new" href="'+e.url_click+'">'+f+"</a></div>"}else{d+='<div class="infobox-title">'+f+"</div>"}d+='<div class="p10">';d+=e.name+"<br/>";d+=e.address1+"<br/>";if(e.address2){d+=e.address2+"<br/>"}d+=e.city+", ";d+=e.state+" ";d+=e.postal_code+"<br/>";d+=e.phone+"<br/>";d+="</div>";if(this.as5000image_){d+='<div class="taC bm10">';if(e.url_click){d+='<a target="new" href="'+e.url_click+'">'}d+='<img src="'+this.as5000image_+'" alt="advertisement" />';if(e.url_click){d+="</a>"}d+="</div>"}if(this.as5000_){var c="http://www.wunderground.com/cgi-bin/tally?node="+this.as5000_+"."+wundermap.options.source+"&value="+e.id;d+='<div class="none"><img src="'+c+'" alt="" /></div>'}if(e.url_view){d+='<div class="none"><img src="'+e.url_view+'" alt="" /></div>'}d+="</div>";return d};wundermap.Layer.prototype.getBalloonContentAdsTitle=function(c){return c.name||c.id||this.className};wundermap.Layer.prototype.getBalloonContentCluster=function(m){var h='<div class="'+this.className+'Balloon">';h+='<div class="infobox-title">'+this.getClusterTitle(m)+"</div>";h+="<ul>";var d=m.clusternodes;var l=m.clusterindex;for(var g=0;g<d.length;g++){var f=d[g];if(m.cluster_hasDetailedResults){var e="javascript:wundermap.layers."+this.className+".getDetailsCached("+l+","+g+",13)"}else{var e=this.getImagemapAreasHref(f,g,false,15)}h+='<li><a href="'+e+'">'+f.name+"</a></li>"}var k=(m.clustercount-m.clustercount_limited);if(k>0){h+="<li>and "+k+" more&hellip;</li>"}h+="</ul>";var e="javascript:wundermap.zoomIn()";h+='<div class="p10"><a href="'+e+'">Zoom in for a closer look</a></div>';if(this.as5000_){var c="http://www.wunderground.com/cgi-bin/tally?node="+this.as5000_+"."+wundermap.options.source+"&value=cluster";h+='<div class="none"><img src="'+c+'" alt="" /></div>'}h+="</div>";return h};wundermap.Layer.prototype.getBalloonPicture=function(d,m,g,k){var c=m[g];var h=m.length;var l=this.sidebarPrefix_+"_"+d+"_prevPhoto";var e=this.sidebarPrefix_+"_"+d+"_nextPhoto";var f='<div id="'+k+'">';f+=this.getBalloonPictureContent(c,g,h,l,e);f+="</div>";return f};wundermap.Layer.prototype.changeBalloonPicture=function(e,n,h,l){var c=n[h];var k=n.length;var m=this.sidebarPrefix_+"_"+e+"_prevPhoto";var f=this.sidebarPrefix_+"_"+e+"_nextPhoto";var g=this.getBalloonPictureContent(c,h,k,m,f);var d=a(l);if(d){d.setHTML(g)}else{google.maps.event.trigger(this,"loaderror","Could not changeBalloonPicture into: "+l)}};wundermap.Layer.prototype.getBalloonPictureContent=function(e,c,k,d,l){var f='<div class="balloonInfo sm">';f+='<div class="b">'+e.title+"</div>";var g=e.handle.substr(0,1).toLowerCase();f+='<div class="subG">By <a href="http://www.wunderground.com/wximage/imagesearch.html?handle='+e.handle+'&handlebox=1&submit=go" class="nu">'+e.handle+"</a>";if(e.dateimage){f+=" on "+e.dateimage}f+="</div>";f+="<div>"+(c+1)+" of "+k+"</div>";f+='<table cellspacing="0" cellpadding="5" class="center"><tr class="vaM">';if(k>1){f+='<td><a href="#" id="'+d+'" class="picArrow" title="Previous Photo">&laquo;</a></td>'}f+='<td><a href="http://www.wunderground.com/wximage/'+e.handle+"/"+e.number+'" target="new"><img style="height: 100px; border: 1px solid #CCC; padding: 2px;" src="http://www.wunderground.com/data/wximagenew/'+g+"/"+e.handle+"/"+e.number+"."+e.imagetype+'" ></a></td>';if(k>1){f+='<td><a href="#" id="'+l+'" class="picArrow" title="Next Photo">&raquo;</a></td>'}f+="</tr></table>";if(e.caption){f+="<div>"+e.caption+"</div>"}f+="</div>";return f};wundermap.Layer.prototype.addPhotoListeners=function(c,n,h,k){if(!n){return}var l=this.sidebarPrefix_+"_"+c+"_prevPhoto";var d=this.sidebarPrefix_+"_"+c+"_nextPhoto";var f=a(l);var g=a(d);if(!f||!g){return}var m=this;var e=null;e=google.maps.event.addDomListener(f,"click",function(o){o=new Event(o).stop();h--;if(h<0){h=n.length-1}m.changeBalloonPicture(c,n,h,k);m.addPhotoListeners(c,n,h,k)});this.listeners_.push(e);e=google.maps.event.addDomListener(g,"click",function(o){o=new Event(o).stop();h++;if(h>=n.length){h=0}m.changeBalloonPicture(c,n,h,k);m.addPhotoListeners(c,n,h,k)});this.listeners_.push(e)};wundermap.Layer.prototype.getElementValue=function(f,d,e){var c=a("#"+this.sidebarPrefix_+"_"+f);if(!c[0]){if(d=="checkbox"){return wundermap.utils.isCheckedValue(e)}else{return e}}switch(d){case"animate":return c.hasClass("none");case"checkbox":return c[0].checked;case"select":case"input":return c[0].value;case"slider":return(c.hasClass("ui-slider"))?c.slider("value"):null;default:return e}};wundermap.Layer.prototype.setElementsValue=function(e,f,g){var h=document.getElementsByName(this.sidebarPrefix_+"_"+e);for(var d=0;d<h.length;d++){var c=h[d];if(f=="checkbox"){c.checked=wundermap.utils.isCheckedValue(g)}else{if(c.value==g){c.checked="checked"}else{c.checked=false}}}};wundermap.Layer.prototype.setElementValue=function(f,d,e){var c=a("#"+this.sidebarPrefix_+"_"+f);if(!c[0]){return}switch(d){case"checkbox":c[0].checked=wundermap.utils.isCheckedValue(e);break;case"input":case"select":c[0].value=e;break;default:break}};wundermap.Layer.prototype.getElementsValue=function(c,f,l){var g=document.getElementsByName(this.sidebarPrefix_+"_"+c);if(!g||g.length<=0){return l}var k=[];switch(f){case"radiogroup":var h=false;for(var e=0;e<g.length;e++){var d=g[e];if(d.checked){k.push(d.value);h=true}}if(!h){k.push(l)}break;case"checkboxgroup":for(var e=0;e<g.length;e++){var d=g[e];if(d.checked){k.push(d.value)}}break;default:break}var m=k.join(",");return m};wundermap.Layer.prototype.addElementListener=function(e,c){var d={id:e,name:null,eventname:c};this.listenersSetupParams_.push(d)};wundermap.Layer.prototype.addElementsListeners=function(c,d){var e={id:null,name:c,eventname:d};this.listenersSetupParams_.push(e)};wundermap.Layer.prototype.addSliderListener=function(e,d){var c={id:e,slider_opts:d};this.slidersSetupParams_.push(c)};wundermap.Layer.prototype.getNumFrames=function(f,d){var e=this.getElementValue(d+"_slider","slider",null);if(e===null){var c=this.getElementValue(f+"_start","animate",null);if(c===true){e=this.options_.animation.max}if(c===false){e=1}}if(e===null){e=this.options_.animation.num}return e};wundermap.Layer.prototype.setAnimateToggle=function(c){if(c){this.animateStart.addClass("none");this.animateStop.removeClass("none")}else{this.animateStart.removeClass("none");this.animateStop.addClass("none")}};wundermap.Layer.prototype.displayDataTable=function(s,h,n){var n=a.extend(true,{},{numRows:10,panel:this.elt_displayAreaTab,tableClass:"contentTable",containerClass:"",rowClass:"",headerClasses:{},start:0,rowHover:true,rowClick:true,sortable:true,headerTop:true},n);var k=n.panel;if(!k||!(k[0])){return}var m=a("<div></div>");if(n.containerClass){m.addClass(n.containerClass)}var v=a('<table cellspacing="0" cellpadding="0"></table>').appendTo(m).addClass(n.tableClass);var u=a("<thead></thead>").appendTo(v);var c=a("<tbody></tbody>").appendTo(v);var g=n.start;if(g<0){g=0}var e=g+n.numRows;var f=null;if(a.isArray(s)){for(var t=g;t<s.length&&t<e;t++){var l=s[t];if(!f){f=l}var d=this.getTableRowContent(l);d.addClass(n.rowClass).appendTo(c);this.addTableRowListeners(d,l,n)}var p=this;var o=this.getTableHeaderContent((g+1),t,s.length);if(o){if(n.headerClasses.div){o.addClass(n.headerClasses.div)}if(g>0){var q=a('<a href="javascript:void(0)" class="b"></a>');q.bind("click",function(w){n.start=g-n.numRows;p.displayDataTable(s,h,n)})}else{var q=a('<span class="grey"></span>')}if(n.headerClasses.prev){q.addClass(n.headerClasses.prev)}q.html("&laquo; Prev").prependTo(o);if(s.length>t){var r=a('<a href="javascript:void(0)" class="b"></a>');r.bind("click",function(w){n.start=t;p.displayDataTable(s,h,n)})}else{var r=a('<span class="grey"></span>')}if(n.headerClasses.next){r.addClass(n.headerClasses.next)}r.html("Next &raquo;").appendTo(o)}if(n.headerTop){o.prependTo(m)}else{o.appendTo(m)}}else{for(var t in s){var l=s[t];if(!f){f=l}var d=this.getTableRowContent(l);d.addClass(n.rowClass).appendTo(c);this.addTableRowListeners(d,l,n)}}var d=this.getTableHeadContent(f,0);if(d){u.append(d)}if(n.sortable&&v.tablesorter){if(a.isPlainObject(n.sortable)){v.tablesorter(n.sortable)}else{v.tablesorter()}}this.removeDataTable(h);this.dataTables_[h]=m;m.appendTo(k)};wundermap.Layer.prototype.removeDataTable=function(c){if(this.dataTables_[c]){this.dataTables_[c].empty().remove();this.dataTables_[c]=null}};wundermap.Layer.prototype.removeDataTables=function(){for(var c=0;c<this.dataTables_.length;c++){this.removeDataTable(c)}this.dataTables_=[]};wundermap.Layer.prototype.addTableRowListeners=function(d,e,c){if(c.rowHover){d.bind("mouseenter",function(m){var k=null;if(e.marker){k=e.marker.getPosition()}else{if(e.lat&&e.lon){k=new google.maps.LatLng(e.lat,e.lon)}else{if(e.rect){var h=wundermap.imagemap_container.getProjection();var l=e.rect;var g=l.split(",");var f=(b(g[0])+b(g[2]))/2;var n=(b(g[1])+b(g[3]))/2;k=h.fromContainerPixelToLatLng(new google.maps.Point(f,n))}}}wundermap.setHighlight(k)}).bind("mouseleave",function(f){wundermap.setHighlight(null)})}if(c.rowClick&&e.marker){d.bind("click",function(f){google.maps.event.trigger(e.marker,"click")})}};wundermap.Layer.prototype.getTableHeaderContent=function(f,c,d){var e=a('<div class="taC"></div>');e.html("&nbsp;&nbsp;"+f+"&ndash;"+c+" of "+d+"&nbsp;&nbsp;");return e};wundermap.Layer.prototype.getTableHeadContent=function(){return null};wundermap.Layer.prototype.getTableRowContent=function(e){var d=a("<tr></tr>");var c=a("<td></td>").appendTo(d);c.html(e.id);return d};wundermap.Layer.prototype.addAnimateListener=function(h,e,g){var d=this;this.animateStart=this.findId(h+"_start");this.animateStop=this.findId(h+"_stop");var f=this.findId(e+"_slider");var c=this.findId(e+"_value");var g=a.extend(true,{change:function(k,l){d.setAnimateToggle((l.value>1));d.refresh();google.maps.event.trigger(d,"settings_changed")}},g);this.addSliderListener(e,g);this.animateStart.click(function(k){if(wundermap.utils.hasTimelordWarning(f)){return}d.setAnimateToggle(true);var l=f.slider("option","max");f.slider("value",l);c.text(l)});this.animateStop.click(function(k){if(wundermap.utils.hasTimelordWarning(f)){return}d.setAnimateToggle(false);var l=f.slider("option","min");f.slider("value",l);c.text(l)});if(!f[0]){this.addElementListener(h+"_start","click");this.addElementListener(h+"_stop","click")}};wundermap.Layer.prototype.addOpacityListener=function(e){var d=this;var e=e||[0];var h=a("#"+d.sidebarPrefix_+"_opacity_value");var g=a("#"+this.sidebarPrefix_+"_opacity_slider");var f=this.options_.opacity||100;g.slider({value:this.options_.opacity||100,min:0,max:100,slide:function(k,l){c(l.value)},change:function(k,l){google.maps.event.trigger(d,"settings_changed")}});c(f);function c(m){h.text(m);for(var k=0;k<e.length;k++){var l=d.imagelayers_[e[k]];if(l){l.setOpacity(m/100)}}}};wundermap.Layer.prototype.addMarkerOpacityListener=function(g){var d=this;var g=g||[0];var h=a("#"+d.sidebarPrefix_+"_opacity2_value");var f=a("#"+this.sidebarPrefix_+"_opacity2_slider");var e=this.options_.fillopacity||40;f.slider({value:this.options_.fillopacity||40,min:0,max:100,slide:function(k,l){c(l.value)},change:function(k,l){google.maps.event.trigger(d,"settings_changed")}});c(e);function c(m){h.text(m);for(var k=0;k<g.length;k++){var l=d.markerlayers_[g[k]];if(l){l.setOpacity(m/100)}}}};wundermap.Layer.prototype.clearClusters=function(){this.clusters_={};this.unclustered_={}};wundermap.Layer.prototype.storeCluster=function(d,c){this.clusters_[d]=c};wundermap.Layer.prototype.recallCluster=function(c){return this.clusters_[c]};wundermap.Layer.prototype.storeUnclustered=function(c,d){this.unclustered_[c]=d};wundermap.Layer.prototype.recallUnclustered=function(c){return this.unclustered_[c]};wundermap.Layer.prototype.getCluster=function(f){var d=this.recallCluster(f);if(!d){google.maps.event.trigger(self,"loaderror","failed to load cluster for key: "+f);return}var e=this.getBalloonContentCluster(d);if(this.options_.infopane){this.options_.infopane.showHTML(e)}else{var c=d.cluster_point;wundermap.openInfoBox({content:e,position:c})}};wundermap.Layer.prototype.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.Layer.prototype.getDetails=function(g,f){var d=this;var e=this.getDetailsURL(g,f);if(this.debug_>0){wui.log("getDetailsURL: "+e)}var c=(this.getAjaxOptions)?this.getAjaxOptions():{};a.ajax(a.extend({url:e,dataType:"json",success:function(k,h){d.onClick(k,f)},error:function(){google.maps.event.trigger(d,"loaderror","failed to load details for id: "+g)}},c))};wundermap.Layer.prototype.getDetailsCached=function(e,d,g){if(e>=0){var c=this.recallCluster(e);if(!c){google.maps.event.trigger(this,"loaderror","failed to load cluster for key: "+e);return}var f=c.clusternodes[d];if(!f){google.maps.event.trigger(this,"loaderror","failed to load node for key: "+e+", index: "+d);return}}else{var f=this.recallUnclustered(d);if(!f){google.maps.event.trigger(this,"loaderror","failed to load unclustered node for index: "+d);return}}var h={};h.ICONS=[f];this.onClick(h,g)};wundermap.Layer.prototype.onClick=function(h,g){var f=h.ICONS[0];if(!f){google.maps.event.trigger(this,"loaderror","failed to load detailed click.");return}var e=this.getBalloonContent(f);if(this.options_.infopane){this.options_.infopane.showHTML(e)}else{var k=parseFloat(f.lat);var l=parseFloat(f.lon);var c=new google.maps.LatLng(k,l);if(g&&g>0){var d=this.map_.maxZoom;if(g>d){g=d}this.map_.setCenter(c);this.map_.setZoom(g)}wundermap.openInfoBox({content:e,position:c})}};wundermap.Layer.prototype.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,gmapzoom:this.map_.getZoom()};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.Layer.prototype.getDataURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:"js",key:this.key_,gmapzoom:this.map_.getZoom()};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.Layer.prototype.getURLMapgen=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:c.theme,proj:"automerc",format:"gif",alpha:"1",stdout:"1"};if(c.subdomain){var d="http://"+c.subdomain+".wunderground.com/cgi-bin/mapgen"}else{var d="/cgi-bin/mapgen"}d+="?"+a.param(g);return d};wundermap.Layer.prototype.getImagemapAreas=function(e,k){if(this.debug_==1){wui.log("wundermap.Layer::getImagemapAreas")}var c=[];var l=wundermap.imagemap_container.getProjection();var m=e.length;this.clearClusters();for(var h=m-1;h>=0;h--){var g=e[h];var f=document.createElement("area");f.setAttribute("shape","rect");f.setAttribute("coords",g.rect);if(typeof g.clusterindex!="undefined"){var p=this.getClusterTitle(g);if(p){f.setAttribute("title",p)}f.setAttribute("href","javascript:wundermap.layers."+this.className+".getCluster('"+g.clusterindex+"')");var o=g.cluster_x;var n=g.cluster_y;var q=l.fromContainerPixelToLatLng(new google.maps.Point(o,n));g.cluster_point=q;g.cluster_hasDetailedResults=k;this.storeCluster(g.clusterindex,g)}else{var p=this.getMarkerTitle(g);if(p){f.setAttribute("title",p)}if(k){this.storeUnclustered(h,g);f.setAttribute("href","javascript:wundermap.layers."+this.className+".getDetailsCached(-1,"+h+",0)")}else{var d=this.getImagemapAreasHref(g,h,k,0);f.setAttribute("href",d)}}c.push(f)}if(this.debug_==1){wui.log("wundermap.Layer::getImagemapAreas done, "+m+" points.")}return c};wundermap.Layer.prototype.getImagemapAreasHref=function(f,d,c,e){var e=e||0;return"javascript:wundermap.layers."+this.className+".getDetails('"+f.id+"',"+e+")"};wundermap.Layer.prototype.getMarkerTitle=function(c){return c.name||c.id||""};wundermap.Layer.prototype.getClusterTitle=function(c){return c.clustercount+" locations near here"};wundermap.Layer.prototype.setTimelord=function(c){wundermap.timelord.set(c)};wundermap.Layer.prototype.moveToTop=function(){for(var c=0;c<this.imagelayers_.length;c++){var d=this.imagelayers_[c];d.moveToTop()}};wundermap.Layer.prototype.canMoveToTop=function(){return(this.imagelayers_.length>0)?true:false};wundermap.Layer.prototype.toggleMoveToTop=function(c){if(wundermap.options.moveToTop&&this.canMoveToTop()&&this.elt_titleBar[0]){if(!this.elt_moveToTop||!this.elt_moveToTop[0]){this.elt_moveToTop=this.createMoveToTopButton();this.elt_moveToTop.appendTo(this.elt_titleBar)}if(c){this.elt_moveToTop.removeClass("none")}else{this.elt_moveToTop.addClass("none")}}};wundermap.Layer.prototype.createMoveToTopButton=function(){var d=this;var e=a("<small></small>");var c=a("<a>top</a>").attr("title","Make this the Top-most layer on the map").attr("href","javascript:void(0)").bind("click",function(f){d.moveToTop();return false});e.append(" (").append(c).append(")");return e};wundermap.ImageLayer=function(f,d,e,c){this.options_=d||{};this.name_=this.options_.name;this.sidebarPrefix_=this.options_.sidebarPrefix;this.debug_=wundermap.options.debug||0;this.extraImageLoadFactor_=this.options_.extraImageLoadFactor||1;this.retryMax_=this.options_.retryMax||2;this.callbacks_=e||{};this.index_=c||0;this.map_=f;this.bounds_=null;this.div_=null;this.div2_=null;this.img_=null;this.img2_=null;this.canvas_=null;this.canvas2_=null;this.div_active_=null;this.div_pending_=null;this.img_active_=null;this.img_pending_=null;this.canvas_active_=null;this.canvas_pending_=null;this.num_loads_=0;this.disabled_=false;this.listeners_=[];this.opacity_=100};wundermap.ImageLayer.prototype=new google.maps.OverlayView();wundermap.ImageLayer.prototype.constructor=wundermap.ImageLayer;wundermap.ImageLayer.prototype.onAdd=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::onAdd")}this.bounds_=this.callbacks_.fixedBounds||this.map_.getBounds();this.num_loads_=0;var c=a("<div></div>").css({"border-style":"none","border-width":"0px",position:"absolute"});var l=a("<img/>").css({"border-style":"none","border-width":"0px",width:"100%",height:"100%"});var e=null;var d=null;var m=c.clone();var g=l.clone();c.append(l);m.append(g);if(e){}this.div_=c;this.div2_=m;this.img_=l;this.img2_=g;this.canvas_=e;this.canvas2_=d;this.moveToTop();var p=this;l.bind({load:function(){p.loaded("load",c,l,e,m,g,d)},abort:function(){p.loaded("abort",c,l,e,m,g,d)},error:function(){p.loaded("error",c,l,e,m,g,d)}});g.bind({load:function(){p.loaded("load",m,g,d,c,l,e)},abort:function(){p.loaded("abort",m,g,d,c,l,e)},error:function(){p.loaded("error",m,g,d,c,l,e)}});this.img_active_=g;this.img_pending_=l;this.canvas_active_=d;this.canvas_pending_=e;this.div_active_=c;this.div_pending_=m;this.setOpacity(this.opacity_);this.loading_=false;this.requestedAnother_=false;this.retryNum_=0;if(this.callbacks_.checkbox){var h=this.callbacks_.checkbox[0];var k=document.getElementById(this.sidebarPrefix_+"_"+h);if(k){if(!k.checked){this.setDisabled(true)}var f=google.maps.event.addDomListener(k,"click",function(){p.setDisabled(!this.checked);p.refresh();google.maps.event.trigger(p,"settings_changed")});this.listeners_.push(f)}else{var n=this.callbacks_.checkbox[1];var o=wundermap.utils.isCheckedValue(n);if(!o){this.setDisabled(true)}}}this.refresh();if(this.name_=="wundermap"){this.moveToPane(this.getPanes().overlayMouseTarget);wundermap.imagemap=this.createImagemap();wundermap.imagemap_container=this}if(this.callbacks_.fn_getClickURL){var f=google.maps.event.addListener(this.map_,"click",function(r){if(!p.disabled_){var q=p.callbacks_.fn_getClickURL(r.latLng);p.loadClickURL(q,r.latLng)}});this.listeners_.push(f)}if(this.callbacks_.fn_getClickURLs){var f=google.maps.event.addListener(this.map_,"click",function(r){if(!p.disabled_){var t=[];for(var s=0;s<p.callbacks_.fn_getClickURLs.length;s++){var q=p.callbacks_.fn_getClickURLs[s](r.latLng);t.push(q)}p.loadClickURLs(t,r.latLng)}});this.listeners_.push(f)}};wundermap.ImageLayer.prototype.loadClickURL=function(f,c){var e=this;var d=this.callbacks_.ajaxOptions||{};a.ajax(a.extend({url:f,dataType:"json",success:function(h,g){if(!h){return}if(a.isEmptyObject(h)){return}if(e.callbacks_.fn_customClickResponse){e.callbacks_.fn_customClickResponse(h,c)}else{if(e.callbacks_.fn_getClickBalloonContent){var k=e.callbacks_.fn_getClickBalloonContent(h)}else{if(e.callbacks_.fn_getBalloonContent){var k=e.callbacks_.fn_getBalloonContent(h)}else{var k=wundermap.Layer.prototype.getBalloonContent.call(e,h)}}wundermap.openInfoBox({content:k,position:c})}},error:function(k,g,h){wui.log(g)}},d))};wundermap.ImageLayer.prototype.loadClickURLs=function(k,c){var e=this;var d=this.callbacks_.ajaxOptions||{};var l=[];for(var g=0;g<k.length;g++){var f=k[g];var h=a.ajax(a.extend({url:f,dataType:"json"},d));l.push(h)}a.when.apply(a,l).done(function(){var o=[];for(var n=0;n<arguments.length;n++){o.push(arguments[n][0])}if(e.callbacks_.fn_getClickBalloonContent){var m=e.callbacks_.fn_getClickBalloonContent(o)}else{if(e.callbacks_.fn_getBalloonContent){var m=e.callbacks_.fn_getBalloonContent(o)}else{var m=wundermap.Layer.prototype.getBalloonContent.call(e,o)}}wundermap.openInfoBox({content:m,position:c})})};wundermap.ImageLayer.prototype.reposition=function(v){var w=this.map_;var h=this.bounds_;var e=this.div_active_;var y=this.img_active_;var x=this.getProjection();var u=h.getSouthWest();var s=h.getNorthEast();var l=x.fromLatLngToDivPixel(u);var k=x.fromLatLngToDivPixel(s);var q=k.x-l.x;var g=l.y-k.y;var f=l.x;var n=k.y;if(q<=0){var r=x.getWorldWidth();q+=r;if(l.x>0){f-=r}}var p=Math.round(q*this.extraImageLoadFactor_);var o=Math.round(g*this.extraImageLoadFactor_);var d=(p-q)/2;var c=(o-g)/2;f-=d;n-=c;if(Math.abs(n)<0.001){n=0}if(Math.abs(f)<0.001){f=0}e.css({left:f,top:n,width:p,height:o});if(v){this.div_active_.css("display","block");this.div_pending_.css("display","none")}if(v&&this.callbacks_.fn_getDataURL){var m=y.width();var t=y.height();if(m<p||t<o){google.maps.event.trigger(this,"imageload","error","image ("+m+"x"+t+") is smaller than the bounds ("+p+"x"+o+"), therefore imagemap is not aligned properly")}}};wundermap.ImageLayer.prototype.onRemove=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::remove")}while(this.listeners_.length>0){var c=this.listeners_.pop();google.maps.event.removeListener(c)}this.img_.unbind();this.img2_.unbind();this.clearImagemap();this.hideWhenEmpty();this.div_.remove();this.div2_.remove();this.div_=null;this.div2_=null;this.img_=null;this.img2_=null;this.canvas_=null;this.canvas2_=null;if(this.canvas_){this.canvas_[0].width=0;this.canvas2_[0].width=0}if(this.debug_==1){wui.log("wundermap.ImageLayer::remove complete")}};wundermap.ImageLayer.prototype.draw=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::draw")}this.reposition(false)};wundermap.ImageLayer.prototype.refresh=function(c){if(this.debug_==1){wui.log("wundermap.ImageLayer::refresh layer:"+this.name_)}if(this.disabled_===true){this.hideImage();this.clearImagemap();return}if(!this.map_||!this.map_.getMapTypeId()){return}if(!this.div_active_){return}if(!wundermap.firstIdle){if(this.debug_==1){wui.log("wundermap.ImageLayer::refresh prevented because no firstIdle: "+this.name_)}return}this.bounds_=this.callbacks_.fixedBounds||this.map_.getBounds();if(this.callbacks_.fn_getStaticURL&&this.num_loads_>0){this.reposition(false)}else{this.loadImage()}};wundermap.ImageLayer.prototype.loadImage=function(){if(this.loading_){this.requestedAnother_=true;if(this.debug_==1){wui.log("wundermap.ImageLayer.loadImage:: another load is already in progress")}return}this.loading_=true;var y=this.map_;var f=this.bounds_;var z=this.getProjection();var v=f.getSouthWest();var t=f.getNorthEast();if(this.callbacks_.fixedBounds){var k=z.fromLatLngToDivPixel(v);var h=z.fromLatLngToDivPixel(t);var q=h.x-k.x;var e=k.y-h.y}else{var s=y.getDiv();var q=a(s).width();var e=a(s).height()}var o=Math.round(q*this.extraImageLoadFactor_);var n=Math.round(e*this.extraImageLoadFactor_);var g=t.lat();var d=t.lng();var u=v.lat();var r=v.lng();if(r>d){r-=360}var c=null;var l={isDataURL:false};if(this.callbacks_.getURL_opts){a.extend(l,this.callbacks_.getURL_opts)}if(f.toSpan().lng()>=360){c=null}else{if(this.callbacks_.fn_getStaticURL){c=this.callbacks_.fn_getStaticURL(g,d,u,r,o,n,l)}else{if(this.callbacks_.fn_getURL){c=this.callbacks_.fn_getURL(g,d,u,r,o,n,l)}}}if(!c||c.length<1){this.hideImage();this.clearImagemap();this.loading_=false;return}google.maps.event.trigger(this,"imageload","loadstart","");var A=this.img_pending_;var w=window.location.protocol+"//"+window.location.host+c;if((A.attr("src")==c||A.attr("src")==w)&&this.retryNum_==0){if(this.debug_>0){wui.log("(cached) "+c)}A.triggerHandler("load")}else{if(this.debug_>0){wui.log(c)}A.attr("src",c)}if(this.callbacks_.fn_getDataURL){var l={isDataURL:true};if(this.callbacks_.getURL_opts){a.extend(l,this.callbacks_.getURL_opts)}var p=this.callbacks_.fn_getDataURL(g,d,u,r,o,n,l);if(!p||p.length<1){this.clearImagemap();this.hideWhenEmpty();return}if(this.debug_>0){wui.log(p)}var m=this;var x=this.callbacks_.ajaxOptions||{};a.ajax(a.extend({url:p,dataType:"json",success:function(C,B){m.dataLoaded("load",C)},error:function(){m.dataLoaded("error",null)}},x))}this.num_loads_++};wundermap.ImageLayer.prototype.loaded=function(m,c,h,e,l,k,g){if(this.debug_==1){wui.log("wundermap.ImageLayer::loaded event: "+m)}if(m=="load"){this.div_active_=c;this.div_pending_=l;this.img_active_=h;this.img_pending_=k;this.canvas_active_=e;this.canvas_pending_=g;this.reposition(true);if(this.requestedAnother_){this.requestedAnother_=false;this.loading_=false;this.refresh()}else{this.retryNum_=0;this.requestedAnother_=false;this.loading_=false;google.maps.event.trigger(this,"imageload",m,"");if(!this.callbacks_.fn_getDataURL){this.hideWhenEmpty()}}h[0].onload=null;if(e){e[0].width=c.width();e[0].height=c.height();var d=e[0].getContext("2d");d.drawImage(h[0],0,0);this.context_=d}}else{if(this.retryNum_<this.retryMax_){this.retryNum_+=1;this.requestedAnother_=false;this.loading_=false;var n=this;window.setTimeout(function(){n.refresh()},5000)}else{this.requestedAnother_=false;this.loading_=false;var f="the image-load encountered an "+m+" signal after "+this.retryNum_+" retries.";if(this.debug_>0){}google.maps.event.trigger(this,"imageload",m,f);this.retryNum_=0;if(m=="abort"){h[0].onabort=null}else{if(m=="error"){h[0].onerror=null}}if(!this.callbacks_.fn_getDataURL){this.hideWhenEmpty()}}}};wundermap.ImageLayer.prototype.dataLoaded=function(n,m){if(this.debug_==1){wui.log("wundermap.ImageLayer::dataloaded event: "+n)}this.clearImagemap();if(n=="load"){if(!this.callbacks_.fn_getImagemapAreas){var g="the imagemap-load is missing a function callback: 'fn_getImagemapAreas'";google.maps.event.trigger(this,"imageload","error",g);return}var f=this.sidebarPrefix_+"_imagemap_"+this.index_;var o=this.getImagemap();if(!o){var g="missing an imagemap element";google.maps.event.trigger(this,"imageload","error",g);return}var p=a("<div></div>").attr("id",f);o.append(p);var e=m.ICONS;var d=this.callbacks_.getURL_opts;if(d&&d.hasDetailedResults){var c=this.callbacks_.fn_getImagemapAreas(e,d.hasDetailedResults)}else{var c=this.callbacks_.fn_getImagemapAreas(e,false)}var h=c.length;for(var k=0;k<h;k++){p[0].appendChild(c[k])}if(this.callbacks_.fn_useDataNodes){this.callbacks_.fn_useDataNodes(e,this.index_)}}else{var g="the imagemap-load encountered an "+n+" signal";if(this.debug_>0){g+=" URL is: "}google.maps.event.trigger(this,"imageload","error",g)}this.hideWhenEmpty()};wundermap.ImageLayer.prototype.moveToTop=function(){var c=this.getPanes();if(!c){return}if(this.callbacks_.fn_getDataURL){var d=c.overlayImage}else{var d=c.mapPane}this.moveToPane(d);google.maps.event.trigger(wundermap,"imagelayer_moved")};wundermap.ImageLayer.prototype.moveToPane=function(c){this.div_.appendTo(c);this.div2_.appendTo(c)};wundermap.ImageLayer.prototype.setOpacity=function(c){this.opacity_=c;if(this.div_active_){this.div_active_.css("opacity",c)}if(this.div_pending_){this.div_pending_.css("opacity",c)}};wundermap.ImageLayer.prototype.getURL=function(d,f,e,g,h,c,k){return""};wundermap.ImageLayer.prototype.hideImage=function(){if(this.div_){this.div_.css("display","none")}if(this.div2_){this.div2_.css("display","none")}};wundermap.ImageLayer.prototype.showImage=function(){if(this.div_active_){this.div_active_.css("display","block")}if(this.div_pending_){this.div_pending_.css("display","none")}};wundermap.ImageLayer.prototype.clearImagemap=function(){var d=this.sidebarPrefix_+"_imagemap_"+this.index_;var c=a("#"+d);c.remove()};wundermap.ImageLayer.prototype.getImagemap=function(){return wundermap.imagemap};wundermap.ImageLayer.prototype.getImagemapContainer=function(){return wundermap.imagemap_container};wundermap.ImageLayer.prototype.createImagemap=function(){if(this.debug_==1){wui.log("wundermap.ImageLayer::createImagemap")}var g=this.sidebarPrefix_+"_imagemap_"+this.index_;var d=a("#"+g);if(d){d.remove()}var c=a("<map></map>").attr("id",g);try{c.attr("name",g)}catch(f){}this.div_active_.parent().append(c);this.img_.attr("useMap","#"+g);this.img2_.attr("useMap","#"+g);return c};wundermap.ImageLayer.prototype.hideWhenEmpty=function(){var d=this.getImagemap();var c=this.getImagemapContainer();if(d&&c){var e=d.find("area");if(e.length>0){c.showImage()}else{c.hideImage()}}};wundermap.ImageLayer.prototype.getDisabled=function(){return this.disabled_};wundermap.ImageLayer.prototype.setDisabled=function(c){this.disabled_=(c)?true:false};wundermap.ImageLayer.prototype.getBounds=function(){return this.bounds_};wundermap.MarkerLayer=function(g,e,f,d){if(this.debug_==1){wui.log("wundermap.MarkerLayer::init")}var c=this;this.options_=e||{};this.name_=this.options_.name;this.sidebarPrefix_=this.options_.sidebarPrefix;this.debug_=wundermap.options.debug||0;this.map_=g;this.data_={};this.markerarray_=[];this.listeners_=[];this.infoWindows_=[];this.display_={iconcache:{}};this.callbacks_=f||{};this.index_=d||0;this.loading_=false;this.disabled_=false;this.numLoads_=0};wundermap.MarkerLayer.prototype.refresh=function(c){if(this.debug_==1){wui.log("wundermap.MarkerLayer::refresh layer:"+this.className)}if(this.loading_){if(this.debug_==1){wui.log("wundermap.MarkerLayer:: another load is already in progress")}return}var c=c||{};var g=c.eventname||"";if(g){if(this.numLoads_==0){g="firstload"}if(this.callbacks_.ignoreEvents){if(a.inArray(g,this.callbacks_.ignoreEvents)>-1){return}}}this.loading_=true;this.removeOverlays();if(this.disabled_){this.loading_=false;return}var d=this.map_.getBounds();var n=d.getSouthWest();var p=d.getNorthEast();var l=p.lat();var o=p.lng();var h=n.lat();var m=n.lng();if(m>o){m-=360}var r=this.map_.getDiv();var s=a(r).width();var k=a(r).height();var f=Math.round(s*1);var q=Math.round(k*1);var e=null;var c={isDataURL:false};if(this.callbacks_.getURL_opts){a.extend(c,this.callbacks_.getURL_opts)}if(this.callbacks_.fn_getURL){e=this.callbacks_.fn_getURL(l,o,h,m,f,q,c)}else{if(this.debug_==1){wui.log("MarkerLayer::layer "+this.className+" : this.callbacks_.fn_getURL == false")}this.loading_=false;return}if(!e||e.length<1){this.loading_=false;return}if(this.debug_>0){wui.log(e)}this.numLoads_++;if(this.callbacks_.fn_getURLDataCallback){this.loadURLData(e,this.callbacks_.fn_getURLDataCallback,this.callbacks_.ajaxOptions)}else{this.loading_=false}};wundermap.MarkerLayer.prototype.setOpacity=function(d){if(this.disabled_||this.loading_){}for(var c=0;c<this.markerarray_.length;c++){this.markerarray_[c].setOptions({fillOpacity:d})}};wundermap.MarkerLayer.prototype.addMarker=function(c){this.markerarray_.push(c)};wundermap.MarkerLayer.prototype.removeOverlays=function(){while(this.markerarray_.length>0){var c=this.markerarray_.pop();google.maps.event.clearInstanceListeners(c);c.setMap(null)}this.markerarray_=[];a("#"+this.sidebarPrefix_+"_"+this.options_.displayAreaTab).html("")};wundermap.MarkerLayer.prototype.makeIcon=function(c){var m=c.iconname||"clearCircle.gif";if(this.display_.iconcache[m]){return this.display_.iconcache[m]}else{var f=c.width||15;var n=c.height||15;var e=c.iconsdomain||wundermap.options.iconsdomain;var o=e+"/graphics/smash/";var d=o+m;if(this.debug_==1){wui.log("MarkerLayer::makeIcon : url = "+d)}var k=new google.maps.Size(f,n);var g=new google.maps.Point(f/2,n/2);var h=new google.maps.Point(f/2,n/2);var l={url:d,size:k,anchor:h};this.display_.iconcache[m]=l;return l}};wundermap.MarkerLayer.prototype.getDisabled=function(){return this.disabled_};wundermap.MarkerLayer.prototype.setDisabled=function(c){this.disabled_=(c)?true:false};wundermap.MarkerLayer.prototype.getURL=function(d,f,e,g,h,c,k){if(this.debug_==1){wui.log("In 'abstract' MarkerLayer.prototype.getURL() -- Define it in wundermap.js")}return""};wundermap.MarkerLayer.prototype.loadURLData=function(e,f,d){if(this.debug_==1){wui.log("wundermap.MarkerLayer::loadURLData")}google.maps.event.trigger(this,"layerload","loadstart","");var c=this;a.ajax(a.extend({url:e,dataType:"json",success:function(h,g){if(this.debug_==1){wui.log("MarkerLayer::loadURLData() response: "+h)}if(!h||a.isEmptyObject(h)){google.maps.event.trigger(c,"layerload","load","");return}google.maps.event.trigger(c,"layerload","load","");f.call(c,h)},error:function(k,g,h){google.maps.event.trigger(c,"layerload","error","failed to load marker data: "+g)}},d));c.loading_=false};wundermap.MarkerLayer.prototype.getURLDataCallback=function(c){if(this.debug_==1){wui.log("In 'abstract' MarkerLayer.prototype.getURLDataCallback -- Define it in wundermap.js")}return};wundermap.layers.Radar=new wundermap.Layer();wundermap.layers.Radar.className="Radar";wundermap.layers.Radar.initialize=function(e,c){var d={name:"rad",sidebarPrefix:"LayerRadarAnimGif",displayAreaTab:"displayArea",opacity:70,type:"N0R",type2:"",smooth:1,stormtracks:0,animation:{num:1,max:15,delay:100},refreshTimeout:900,subdomain:"radblast",timelord:{showTooltip:true,text:"from 1994 to 7 days in the future",min:new Date(Date.UTC(1994,1-1,1)),max:new Date((new Date()).getTime()+86400*1000)}};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),getURL_opts:{CORS:true}});this.addImageLayer({fn_getURL:a.proxy(this.getURLFuture,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLArchive,this),fixedBounds:new google.maps.LatLngBounds(new google.maps.LatLng(21.12,-133),new google.maps.LatLng(52,-58))});this.addMarkerLayer({fn_getURL:a.proxy(this.getURLStorms,this),fn_getURLDataCallback:a.proxy(this.drawData,this)});this.markerLayerStormTracks=0;this.addOpacityListener([0,1,2]);this.addElementListener("smooth","click");this.setElementValue("smooth","checkbox",this.options_.smooth);this.addElementListener("stormtracks","click");this.setElementValue("stormtracks","checkbox",this.options_.stormtracks);this.addElementListener("type","change");this.setElementValue("type","select",this.options_.type);this.addElementListener("type2","change");this.setElementValue("type2","select",this.options_.type2);this.addElementListener("delay","change");this.setElementValue("delay","select",this.options_.animation.delay);this.setElementValue("subdomain","input",this.options_.subdomain);this.addAnimateListener("animate","frames",{min:1,max:this.options_.animation.max,value:this.options_.animation.num})};wundermap.layers.Radar.custom_check_dates=function(g){var e=new Date();var c=new Date(e.getTime()-1800*1000);var f=new Date(e.getTime()+3600*1000);if(g&&g>f){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(false);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(true)}else{if(g&&g<c){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(false);this.markerlayers_[0].setDisabled(true)}else{this.imagelayers_[0].setDisabled(false);this.imagelayers_[1].setDisabled(true);this.imagelayers_[2].setDisabled(true);this.markerlayers_[0].setDisabled(false)}}};wundermap.layers.Radar.getURL=function(k,g,s,q,p,o,n){var v={maxlat:k,maxlon:g,minlat:s,minlon:q,width:p,height:o,type:this.getElementValue("type","select",this.options_.type),frame:"0",num:this.getNumFrames("animate","frames"),delay:this.getElementValue("delay","select",this.options_.animation.delay),png:"0",smooth:(this.getElementValue("smooth","checkbox",this.options_.smooth))?"1":"0",min:"2",noclutter:"0",rainsnow:"1",nodebug:"0",theext:".gif",timelabel:"1","timelabel.x":p-160,"timelabel.y":41,brand:"wundermap",rand:Math.floor((new Date()).getTime()/60000)};if(this.map_.getZoom()<=7){v["reproj.automerc"]="1"}var t=this.getElementValue("type2","select","");if(t){v.type2=t}var r=this.getElementValue("lightning","checkbox",false);if(r){v.lightning="1"}var l=this.getElementValue("wumaps","checkbox",false);if(l){v.newmaps="1"}var h=this.getElementsValue("merge","radiogroup","");if(h=="0"){v.merge="elev"}if(h=="1"){v.merge="dBZ"}if(n.CORS===true){v.cors="1"}var d=this.getElementValue("extra","input","");if(wundermap.RadSatSync.isSynced()){var e=wundermap.layers.Satellite;var c=a.extend({},n,{returnParams:true});var m=e.getURL.call(e,k,g,s,q,p,o,c);var f=this.getURLRadSatSync(v,m);if(d){f+=d}return f}var u=this.getElementValue("subdomain","input",this.options_.subdomain);if(!u){u=this.options_.subdomain}var f="http://"+u+".wunderground.com/cgi-bin/radar/WUNIDS_composite?"+a.param(v);if(d){f+=d}return f};wundermap.layers.Radar.getURLRadSatSync=function(c,e){var g={interval:30,num:this.getNumFrames("animate","frames"),delay:this.getElementValue("delay","select","25")};for(var f in c){g["rad."+f]=c[f]}for(var f in e){g["sat."+f]=e[f]}var d="http://www.wunderground.com/cgi-bin/RadSatSync?"+a.param(g);return d};wundermap.layers.Radar.getURLFuture=function(g,f,t,p,o,m,l){var w=wundermap.layers.ModelData.config;var c=w.MODEL.NAM.modelrun;var x=null;for(var q in c){if(!x){x=c[q]}else{if(c[q].initialization.epoch>x.initialization.epoch){x=c[q]}}}var d=x.period;var r=null;var s=null;var h=0;var n=0;for(var q in d){if(!d[q].exists=="1"){continue}var k=Math.abs(b(d[q].valid)*1000-wundermap.date.getTime());if(!r||k<h){r=d[q];h=k}var v=d[q].valid;if(!s||v>n){s=d[q];n=v}}var u={maxlat:g,maxlon:f,minlat:t,minlon:p,width:o,height:m,model:"NAM",script:"radarRS",modelrun:x.initialization.readable,hour:r.hour};if(wundermap.options.datepicker&&s){this.options_.timelord.max=new Date(s.valid*1000);this.timelord_check_dates(wundermap.date)}var e="http://modelmaps.wunderground.com/php/run.php";e+="?"+a.param(u);return e};wundermap.layers.Radar.getURLArchive=function(k,m,h,l,g,n,d){if(!wundermap.date){return null}var c=wui.date.strftime("%Y/%m/%d",wundermap.date,true);var f=wui.date.strftime("%Y%m%d%H",wundermap.date,true);var e="http://timelord.wunderground.com/timelord/nids/N0R/5120x2880/"+c+"/CONUS_5120x2880_"+f+".gif";return e};wundermap.layers.Radar.getURLStorms=function(l,n,h,m,f,q,c){var p=this.findId("legend_stm");var o=this.getStormTracks();if(!o){p.addClass("none");return""}else{p.removeClass("none")}if(m>n){m-=360}var d="/cgi-bin/wundermap_storm_bins?maxlat="+l+"&maxlon="+n+"&minlat="+h+"&minlon="+m;var e=new Date();var g=e.getTime();var k=Math.floor(g/60000);d+="&rand="+k;return d};wundermap.layers.Radar.getURLStormsData=function(c,d){};wundermap.layers.Radar.getStormTracks=function(){try{return this.getElementValue("stormtracks","checkbox",this.options_.stormtracks)}catch(c){return false}};wundermap.layers.Radar.getBalloonContentStormTracks=function(c,p,l,g,m){var k=this.lookupStormType(l);var h='<div class="stormBalloon">';h+='<div class="infobox-title">Radar Detected Storms</div>';h+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr><td class="full">Location: <span>'+g.CITY+", "+g.STATE+'</span></td><td class="vaT nobr dtr">Lat: <span>'+parseFloat(g.slat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(g.slon).toFixed(2)+"</span></td></tr></table>";h+='<div class="grt p10">';h+='<table cellspacing="0" cellpadding="0" class="cleanTable full"><tr><td class="vaT nobr">Type:</td><td class="full"><span class="b">'+k+"</span> ("+g.ID+')</div><tr><td class="vaT nobr">Max Reflectivity:</td><td><span class="b">'+g.DBZM+'</span> dBZ</td></tr><tr><td class="vaT nobr">Severe Hail:</td><td><span class="b">'+g.POSH+'</span>% Chance </td></tr><tr><td class="vaT nobr">Hail:</td><td><span class="b">'+g.POH+'</span>% Chance</td></tr><tr><td class="vaT nobr">Max Hail Size:</td><td><span class="b">'+g.MXSIZE+'</span> in.</td></tr><tr><td class="vaT nobr">Echo Top:</td><td><span class="b">'+g.TOP.feet+'</span> ft.</td></tr><tr><td class="vaT nobr">Vert. Integrated Liquid:</td><td><span class="b">'+g.VIL+"</span> kg/m&sup2;</td></tr>";if(g.FCTSPD=="new"){var e="N/A</span>";var o="New Cell</span>"}else{var n=parseFloat(g.FCTSPD);var d=n*1.1507794;var f=d.toFixed(0)+"</span> mph ("+g.FCTSPD+" knots)";var o=g.FCTDIR.lang+"</span> ("+g.FCTDIR_VALUE+")"}h+='<tr><td class="vaT nobr">Speed:</td><td><span class="b">'+f+'</td></tr><tr><td class="vaT nobr">Direction (from):</td><td><span class="b">'+o+'</td></tr><tr><td class="vaT nobr">Radar Site:</td><td><span class="b">'+g.RADAR+"</span></td></tr></table>";h+="</div>";h+="</div>";return h};wundermap.layers.Radar.getDisplayAreaBox=function(d,c,g,h,f,l){var e="";if(l){var k=wundermap.options.iconsdomain+"/graphics/smash/";e+='<img src="'+k+l+'" alt="'+h+'" title="'+h+'" align="left" />'}e+=d;if(c){e+=" ("+c+")"}return e};wundermap.layers.Radar.drawData=function(x){var z=this;var r=this.markerLayerStormTracks;var m=true;if(this.map_.getZoom()<7){m=false}if(this.debug_==1){wui.log("Radar.drawData")}if(x){this.markerlayers_[0].data_=x}var J=this.markerlayers_[r].data_.STORMS;this.markerlayers_[r].removeOverlays();var n=a("#"+this.sidebarPrefix_+"_"+this.options_.displayAreaTab);if(this.options_.displayAreaTab){n.html("");n.append("<div class='p5'><strong>Doppler Radar Detected Storms:</strong></div>")}var g=0;var p=0;for(var F in J){var d=J[F];var K=F;var s=parseFloat(d.slat);var k=parseFloat(d.slon);var D=new google.maps.LatLng(s,k);p++;if(g>=100){continue}g++;var c="Near "+d.CITY+", ";if(d.COUNTY=="NONE"){c+=d.COUNTRY}else{c+=d.STATE+", "+d.COUNTRY;c+="<br /> ("+d.COUNTY+" County)"}var h="";var q="";if(d.TVS=="TVS"||d.TVS=="ETVS"){h="TVS";q="clearTriangle.gif"}else{if(d.MESO=="MESO"||d.MESO=="EMESO"){h="MESO";q="clearDiamond.gif"}else{if(d.MESO=="3DCO"){h="3DCO";q="clearDiamond.gif"}else{if(d.MESO=="UNCO"){h="UNCO";q="clearDiamond.gif"}else{if(d.POH&&b(d.POH)>=70){h="HAIL";q="clearSquare.gif"}else{h="";q="clearCircle.gif"}}}}}var C=this.lookupStormType(h);var G=this.markerlayers_[r].makeIcon({iconname:q});var v=new google.maps.Marker({map:this.map_,position:D,icon:G,title:C});v.set("name",K);v.set("location",c);v.set("type",h);v.set("storm",d);v.set("iconName",q);var I=google.maps.event.addListener(v,"click",function(M){var L=z.getBalloonContentStormTracks(this.get("name"),this.get("location"),this.get("type"),this.get("storm"),this.get("iconName"));wundermap.openInfoBox({content:L,marker:this})});this.markerlayers_[r].addMarker(v);if(m){var E=0;var f=0;var w=d.FCTSPD;if(w!="new"){E=parseFloat(w);f=parseFloat(d.FCTDIR_VALUE);var o=270-f}var l=E*1.1507794;var H=l*(20/60);var u=l*(40/60);var t=l*(60/60);var B;B=this.drawArcMiles(D,H,o-20,o+20,"#FF0000",1,1,"#CCCCCC",0.4,{wedge:true});this.markerlayers_[r].markerarray_.push(B);B=this.drawArcMiles(D,u,o-20,o+20,"#FF0000",1,1,"#CCCCCC",0.4,{wedge:true});this.markerlayers_[r].markerarray_.push(B);B=this.drawArcMiles(D,t,o-20,o+20,"#FF0000",1,1,"#CCCCCC",0.4,{wedge:true});this.markerlayers_[r].markerarray_.push(B)}if(this.options_.displayAreaTab){var y=a(document.createElement("div"));y.addClass(this.sidebarPrefix_+"_box");var A=a(document.createElement("a"));A.bind("mouseover",function(){this.addClass("bgY").removeClass("bgW")});A.bind("mouseout",function(){this.addClass("bgW").removeClass("bgY")});A.bind("click",function(){z.map_.panTo(D);z.refresh()});var e=this.getDisplayAreaBox(K,c,h,C,d,q);A.html(e);y.append(A);n.append(y)}}if(g<p){wui.log("Too many storms to display at once. Showing "+g+" of "+p+" in this area.")}if(this.debug_==1){wui.log("Radar.drawData::numStorms = "+g)}return true;return false};wundermap.layers.Radar.drawArc=function(u,c,v,x,h,n,t,e,g,q,m){var r=[];var m=m||{};var l=m.degStep||6;var p=m.wedge||false;if(p){r.push(u)}for(var s=x;s<=h;s+=l){var k=wundermap.utils.deg2rad(s);var d=c*Math.sin(k);var w=v*Math.cos(k);var o=new google.maps.LatLng(u.lat()+d,u.lng()+w,true);r.push(o)}if(p){r.push(u)}var f;if(p){f=new google.maps.Polygon({map:this.map_,paths:r,strokeColor:n,strokeWeight:t,strokeOpacity:e,fillColor:g,fillOpacity:q})}else{f=new google.maps.Polyline({map:this.map_,paths:r,strokeColor:n,strokeWeight:t,strokeOpacity:e})}return f};wundermap.layers.Radar.drawArcMiles=function(d,l,g,h,s,k,n,e,p,c){var o=3963.19;var m=180/(o*Math.PI);var r=m/Math.cos(wundermap.utils.deg2rad(d.lat()));var q=l*m;var f=l*r;return this.drawArc(d,q,f,g,h,s,k,n,e,p,c)};wundermap.layers.Radar.drawArcKM=function(d,l,g,h,s,k,n,e,p,c){var o=6378.137;var m=180/(o*Math.PI);var r=m/Math.cos(wundermap.utils.deg2rad(d.lat()));var q=l*m;var f=l*r;return this.drawArc(d,q,f,g,h,s,k,n,e,p,c)};wundermap.layers.Radar.lookupStormType=function(c){if(c=="TVS"){return"Tornadic Thunderstorm"}else{if(c=="MESO"||c=="3DCO"||c=="UNCO"){return"Rotating Thunderstorm"}else{if(c=="HAIL"){return"Hail Storm"}else{return"Thunderstorm"}}}};wundermap.layers.Radar.refresh=function(c){wundermap.layers.ModelData.checkRequestConfig();wundermap.Layer.prototype.refresh.call(this,c)};wundermap.layers.Radar.getPrefs=function(){return{num:this.getNumFrames("animate","frames"),spd:this.getElementValue("delay","select",this.options_.animation.delay),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity),type:this.getElementValue("type","select",this.options_.type),type2:this.getElementValue("type2","select",this.options_.type2),smo:(this.getElementValue("smooth","checkbox",this.options_.smooth))?"1":"0",stm:(this.getElementValue("stormtracks","checkbox",this.options_.stormtracks))?"1":"0"}};wundermap.layers.Satellite=new wundermap.Layer();wundermap.layers.Satellite.className="Satellite";wundermap.layers.Satellite.initialize=function(f,c){var e={name:"sat",sidebarPrefix:"LayerSatellite",source:"cpc",type:"IR4",opacity:70,gtt1:108,gtt2:108,animation:{num:1,max:8,delay:100},timelord:{showTooltip:true,text:"Historical data from Feb 2000, then current data, then 7 days of forecast into the future",min:new Date(Date.UTC(2000,2-1,8)),max:new Date((new Date()).getTime()+86400*6*1000)}};c=a.extend(true,{},e,c);wundermap.Layer.prototype.initialize.call(this,f,c);var h=this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLFuture,this)});var d=[0,1];var g=d.length;this.addOpacityListener(d);this.addElementListener("delay","change");this.addAnimateListener("animate","frames",{min:1,max:this.options_.animation.max,value:this.options_.animation.num});this.addElementsListeners("type","click");this.setElementsValue("type","radiogroup",this.options_.type);this.addElementsListeners("source","click");this.setElementsValue("source","radiogroup",this.options_.source);this.addSliderListener("gtt",{min:0,max:255,value:this.options_.gtt1});this.addElementListener("png","click");this.setupTilesHistory();if(this.initialize_dev){this.initialize_dev()}};wundermap.layers.Satellite.custom_check_dates=function(g){var f=new Date();var e=new Date(f.getTime()-3600*1000);var c=new Date(f.getTime()+3600*1000);if(g&&g>c){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(false);this.removeTilesHistory()}else{if(g&&g<e){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.removeTilesHistory();if(this.active_){this.addTilesHistory()}}else{this.imagelayers_[0].setDisabled(false);this.imagelayers_[1].setDisabled(true);this.removeTilesHistory()}}this.check_timelord_aware()};wundermap.layers.Satellite.check_timelord_aware=function(){var c=!this.imagelayers_[0].getDisabled();var d=this.elt_options.find("."+wundermap.classNames.timelordAware);if(c){d.removeClass(wundermap.classNames.timelordWarning);d.find("input, select, textarea").attr("disabled",false);d.find(".slider_bg").slider("enable")}else{d.addClass(wundermap.classNames.timelordWarning);d.find("input, select, textarea").attr("disabled",true);d.find(".slider_bg").slider("disable")}};wundermap.layers.Satellite.setupTilesHistory=function(){var c=this;this.tilesHistory=[];var d=this.tilesHistory;d.push(new google.maps.ImageMapType({getTileUrl:function(g,f){if(f>6){return null}return e(g,f)},tileSize:new google.maps.Size(256,256),opacity:0.01*this.getElementValue("opacity_slider","slider",this.options_.opacity),minZoom:0,maxZoom:6,name:"satir",alt:"satir"}));a.each([7,8,9,10,11,12],function(f,h){var g=h;d.push(new google.maps.ImageMapType({getTileUrl:function(l,k){if(k!=g){return null}k=6;return e(l,k)},tileSize:new google.maps.Size(256*Math.pow(2,g-6),256*Math.pow(2,g-6)),opacity:0.01*c.getElementValue("opacity_slider","slider",c.options_.opacity),minZoom:g,maxZoom:g,name:"satir",alt:"satir"}))});function e(n,l){var h=1<<l;var f=((n.x%h)+h)%h;var m=n.y;if(f<0||m<0){return null}else{if(wundermap.date===null){return null}else{var k=wui.date.strftime("%Y/%m/%d/%H",wundermap.date,true);var g="http://timelord.wunderground.com/timelord/satir/"+k+"/"+l+"/"+f+"/"+m+".png";return g}}}google.maps.event.addListener(this,"layertoggled",function(f){if(!f){c.removeTilesHistory()}});this.findId("opacity_slider").bind("slide",function(f,g){c.setTilesOpacity(g.value/100)})};wundermap.layers.Satellite.addTilesHistory=function(){for(var c=0;c<this.tilesHistory.length;c++){wundermap.map.overlayMapTypes.insertAt(0,this.tilesHistory[c])}};wundermap.layers.Satellite.removeTilesHistory=function(){wundermap.utils.removeOverlayMapTypeByName("satir")};wundermap.layers.Satellite.setTilesOpacity=function(d){for(var c=0;c<this.tilesHistory.length;c++){this.tilesHistory[c].setOpacity(d)}};wundermap.layers.Satellite.getURL=function(h,l,f,k,e,m,c){var g={maxlat:h,maxlon:l,minlat:f,minlon:k,width:e,height:m,gtt:this.getElementValue("gtt_slider","slider",this.options_.gtt1),frame:"0",num:this.getNumFrames("animate","frames"),delay:this.getElementValue("delay","select","25"),key:"sat_"+this.getElementsValue("type","radiogroup",this.options_.type).toLowerCase(),proj:"me",rand:Math.floor((new Date()).getTime()/60000)};if(b(g.num)==1&&this.getElementValue("png","checkbox",false)){g.extension="png";g.gtt="0"}if(c.returnParams){return g}else{if(wundermap.RadSatSync.isSynced()){return null}}var d="http://wublast.wunderground.com/cgi-bin/WUBLAST";d+="?"+a.param(g);return d};wundermap.layers.Satellite.getURLFuture=function(g,f,t,p,o,m,l){var w=wundermap.layers.ModelData.config;var c=w.MODEL.ECMWF.modelrun;var x=null;for(var q in c){if(!x){x=c[q]}else{if(c[q].initialization.epoch>x.initialization.epoch){x=c[q]}}}var d=x.period;var r=null;var s=null;var h=0;var n=0;for(var q in d){if(!d[q].exists=="1"){continue}var k=Math.abs(b(d[q].valid)*1000-wundermap.date.getTime());if(!r||k<h){r=d[q];h=k}var v=d[q].valid;if(!s||v>n){s=d[q];n=v}}var u={maxlat:g,maxlon:f,minlat:t,minlon:p,width:o,height:m,model:"ECMWF",script:"totalcloud",modelrun:x.initialization.readable,hour:r.hour};if(wundermap.options.datepicker&&s){this.options_.timelord.max=new Date(s.valid*1000);this.timelord_check_dates(wundermap.date)}var e="http://modelmaps.wunderground.com/php/run.php";e+="?"+a.param(u);return e};wundermap.layers.Satellite.refresh=function(c){wundermap.layers.ModelData.checkRequestConfig();wundermap.Layer.prototype.refresh.call(this,c)};wundermap.layers.Satellite.getPrefs=function(){return{num:this.getNumFrames("animate","frames"),spd:this.getElementValue("delay","select",this.options_.animation.delay),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity),gtt1:this.getElementValue("gtt_slider","slider",this.options_.gtt1),gtt2:this.getElementValue("gtt_slider","slider",this.options_.gtt2),type:this.getElementsValue("type","radiogroup",this.options_.type),src:this.getElementsValue("source","radiogroup",null)}};wundermap.layers.StormReports=new wundermap.Layer();wundermap.layers.StormReports.className="StormReports";wundermap.layers.StormReports.initialize=function(e,c){var d={title:"U.S. Storm Reports",name:"stormreports",sidebarPrefix:"LayerStormReports",timelord:{showTooltip:true,text:"daily from June 1999 to present",min:new Date(Date.UTC(1999,6-1,1)),max:new Date((new Date()).getTime()+3600*1000)},tor:1,hail:1,wind:1};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="stormreports";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.addElementsListeners("type","click");this.setElementValue("type_tor","checkbox",this.options_.tor);this.setElementValue("type_hail","checkbox",this.options_.hail);this.setElementValue("type_wind","checkbox",this.options_.wind)};wundermap.layers.StormReports.getURL=function(l,q,h,o,e,r,c){var p=new Date(wundermap.date.getTime()-3600);var g=new Date(wundermap.date.getTime()+3600);var f=wui.date.strftime("%Y-%m-%d %H:00:00,",p,true);var m=wui.date.strftime("%Y-%m-%d %H:59:59",g,true);var f=wui.date.strftime("%Y-%m-%d 00:00:00,",wundermap.userdate,true);var m=wui.date.strftime("%Y-%m-%d 23:59:59",wundermap.userdate,true);var k={minlat:h,minlon:o,maxlat:l,maxlon:q,width:e,height:r,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.DateTime.btw":f+m};var n=this.getElementsValue("type","checkboxgroup",null);if(n!=null){k["filter.Type.any"]=n}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(k);return d};wundermap.layers.StormReports.getMarkerTitle=function(c){return c.Type+": "+c.DateTime};wundermap.layers.StormReports.getBalloonContent=function(f){var e=f.Type;var d='<div class="StormReportsBalloon">';d+='<div class="infobox-title">Storm Report</div>';d+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';d+='<td class="full">Location: <span>'+f.Location+"</span></td>";d+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(f.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(f.lon).toFixed(2)+"</span></td></tr></table>";d+='<div class="grt p10">';d+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';d+='<tr><td class="nobr">Type:</td><td class="full"><span class="b cap">'+e+"</span></td>";if(e=="hail"){if(f.Size=="UNK"){var c="Unknown"}else{var c=(b(f.Size)/100).toFixed(2)}if(c=="Unknown"){d+='<tr><td>Size:</td><td class="full"><span class="b">'+c+"</span></td></tr>"}else{d+='<tr><td>Size:</td><td class="full"><span class="b">'+c+"</span> in.</td></tr>"}}else{if(e=="wind"){var c=(f.Size=="UNK")?"Unknown":f.Size;if(c=="Unknown"){d+='<tr><td>Gusts:</td><td class="full"><span class="b">'+c+"</span></td></tr>"}else{d+='<tr><td>Gusts:</td><td class="full"><span class="b">'+c+"</span> mph</td></tr>"}}}if(f.State=="LA"){d+='<tr><td>Parish:</td><td class="full"><span class="b">'+f.County+"</span></td>"}else{d+='<tr><td>County:</td><td class="full"><span class="b">'+f.County+"</span></td>"}d+='<tr><td>State:</td><td class="full"><span class="b">'+f.State+"</span></td></tr>";d+='<tr><td colspan="2"><span>'+f.Comments+"</span></td></tr>";d+="</table>";d+="</div>";d+='<div class="contentFooterPad taC brBot5">Reported on: <span>'+f.DateTime+"</span> ET</div>";d+="</div>";return d};wundermap.layers.StormReports.getPrefs=function(c){return{"type.tor":this.getElementValue("type_tor","checkbox",this.options_.tor)?"1":"0","type.hail":this.getElementValue("type_hail","checkbox",this.options_.hail)?"1":"0","type.wind":this.getElementValue("type_wind","checkbox",this.options_.wind)?"1":"0"}};wundermap.layers.Severe=new wundermap.Layer();wundermap.layers.Severe.className="Severe";wundermap.layers.Severe.initialize=function(e,c){var d={name:"svr",theme:"severe_v3",sidebarPrefix:"LayerSevere",opacity:70};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_customClickResponse:a.proxy(this.customClickResponse,this),fn_getClickURL:a.proxy(this.getClickURL,this)});this.addOpacityListener()};wundermap.layers.Severe.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:this.options_.theme,proj:"automerc",format:"gif",alpha:"1",stdout:"1",rand:Math.floor((new Date()).getTime()/60000)};var d="http://wumaps.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.Severe.getClickURL=function(c){var e={profile:"wmapv3_severe",lat:c.lat(),lon:c.lng()};var d="/cgi-bin/shapeclick";d+="?"+a.param(e);return d};wundermap.layers.Severe.customClickResponse=function(k,c){var h=k.Region;var l=k.ID;var d=l.substr(0,2);var g=l.substr(2);var f;if(h=="US"){f="/US/"+d+"/"+g+".html?view=USAlertTextBubble"}else{if(h=="CANADA"){f="/severe/canada/"+l+".html?view=USAlertTextBubble"}else{f="/EU/"+d+"/"+g+".html?view=EUAlertTextBubble"}}var e=this;a.ajax({url:f,success:function(o,n){var m=wundermap.openInfoBox({content:o,position:c,styles:{height:"200px"}});google.maps.event.addListenerOnce(m,"domready",function(){a("#infobox-tabs").tabs();m.setOptions({boxStyle:{}})})},error:function(o,m,n){wui.log(m)}})};wundermap.layers.WunderPhotos=new wundermap.Layer();wundermap.layers.WunderPhotos.className="WunderPhotos";wundermap.layers.WunderPhotos.initialize=function(e,c){var d={name:"pix",sidebarPrefix:"LayerPhotos",timelord:{text:"from August 2002 to present",showTooltip:true,min:new Date(Date.UTC(2002,8-1,12)),max:new Date((new Date()).getTime()+3600*1000)},handle:"",anyDay:0,anyDate:0};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.key_="wunderphotos";this.addElementListener("anyDay","click");this.setElementValue("anyDay","checkbox",this.options_.anyDay);this.addElementListener("anyDate","click");this.setElementValue("anyDate","checkbox",this.options_.anyDate);this.addElementListener("cat","change");this.setElementValue("cat","select",this.options_.category)};wundermap.layers.WunderPhotos.getURL=function(l,r,h,q,f,s,c){var k={minlat:h,minlon:q,maxlat:l,maxlon:r,width:f,height:s,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var n=this.getElementValue("anyDay","checkbox",this.options_.anyDay);var m=this.getElementValue("anyDate","checkbox",this.options_.anyDate);if(n){var t=new Date(wundermap.userdate.getTime());t.setUTCMonth(t.getUTCMonth()+1);t.setUTCDate(0);var g=wui.date.strftime("%Y-%m-01 00:00:00",wundermap.userdate,true);var o=wui.date.strftime("%Y-%m-%d 23:59:59",t,true);k["filter.dateimage.btw"]=g+","+o}else{if(!m){k["filter.dateimage.btw"]=wui.date.strftime("%Y-%m-%d 00:00:00,%Y-%m-%d 23:59:59",wundermap.userdate,true)}else{}}var p=this.getElementValue("handle","input",this.options_.handle);if(p){k["filter.handle"]=p}var e=this.getElementValue("cat","input",this.options_.category);if(e){k["filter.category.like"]=e}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(k);return d};wundermap.layers.WunderPhotos.getDetailsURL=function(f,d){var e=f.split("-");var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.handle="+e[0]+"&id.number="+e[1];c+="&tzname="+wundermap.options.timezone["long"];return c};wundermap.layers.WunderPhotos.getBalloonContent=function(d){var c='<div class="WunderPhotosArchiveBalloon">';c+='<div class="infobox-title">WunderPhoto</div>';c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(d.city){c+='<td class="full">Location: <span>'+d.city+", "+d.state+"</span></td>"}else{c+='<td class="full">Location: <span>N/A</span></td>'}c+='<td class="nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt taC p10"><a href="/wximage/'+d.handle+"/"+d.number+'/" target="new"><img src="http://icons.wxug.com/data/wximagenew/'+d.thumb250+'" class="w250" /></a></div>';c+='<div class="borderTop p10"><a href="/wximage/'+d.handle+"/"+d.number+'/" class="b med newWin" target="new">'+d.name+"</a>";if(d.caption){c+="<div>"+d.caption+"</div>"}else{+"<div>No caption given.</div>"}c+='<div class="dataSource">Uploaded by <span class="b">'+d.handle+"</span></div></div>";c+='<div class="contentFooterPad taC brBot5">Taken on: <span>'+d.prettydate+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+d.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.WunderPhotos.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var c=this;var d=document.getElementById(this.sidebarPrefix_+"_handle");var e=document.getElementById(this.sidebarPrefix_+"_handle_go");if(d&&e){var f=google.maps.event.addDomListener(e,"click",function(){google.maps.event.trigger(c,"settings_changed");c.refresh()});this.listeners_.push(f);var f=google.maps.event.addDomListener(d,"focus",function(){a(e).removeClass("none")});this.listeners_.push(f);var f=google.maps.event.addDomListener(d,"blur",function(){google.maps.event.trigger(e,"click");a(e).addClass("none")});this.listeners_.push(f)}};wundermap.layers.WunderPhotos.getMarkerTitle=function(c){return c.title||"untitled"};wundermap.layers.WunderPhotos.getTableRowContent=function(g){var f=a("<tr></tr>");var e=a("<td></td>").appendTo(f);var d=e.clone().appendTo(f);var c=this.getImagemapAreasHref(g,0,false);e.html('<a href="'+c+'"><img src="'+wundermap.options.iconsdomain+"/data/wximagenew/"+g.thumb+'" alt="" style="width:40px;height:30px;" /></a>');d.html('<a href="'+c+'" class="b">'+g.title+'</a><br /><span class="grey">By '+g.handle+" on "+g.dateimage+"</span>");return f};wundermap.layers.Webcams=new wundermap.Layer();wundermap.layers.Webcams.className="Webcams";wundermap.layers.Webcams.initialize=function(e,c){var d={name:"cams",sidebarPrefix:"LayerWebcams",timelord:{text:"from May 2007 to present",showTooltip:true,min:new Date(Date.UTC(2007,5-1,7)),max:new Date((new Date()).getTime()+3600*1000)}};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.key_="webcams"};wundermap.layers.Webcams.getURL=function(k,q,f,o,e,r,c){var h={minlat:f,minlon:o,maxlat:k,maxlon:q,width:e,height:r,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};if(!wundermap.date||(new Date()).getTime()-wundermap.date.getTime()<3600*1000){this.key_="webcams"}else{this.key_="webcamsarchive";var n=wui.date.strftime("%Y",wundermap.userdate,true);var l=wui.date.strftime("%m",wundermap.userdate,true);var p=wui.date.strftime("%d",wundermap.userdate,true);var g=wui.date.strftime("%H",wundermap.userdate,true);if(l.charAt(0)=="0"){l=l.substr(1)}if(p.charAt(0)=="0"){p=p.substr(1)}if(g.charAt(0)=="0"){g=g.substr(1)}var m=n+"_"+l+"_"+p+"_"+g;h.key=this.key_;h.year=n;h.date=m}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(h);return d};wundermap.layers.Webcams.getDetailsURL=function(d,m){var e={key:this.key_,id:d,tzname:wundermap.options.timezone["long"]};if(this.key_=="webcamsarchive"){var k=wui.date.strftime("%Y",wundermap.userdate,true);var g=wui.date.strftime("%m",wundermap.userdate,true);var l=wui.date.strftime("%d",wundermap.userdate,true);var f=wui.date.strftime("%H",wundermap.userdate,true);if(g.charAt(0)=="0"){g=g.substr(1)}if(l.charAt(0)=="0"){l=l.substr(1)}if(f.charAt(0)=="0"){f=f.substr(1)}var h=k+"_"+g+"_"+l+"_"+f;e.year=k;e.date=h}var c="/cgi-bin/ICONBLAST?"+a.param(e);return c};wundermap.layers.Webcams.getBalloonContent=function(d){var c='<div class="WebcamsArchiveBalloon">';c+='<div class="infobox-title">Webcam</div>';c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(d.city){c+='<td class="full">Location: <span>'+d.city+", "+d.state+"</span></td>"}else{c+='<td class="full">Location: <span>N/A</span></td>'}c+='<td class="nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<table cellspacing="0" cellpadding="0" class="full grt"><tr>';c+='<td class="vaT p10"><a href="/webcams/'+d.handle+"/"+d.camindex+'/show.html" target="new"><img src="http://icons.wunderground.com'+d.image+'" class="w250" /></a></td>';c+='<td class="vaT p10 full">';c+='<div class="titleSubtleBG br3">Links</div>';c+='<div id="infoCamCal"><a href="/webcams/'+d.handle+"/"+d.camindex+'/show.html#cal" target="new">Date Lookup</a></div>';c+='<div id="infoCamVid"><a href="/webcams/'+d.handle+"/"+d.camindex+'/video.html?filename=current.mp4" target="new">Video Loop</a></div>';c+='<div id="infoCamNow"><a href="/webcams/'+d.handle+"/"+d.camindex+'/show.html" target="new">Current Image</a></div>';if(d.pwsid&&d.pwsid!="NODATA"){c+='<div id="infoCamPws"><a href="/weatherstation/WXDailyHistory.asp?ID='+d.pwsid+'" target="new">Weather Station</a></div>'}c+="</td></tr></table>";c+='<div class="contentFooterPad taC brBot5">Last updated: <span>'+d.prettydate+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+d.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.Tornado=new wundermap.Layer();wundermap.layers.Tornado.className="Tornado";wundermap.layers.Tornado.initialize=function(e,c){var d={name:"tor",sidebarPrefix:"LayerTornado",timelord:{text:"historical tornadoes from 1950, and storm reports from the past two years",showTooltip:true,min:new Date(Date.UTC(1950,0,1)),max:new Date((new Date()).getTime()+3600*1000)},show:"now"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.key_="tornado";this.addElementsListeners("show","click");this.setElementsValue("show","radiogroup",this.options_.show)};wundermap.layers.Tornado.getURL=function(m,r,k,p,f,t,c){var l={minlat:k,minlon:p,maxlat:m,maxlon:r,width:f,height:t,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,rand:Math.floor((new Date()).getTime()/60000)};var s=this.getElementsValue("show","radiogroup",this.options_.show);if(s=="cur"){}else{if(s=="sig"){l["filter.Significant"]=1}else{var o=(wundermap.userdate)?wundermap.userdate:new Date();var q=new Date(o.getTime()-3600);var h=new Date(o.getTime()+3600);var g=wui.date.strftime("%Y-%m-%d 00:00:00",q,true);var n=wui.date.strftime("%Y-%m-%d 23:59:59",h,true);l["filter.DateTime.btw"]=g+","+n}}var e="/cgi-bin/ICONBLAST";e+="?"+a.param(l);return e};wundermap.layers.Tornado.getDetailsURL=function(g,e){var f=g.split("-");var d=wui.date.strftime("%Y_%m_%d",wundermap.date,true);var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.sid="+f[1]+"&id.tid="+f[0]+"&date="+d;return c};wundermap.layers.Tornado.getMarkerTitle=function(c){return c.DateTime};wundermap.layers.Tornado.getPrefs=function(){return{show:this.getElementsValue("show","radiogroup",this.options_.show)}};wundermap.layers.Tornado.getTableRowContent=function(f){var e=a("<tr></tr>");var d=a("<td></td>").appendTo(e);var c=this.getImagemapAreasHref(f,0,false);var g="Tornado";if(b(f.FScale)>0){g="F"+f.FScale+" Tornado"}if(f.sCounty){g+=" ("+f.sCounty+")"}d.html('<a href="'+c+'">'+g+"</a><br />"+f.DateTime+" EST");return e};wundermap.layers.Tornado.getBalloonContent=function(k){var d='<div class="TornadoBalloon">';if(k.tid>0){d+='<div class="infobox-title">Tornado</div>'}else{d+='<div class="infobox-title">Storm Report</div>'}d+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(k.Title){d+='<td class="full">Location: <span>'+k.Title+"</span></td>"}else{d+='<td class="full">Location: <span>'+k.sLocation+", "+k.sState+"</span></td>"}d+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(k.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(k.lon).toFixed(2)+"</span></td></tr></table>";d+='<div class="grt p10">';d+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(k.tid>0){var f="Unknown";if(k.DateTime>"2006"){f="$"+k.Damage+" million"}else{var g=b(k.Damage);if(g==1){f="less than $50"}else{if(g==2){f="$50 to $500"}else{if(g==3){f="$500 to $5,000"}else{if(g==4){f="$5,000 to $50,000"}else{if(g==5){f="$50,000 to $500,000"}else{if(g==6){f="$500,000 to $5 million"}else{if(g==7){f="$5 million to $50 million"}else{if(g==8){f="$50 million to $500 million"}else{if(g==9){f="More than $500 million"}}}}}}}}}}var e=parseFloat(k.Length)/10;var h=parseFloat(k.Area).toFixed(2);var c=parseFloat(k.Width)*10;if(c>1320){c=(c/5280).toFixed(2)+" mi."}else{c+=" ft."}if(k.FScale=="UNK"){d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">Unknown</span></td></tr>'}else{d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">F'+k.FScale+" Tornado</span></td></tr>"}d+='<tr><td class="vaT nobr">Fatalities:</td><td class="full"><span class="b">'+k.Fatalities+"</span></td></tr>";d+='<tr><td class="vaT nobr">Injuries:</td><td class="full"><span class="b">'+k.Injuries+"</span></td></tr>";d+='<tr><td class="vaT nobr">Damage:</td><td class="full"><span class="b">'+f+"</span></td></tr>";d+='<tr><td class="vaT nobr">Path Length:</td><td class="full"><span class="b">'+e+" mi.</span></td></tr>";d+='<tr><td class="vaT nobr">Path Area:</td><td class="full"><span class="b">'+h+"</span></td></tr>";d+='<tr><td class="vaT nobr">Path Width:</td><td class="full"><span class="b">'+c+"</span></td></tr>"}if(k.sid>0){d+='<tr><td class="vaT nobr">Type:</td><td class="full"><span class="b cap">'+k.sType+"</span></td></tr>";if(k.sSize=="UNK"){d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">Unknown</span></td></tr>'}else{d+='<tr><td class="vaT nobr">Size:</td><td class="full"><span class="b">'+k.sSize+"</span></td></tr>"}if(k.sState=="LA"){d+='<tr><td class="vaT nobr">Parish:</td><td class="full"><span class="b">'+k.sCounty+"</span></td></tr>"}else{d+='<tr><td class="vaT nobr">County:</td><td class="full"><span class="b">'+k.sCounty+"</span></td></tr>"}d+='<tr><td colspan="2">'+k.sComments+"</td></tr>"}d+="</table>";d+="</div>";d+='<div class="contentFooterPad taC brBot5">Reported on: <span>'+k.DateTime+'</span> (<a href="javascript:void(0);" onclick="wundermap.layers.Tornado.setTimelord('+k.epoch+')">Sync Layers to this Date</a>)</div>';d+="</div>";return d};wundermap.layers.Tornado.setTimelord=function(c){this.setElementsValue("show","radiogroup","now");wundermap.Layer.prototype.setTimelord.call(this,c)};wundermap.layers.USGSRiver=new wundermap.Layer();wundermap.layers.USGSRiver.className="USGSRiver";wundermap.layers.USGSRiver.initialize=function(e,c){var d={title:"USGS River",name:"riv",sidebarPrefix:"LayerUSGSRiver",iconmode:"percentile",onlyAlerts:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.key_="usgsriver";this.addElementsListeners("iconmode","click");this.setElementsValue("iconmode","radiogroup",this.options_.iconmode);this.addElementListener("alt","click");this.setElementValue("alt","checkbox",this.options_.onlyAlerts)};wundermap.layers.USGSRiver.getURL=function(h,l,f,k,e,n,c){var m=this.key_;if(this.getElementsValue("iconmode","radiogroup",null)=="temperature"){m="usgsrivertemp"}var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:m,date:wui.date.strftime("%Y_%m_%d",wundermap.date,true),"display.mode":this.getElementsValue("iconmode","radiogroup",null),units:wundermap.options.units};if(this.getElementValue("alt","checkbox",this.options_.onlyAlerts)){g.extend="flood"}var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.USGSRiver.getDetailsURL=function(f,e){var d=wui.date.strftime("%Y_%m_%d",wundermap.date,true);var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+f+"&date="+d;return c};wundermap.layers.USGSRiver.getBalloonContent=function(h){var l=new Date(h.epoch*1000);var g=wui.date.strftime("%Y-%m-%d %H:00 UTC",l,true);var e=wundermap.utils;var c=wundermap.options.units;var k="";var f='<div class="USGSRiverBalloon">';f+='<div class="infobox-title">River Report</div>';f+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';f+='<td class="full"><span>'+h.name+"</span></td>";f+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(h.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(h.lon).toFixed(2)+"</span></td></tr></table>";f+='<div class="grt p10">';f+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(h.id){var m=h.id;if(m<10000000){m="0"+m}f+='<tr><td class="vaT nobr">Station ID:</td><td class="full"><a href="http://waterdata.usgs.gov/nwis/uv?'+m+'" class="newWin" target="new">'+m+"</a></td></tr>"}if(h.discharge>0){k='<span class="b">'+e.convertFlowRateIntoUnits(c,h.discharge,2)+"</span> "+e.getFlowRateUnits(c);f+='<tr><td class="vaT nobr">Flow Rate:</td><td class="full">'+k+"</td></tr>"}if(wui.defined(h.stage)){k='<span class="b">'+e.convertHeightIntoUnits(c,h.stage,2)+"</span> "+e.getHeightUnits(c);f+='<tr><td class="vaT nobr">Stage:</td><td class="full">'+k+"</td></tr>"}if(h.forecast>0){k='<span class="b">'+e.convertHeightIntoUnits(c,h.forecast,2)+"</span> "+e.getHeightUnits(c);f+='<tr><td class="vaT nobr">Forecast Stage:</td><td class="full">'+k+"</td></tr>"}if(h.flood_stage>0){k='<span class="b">'+e.convertHeightIntoUnits(c,h.flood_stage,2)+"</span> "+e.getHeightUnits(c);f+='<tr><td class="vaT nobr">Flood Stage:</td><td class="full">'+k+"</td></tr>"}if(h.percentile<=0){}else{if(h.percentile<10){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{if(h.percentile<=24){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{if(h.percentile<=75){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{if(h.percentile<=90){f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}else{f+='<tr><td class="vaT nobr">Percentile:</td><td class="full"><span class="b">'+h.percentile+"</span> %</td></tr>"}}}}}if(h.temperature>0){k='<span class="b">'+e.convertTempIntoUnits(c,h.temperature,2)+"</span> &deg;"+e.getTempUnits(c);f+='<tr><td class="vaT nobr">Temperature:</td><td class="full">'+k+"</td></tr>"}f+="</table>";if(h.noaa_graph){f+='<div class="tm10"><a href="'+h.noaa_graph+'" class="b med newWin" target="new">NOAA Flood Stage Graph</a></div>'}f+="</div>";f+='<div class="contentFooterPad taC brBot5">Last updated: <span>'+h.date+"</span></div>";f+="</div>";return f};wundermap.layers.WeatherStations=new wundermap.Layer();wundermap.layers.WeatherStations.className="WeatherStations";wundermap.layers.WeatherStations.initialize=function(e,c){var d={name:"wxsn",sidebarPrefix:"LayerWeatherStations",mode:"tw",showpws:1,tabsSelectedIndex:0,clickable:true,timelord:{text:"historic data from 1972 until present, then 10 days of forecast into the future",showTooltip:true,min:new Date(Date.UTC(1972,1-1,1)),max:new Date((new Date()).getTime()+10*24*3600*1000)}};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURLArchiveOrFuture,this),fn_getDataURL:a.proxy(this.getURLArchiveOrFuture,this),ajaxOptions:{dataType:"jsonp"},fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLArchiveOrFuture,this),fn_getDataURL:a.proxy(this.getURLArchiveOrFuture,this),ajaxOptions:{dataType:"jsonp"},fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.addMarkerLayer({fn_getURL:a.proxy(this.getURL,this),ajaxOptions:{dataType:"jsonp"},fn_getURLDataCallback:a.proxy(this.drawData,this)});this.addElementsListeners("iconmode","click");this.setElementsValue("iconmode","radiogroup",this.options_.mode);this.addElementListener("ShowHidePWS","click");this.setElementValue("ShowHidePWS","checkbox",this.options_.showpws)};wundermap.layers.WeatherStations.custom_check_dates=function(g){var e=new Date();var f=new Date(e.getTime()-1800*1000);var c=new Date(e.getTime()+3600*1000);if(g&&g>c){this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(false);this.markerlayers_[0].setDisabled(true);this.key_="wundfcthourly"}else{if(g&&g<f){this.imagelayers_[0].setDisabled(false);this.imagelayers_[1].setDisabled(true);this.markerlayers_[0].setDisabled(true);this.key_="wxsnhistory"}else{this.imagelayers_[0].setDisabled(true);this.imagelayers_[1].setDisabled(true);this.markerlayers_[0].setDisabled(false)}}this.removeDataTables()};wundermap.layers.WeatherStations.getAjaxOptions=function(){if(!this.imagelayers_[1].getDisabled()){return this.imagelayers_[1].callbacks_.ajaxOptions||{}}if(!this.imagelayers_[0].getDisabled()){return this.imagelayers_[0].callbacks_.ajaxOptions||{}}else{return{}}};wundermap.layers.WeatherStations.getURL=function(h,m,f,l,e,n,c){var g={minlat:f,minlon:l,maxlat:h,maxlon:m,width:e,height:n,iconsize:16,maxage:3600,format:"json"};var k=(this.getElementValue("ShowHidePWS","checkbox",this.options_.showpws))?1:0;if(k==0){g.type="ICAO,BUOY,SYNOP"}var d="http://stationdata.wunderground.com/cgi-bin/stationdata";d+="?"+a.param(g);return d};wundermap.layers.WeatherStations.getURLArchiveOrFuture=function(h,m,f,l,e,n,c){var c=c||{};var g={minlat:f,minlon:l,maxlat:h,maxlon:m,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,date:wui.date.strftime("%Y%m%d%H",wundermap.date,true),year:wui.date.strftime("%Y",wundermap.date,true),month:wui.date.strftime("%m",wundermap.date,true),"display.mode":this.getElementsValue("iconmode","radiogroup",this.options_.mode),units:wundermap.options.units};var k=(this.getElementValue("ShowHidePWS","checkbox",this.options_.showpws))?1:0;if(k==0){g["filter.type.any"]="icao,buoy,synop"}var d="http://timelord.wunderground.com/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.WeatherStations.getDetailsURL=function(f,e){var d=wui.date.strftime("%Y%m%d%H",wundermap.date,true);var c="http://timelord.wunderground.com/cgi-bin/ICONBLAST?key="+this.key_+"&id="+f+"&date="+d+"&year="+wui.date.strftime("%Y",wundermap.date,true)+"&month="+wui.date.strftime("%m",wundermap.date,true);return c};wundermap.layers.WeatherStations.drawData=function(h){var l=h.conds;var e=0;var k=this.getElementsValue("iconmode","radiogroup",this.options_.mode);var g=this.markerlayers_[0];g.removeOverlays();for(var d in l){e++;var f=l[d];var c=this.drawStation(f,g,k);if(c==-1){delete l[d]}}this.displayDataTable(l,22,{})};wundermap.layers.WeatherStations.drawStation=function(s,r,q){var f=s.id;var o=s.lat;var e=s.lon;var p=(s.type)?s.type.toUpperCase():"";var n=!!(this.options_.clickable);if((o<0.2&&o>-0.2)&&(e<0.2&&e>-0.2)){return -1}var g=wundermap.utils;if(q=="tdh"&&!g.isValidMeasurement(s.dewptf)){return -1}else{if(q=="r"&&!g.isValidMeasurement(s.dailyrainin)){}else{if(!g.isValidMeasurement(s.tempf)){return -1}}}var k=s.neighborhood;if(f.indexOf("WMO")!=-1){f=f.substr(3)}if(k&&k.indexOf("The ")==0){k=k.substr(4)}if(f.indexOf("M")==0){}var d=k;if(p=="PWS"){if(k==""||k=="NULL"){d=s.adm1}}else{d=s.name}var h=d.substring(0,22);a.extend(true,s,{id:f,type:p,name:d,nameShort:h,neighborhood:k});var c=this.makeIcon(s,q);var m=new google.maps.LatLng(o,e);var l=new google.maps.Marker({clickable:n,icon:c[0],map:wundermap.map,position:m,shadow:c[1],title:d});var t=this;if(n){google.maps.event.addListener(l,"click",function(u){wundermap.openInfoBox({title:d,tabs:[{title:LANG["kLang.DateTime.Current"],content:t.getBalloonContent(s,q)},{title:LANG["kLang.Forecast.WeatherForecast"],content:t.getBalloonContentForecast(s,q)},{title:"Graph",content:t.getBalloonContentGraph(s,q)}],tabsOptions:{selected:t.options_.tabsSelectedIndex,select:function(v,w){t.options_.tabsSelectedIndex=w.index}},footer:t.getBalloonContentFooter(s,q),marker:this})});s.marker=l}r.addMarker(l)};wundermap.layers.WeatherStations.makeIcon=function(m,l){var e=wundermap.utils;var g=wundermap.options.units;var f=m.weather;var n=null;var h=(m.type)?m.type.toUpperCase():"";if(f&&f.length&&e.isValidMeasurement(f)&&l=="tw"&&h!="PWS"){var d=87;var o=64}else{f="";var d=64;var o=64;n=new google.maps.MarkerImage("http://stationicon.wunderground.com/gmapshadow.png",new google.maps.Size(d,o),null,new google.maps.Point(d/2,o/2))}var c="http://stationicon.wunderground.com/cgi-bin/gmapicon?"+a.param({mode:l,shemi:(m.lat<0)?1:0,tu:e.convertTempIntoUnits(g,m.tempf),t:m.tempf,wsu:e.convertWindIntoUnits(g,m.windspeedmph),ws:m.windspeedmph,wd:m.winddir,tdu:e.convertTempIntoUnits(g,m.dewptf),td:m.dewptf,h:m.humidity,ru:e.convertRainIntoUnits(g,m.dailyrainin),r:m.dailyrainin,wx:f,format:".png"});var k=new google.maps.MarkerImage(c,new google.maps.Size(d,o),null,new google.maps.Point(d/2,o/2));return[k,n]};wundermap.layers.WeatherStations.appendMadis=function(c){return c+" (<a href='http://madis.noaa.gov/'>MADIS</a>)"};wundermap.layers.WeatherStations.getStationURL=function(m,l){var d=m.id;var g=(m.type)?m.type.toUpperCase():"";var c="";var e="";var k,h,f;if(!wundermap.date||(new Date()).getTime()<wundermap.date.getTime()){e=wui.date.strftime("%Y/%m/%d");k=wui.date.strftime("%d");h=wui.date.strftime("%Y");f=wui.date.strftime("%m")}else{e=wui.date.strftime("%Y/%m/%d",wundermap.date);k=wui.date.strftime("%d",wundermap.date);h=wui.date.strftime("%Y",wundermap.date);f=wui.date.strftime("%m",wundermap.date)}if(g=="ICAO"){c="/history/airport/"+d+"/"+e+"/DailyHistory.html"}else{if(g=="SYNOP"){c="/history/station/"+d+"/"+e+"/DailyHistory.html"}else{if(g=="BUOY"){var n=d.substr(4);c="/MAR/buoy/"+n+".html"}else{if(g=="PWS"||g=="MADIS"){c="/weatherstation/WXDailyHistory.asp?ID="+d+"&day="+k+"&month="+f+"&year="+h}else{c="/history/airport/"+d+"/"+e+"/DailyHistory.html"}}}}return c};wundermap.layers.WeatherStations.getBalloonContentTitle=function(h,l){var d=wundermap.utils;var c=wundermap.options.units;var k=d.convertHeightIntoUnits(c,h.elev)+" "+d.getHeightUnits(c);var g=(h.type)?h.type.toUpperCase():"";var e=this.getStationURL(h,l);var f='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(e){f+='<td class="full">Station ID: <a href="'+e+'" target="_blank">'+h.id+"</a></td>"}else{f+='<td class="full">Station ID: <span>'+h.id+"</span></td>"}f+='<td class="nobr dtr">Lat: <span>'+parseFloat(h.lat).toFixed(2)+'</span></td><td class="nobr dtr">Lon: <span>'+parseFloat(h.lon).toFixed(2)+"</span></td>";if(g=="BUOY"){f+='<td class="nobr">Elev: <span>0</span></td>'}else{f+='<td class="nobr">Elev: <span>'+k+"</span></td>"}f+="</tr></table>";return f};wundermap.layers.WeatherStations.getBalloonContent=function(p,o){var h="";var f=wundermap.utils;var l=wundermap.options.units;var m=(p.type)?p.type.toUpperCase():"";if(!o){h+='<div class="infobox-title">'+p.name+"</div>"}h+=this.getBalloonContentTitle(p,o);var d="";h+='<table cellspacing="0" cellpadding="0" class="infoTable borderTop grt"><tr><td class="vaT dtr"><div id="nowCond"><div class="titleSubtle bm10">Conditions</div>';if(typeof p.icon=="undefined"||p.icon=="-999"){p.icon="unknown"}if(!p.weather||p.weather=="-999"){p.weather="Sky conditions not available for this station."}h+='<div id="curIcon"><img src="'+wundermap.options.iconsdomain+"/i/c/k/"+p.icon+'.gif" class="condIcon" /></a></div><div id="curCond">'+p.weather+'</div><div class="clear"></div></div></td><td class="vaT dtr">  <div id="nowTemp">    <div class="titleSubtle bm10">'+LANG["kLang.Stats.Temp.Temperature"]+"</div>";d=f.convertTempIntoUnits(l,p.tempf)+' <span class="tempUnit">&deg;'+f.getTempUnits(l)+"</span>";h+='<div id="tempActual">'+d+"</div>";if(p.windchillf>-99){d=f.convertTempIntoUnits(l,p.windchillf)+" &deg;"+f.getTempUnits(l)+""}else{if(p.heatindexf>-99){d=f.convertTempIntoUnits(l,p.heatindexf)+" &deg;"+f.getTempUnits(l)+""}else{d=f.convertTempIntoUnits(l,p.tempf)+" &deg;"+f.getTempUnits(l)+""}}h+='    <div id="tempFeel">'+LANG["kLang.Conditions.Titles.FeelsLike"]+" "+d+"</div>  </div></td>";if(p.windspeedmph==0){d='<span class="b">'+LANG["kLang.Conditions.Normal.Calm"]+"</span>"}else{d='<span class="b">'+f.lookupWindString(p.winddir)+'</span> at <span class="b">'+f.convertWindIntoUnits(l,p.windspeedmph)+"</span> "+f.getWindUnits(l)}var c="0px top";if(f.isValidMeasurement(p.winddir)){var g=b(p.winddir);while(g>=360){g-=360}while(g<0){g+=360}var k=62;var c=(-1*g*k)+"px top"}h+='<td class="vaT">  <div id="nowWind">    <div class="titleSubtle">'+LANG["kLang.Stats.Wind.Wind"]+'</div>    <div id="windCompassContainer">      <span id="windCompass" class="pwsrt" pwsid="'+p.id+'" pwssetobject="winddir" pwsunit="" pwsvariable="winddir" english="" metric="" value="'+p.winddir+'" style="background-position:'+c+'"></span>      <span id="windCompassSpeed" class="pwsrt" pwsid="'+p.id+'" pwsunit="" pwsvariable="windspeedmph" english="" metric="">'+d+"</span>    </div>  </div></td></tr></table>";if(m=="BUOY"){h+='<div class="grt p10">';h+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';d='<span class="b">'+f.convertPressureIntoUnits(l,p.baromin)+"</span> "+f.getPressureUnits(l);h+="<tr><td>"+LANG["kLang.Stats.Misc.Pressure"]+":</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertTempIntoUnits(l,p.sstf)+"</span> &deg;"+f.getTempUnits(l);h+="<tr><td>Sea Surface Temperature:</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertHeightIntoUnits(l,p.domwaveheightft)+"</span> "+f.getHeightUnits(l);h+="<tr><td>Dom Wave Height:</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertWaveperiodIntoUnits(l,p.domwaveperiods)+"</span> s";h+="<tr><td>Dom Wave Period:</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertHeightIntoUnits(l,p.windwaveheightft)+"</span> "+f.getHeightUnits(l);h+="<tr><td>Wind Wave Height:</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertWaveperiodIntoUnits(l,p.windwaveperiods)+"</span> s";h+="<tr><td>Wind Wave Period:</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertHeightIntoUnits(l,p.swellwaveheightft)+"</span> "+f.getHeightUnits(l);h+="<tr><td>Swell Wave Height:</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertWaveperiodIntoUnits(l,p.swellwaveperiods)+"</span> s";h+="<tr><td>Swell Wave Period:</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertWavedirIntoUnits(l,p.swellwavedir)+"</span> &deg;";h+="<tr><td>Swell Wave Dir:</td><td>"+d+"</td></tr>";h+="</table>";h+="</div>"}else{h+='<table cellspacing="0" cellpadding="0" class="full borderTop bm10">';h+="<tr>";h+='<td class="third vaT dtr">';h+='<table cellspacing="0" cellpadding="0" class="infoTable">';h+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Moisture</div></td></tr>';d='<span class="b">'+f.convertTempIntoUnits(l,p.dewptf)+"</span> &deg;"+f.getTempUnits(l);h+="<tr><td>"+LANG["kLang.Misc.DewPoint"]+":</td><td>"+d+"</td></tr>";d=p.humidity;if(!f.isValidMeasurement(d)||d=="N/A"){d="-"}d='<span class="b">'+d+"</span>%";h+="<tr><td>"+LANG["kLang.Stats.Misc.Humidity"]+":</td><td>"+d+"</td></tr>";h+="</table>";h+="</td>";h+='<td class="third vaT dtr">';h+='<table cellspacing="0" cellpadding="0" class="infoTable">';h+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Precipitation</div></td></tr>';d='<span class="b">'+f.convertRainIntoUnits(l,p.rainin)+"</span> "+f.getRainUnits(l);h+="<tr><td>"+LANG["kLang.Stats.Misc.Precipitation"]+":</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertRainIntoUnits(l,p.dailyrainin)+"</span> "+f.getRainUnits(l);h+="<tr><td>Daily Precip.:</td><td>"+d+"</td></tr>";h+="</table>";h+="</td>";h+='<td class="third vaT">';h+='<table cellspacing="0" cellpadding="0" class="infoTable">';h+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Conditions</div></td></tr>';d='<span class="b">'+f.convertPressureIntoUnits(l,p.baromin)+"</span> "+f.getPressureUnits(l);h+="<tr><td>"+LANG["kLang.Stats.Misc.Pressure"]+":</td><td>"+d+"</td></tr>";d='<span class="b">'+f.convertPressureIntoUnits(l,p.visibilitysm)+"</span> "+f.getPressureUnits(l);h+="<tr><td>"+LANG["kLang.Stats.Misc.Visibility"]+":</td><td>"+d+"</td></tr>";h+="</table>";h+="</td>";h+="</tr>";h+="</table>"}if(wui.defined(p.Road1Tempf)){h+='<table cellspacing="0" cellpadding="0" class="infoTable bm10">';h+='<tr><td colspan="2"><div class="titleSubtleBG br3 m0">Road Conditions</div></td></tr>';var n=f.getTempUnits(l);if(wui.defined(p.Road1Tempf)){d=f.convertTempIntoUnits(l,p.Road1Tempf)+" &deg;"+n+", "+p.Road1State;h+="<tr><td>Road1:</td><td>"+d+"</td></tr>"}if(wui.defined(p.Road2Tempf)){d=f.convertTempIntoUnits(l,p.Road2Tempf)+" &deg;"+n+", "+p.Road2State;h+="<tr><td>Road2:</td><td>"+d+"</td></tr>"}if(wui.defined(p.Road3Tempf)){d=f.convertTempIntoUnits(l,p.Road3Tempf)+" &deg;"+n+", "+p.Road3State;h+="<tr><td>Road3:</td><td>"+d+"</td></tr>"}h+="</table>"}if(p.roadtrip&&p.roadtrip.interesting){h+='<table cellspacing="0" cellpadding="0" class="full infoTable borderTop">';h+="<tr>";h+='<td class="vaT">';h+='<div class="titleSubtle bm10">Comments:</div>';h+="<ul>";var e=p.roadtrip.interesting;if(e.belowFreezing){h+="<li>below freezing</li>"}if(e.dropBelowFreezing){h+="<li>drop below freezing</li>"}if(e.strongWinds){h+="<li>strong winds</li>"}if(e.beginStrongWinds){h+="<li>begin strong winds</li>"}h+="</ul>";h+="</td>";h+="</tr>";h+="</table>"}return h};wundermap.layers.WeatherStations.getBalloonContentFooter=function(d,e){var c='<div class="contentFooterPad taC brBot5"><a href="/cgi-bin/findweather/getForecast?query='+d.lat+","+d.lon+"&sp="+d.id+'">Visit local weather page for '+d.adm1+", "+d.adm2+"</a></div>";return c};wundermap.layers.WeatherStations.getBalloonContentForecast=function(e,f){var d="";d+=this.getBalloonContentTitle(e,f);d+='<div class="borderTop grt">';var c="/stationmaps/gMapForecast.asp?query="+e.lat+","+e.lon;if(wundermap.options.brand){c+="&brand="+wundermap.options.brand}if(this.debug_==1){wui.log(c)}d+='<iframe src="'+c+'" height="200" width="100%" scrolling="auto" frameborder="0" class="tm5" />';d+="</div>";return d};wundermap.layers.WeatherStations.getBalloonContentGraph=function(h,l){var e="";var g=(h.type)?h.type.toUpperCase():"";e+=this.getBalloonContentTitle(h,l);e+='<div class="borderTop">';var d="http://www.wunderground.com";if(g=="ICAO"||g=="SYNOP"){var f=wui.date.strftime("%Y");var k=wui.date.strftime("%m");var c=wui.date.strftime("%d");d+="/cgi-bin/histGraphAll?day="+c+"&year="+f+"&month="+k+"&ID="+h.id}else{if(g=="PWS"){d+="/cgi-bin/wxStationGraphAll?ID="+h.id}else{d=""}}if(d){if(l=="tdh"){d+="&type=3&showtemp=1&showtitle=0&width=414"}else{if(l=="r"){d+="&type=3&showrain=1&showtitle=0&width=414"}else{d+="&type=3&showtemp=1&showtitle=0&width=414"}}if(this.debug_==1){wui.log(d)}e+='<div class="tm10 bm10"><img src="'+d+'" class="infoPaneGraph" /></div>'}e+="</div>";return e};wundermap.layers.WeatherStations.getTableHeadContent=function(g){var f=a("<tr></tr>");var e=a('<th title="Sort by Place">'+LANG["kLang.Misc.Place"]+"</th>");var d=a('<th title="Sort by Station">Station</th>');var c=a("<th></th>");f.append(e).append(d).append(c);if(g=="r"){c.html("Daily Rainfall");c.attr("title","Sort by Daily Rainfall")}else{if(g=="tdh"){c.html(LANG["kLang.Misc.DewPoint"]);c.attr("title","Sort by Dew Point")}else{c.html(LANG["kLang.Stats.Temp.Temp"]);c.attr("title","Sort by Temperature")}}return f};wundermap.layers.WeatherStations.getTableRowContent=function(p,o){var m=a("<tr></tr>");var k=a("<td></td>");var g=k.clone();var f=k.clone().addClass("nobr");m.append(k).append(g).append(f);var n=(p.type)?p.type.toUpperCase():"";var d="";if(n=="PWS"){d=p.nameShort}if(!d){d=p.name}if(!d){d=p.id}k.html(d);if(p.name){k.attr("title",p.name)}var c=this.getStationURL(p,o);if(c){g.html('<a href="'+c+'" class="nu" target="_blank">'+p.id+"</a>")}else{g.html(id)}var h=wundermap.utils;var l=wundermap.options.units;var e="";if(o=="r"){e='<span class="b">'+h.convertRainIntoUnits(l,p.dailyrainin)+"</span> "+h.getRainUnits(l);f.html(e)}else{if(o=="tdh"){e='<span class="b">'+h.convertTempIntoUnits(l,p.dewptf)+"</span> &deg;"+h.getTempUnits(l);f.html(e)}else{e='<span class="b">'+h.convertTempIntoUnits(l,p.tempf)+"</span> &deg;"+h.getTempUnits(l);f.html(e)}}if(!o&&p.id){var q=this;m.bind("click",function(){q.getDetails(p.id)})}return m};wundermap.layers.WeatherStations.getPrefs=function(c){return{mode:this.getElementsValue("iconmode","radiogroup",this.options_.mode)}};wundermap.layers.Ski=new wundermap.Layer();wundermap.layers.Ski.className="Ski";wundermap.layers.Ski.initialize=function(f,c){var e={name:"ski",sidebarPrefix:"LayerSki",hour:0,type:""};c=a.extend(true,{},e,c);wundermap.Layer.prototype.initialize.call(this,f,c);this.key_="ski";this.addImageLayer({fn_getURL:a.proxy(this.getURLPowder,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),getURL_opts:{hasDetailedResults:true},fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.addOpacityListener();var d=b(this.findId("epoch").text())*1000;this.addSliderListener("hour",{min:0,max:96,step:24,value:this.options_.hour});this.addElementsListeners("type","click");this.setElementsValue("type","radiogroup",this.options_.type)};wundermap.layers.Ski.getURLPowder=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,model:"SNLR",script:"SNLR"+this.getElementsValue("type","checkboxgroup",""),hour:this.getElementValue("hour_slider","slider","0"),modelrun:"0000000000"};var d="http://modelmaps.wunderground.com/php/run.php";d+="?"+a.param(g);return d};wundermap.layers.Ski.getPrefs=function(){return{opa:this.getElementValue("opacity_slider","slider",null),hour:this.getElementValue("hour_slider","slider",null),mode:this.getElementsValue("type","radiogroup",null)}};wundermap.layers.Ski.getMarkerTitle=function(c){return c.name};wundermap.layers.Ski.getClusterTitle=function(c){return c.clustercount+" ski locations near here"};wundermap.layers.Ski.getBalloonContent=function(e){var d='<div class="'+this.className+'Balloon">';d+='<div class="infobox-title">'+e.name+"</div>";d+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';for(var c in e){if(a.inArray(c,["name","rect"])>-1){continue}d+="<tr><td>"+c+":</td><td>"+e[c]+"</td></tr>"}d+="</table>";d+="</div>";return d};wundermap.layers.RideTheStorm=new wundermap.Layer();wundermap.layers.RideTheStorm.className="RideTheStorm";wundermap.layers.RideTheStorm.initialize=function(e,c){var d={name:"mitsubishi",sidebarPrefix:"LayerRideTheStorm"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="mitsubishi";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.RideTheStorm.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.DATEUTC.lt":wui.date.strftime("%Y-%m-%d %H:00:00",wundermap.date,true)};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.RideTheStorm.getMarkerTitle=function(c){return c.DATEUTC};wundermap.layers.RideTheStorm.getImagemapAreasHref=function(e,d,c){return"javascript:wundermap.layers."+this.className+".getDetails(['"+e.id+"','"+e.DATEUTC+"'],0)"};wundermap.layers.RideTheStorm.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.ID="+e[0]+"&id.DATEUTC="+e[1];return c};wundermap.layers.Traffic=new wundermap.Layer();wundermap.layers.Traffic.className="Traffic";wundermap.layers.Traffic.initialize=function(f,c){var e={name:"tfk",sidebarPrefix:"LayerTraffic"};c=a.extend(true,{},e,c);wundermap.Layer.prototype.initialize.call(this,f,c);var d=new google.maps.TrafficLayer();google.maps.event.addListener(this,"layertoggled",function(g){if(g){d.setMap(this.map_)}else{d.setMap(null)}})};wundermap.layers.ModelData=new wundermap.Layer();wundermap.layers.ModelData.className="ModelData";wundermap.layers.ModelData.initialize=function(f,d){var e={name:"mm",sidebarPrefix:"LayerModelData",timelord:{text:"from present until 378 hours in the future",showTooltip:true,triggerRefresh:false,max:new Date((new Date()).getTime()+378*3600*1000)},title:"Model Data",opacity:70,maxClkObjects:10,subdomain:"",model:"GFS",maptype:"500",hour:"0",modelrun:"node_0",showTimestamp:true};d=a.extend(true,{},e,d);wundermap.Layer.prototype.initialize.call(this,f,d);var c=this;this.addOpacityListener();this.addSliderListener("hour",{min:0,max:0,value:this.options_.hour,slide:function(g,h){c.handleHourMoveChange(h.value)},change:function(g,h){c.handleHourMoveChange(h.value);c.handleHourMoveComplete(h.value)}});this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.setDisabled(true);this.periodEpochs=[];this.modelrunEpoch=0;this.hourEpoch=0;this.hourEpochSave=null;this.hourStringSave=null;this.config=null;this.requestConfigInterval=600*1000;this.requestConfigLastUpdate=null;this.clickBehavior="0";this.clkObjects=[];this.clkListeners=[];this.incompleteCrossSection=-1;this.isDraggingMarker=0;this.numClkObjects=0;if(this.options_.showTimestamp){wundermap.addHTMLControl({container:a('<div id="'+this.sidebarPrefix_+'_date" class="'+this.sidebarPrefix_+'_maptitle"></div>'),index:3,position:google.maps.ControlPosition.TOP_LEFT,styles:{display:"none",margin:"5px",width:"auto"}})}google.maps.event.addListener(this,"layertoggled",function(g){if(g){c.checkRequestConfig();a(document).bind("keydown."+c.sidebarPrefix_,function(k){c.handleKeystroke(k)});var h=(c.config==null);if(!h){c.handleConfigSuccess()}if(!c.disabled_&&!c.disabled_by_timelord_){c.findId("date").show()}}else{a(document).unbind("."+c.sidebarPrefix_);c.closePopouts();c.removeClkObjects();c.findId("date").hide()}})};wundermap.layers.ModelData.custom_check_dates=function(g){var e=this.findId("hour_slider");var f=g.getTime()/1000;var c=wundermap.utils.indexOfClosest(this.periodEpochs,f);if(c>=0){e.slider("value",c)}else{this.hourEpoch=f}};wundermap.layers.ModelData.getPrefs=function(c){var d={mdl:this.getModel(),type:this.getMaptype(),hour:this.getHour(),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)};return d};wundermap.layers.ModelData.getURL=function(k,m,f,l,e,n,c){var g={maxlat:k,maxlon:m,minlat:f,minlon:l,width:e,height:n,model:this.getModel(),script:this.getMaptype(),hour:this.getHour(),modelrun:this.getModelrunInitReadable()};this.findId("date").show().text(this.hourStringSave);var h=this.options_.subdomain||"modelmaps";var d="http://"+h+".wunderground.com/php/run.php?"+a.param(g);return d};wundermap.layers.ModelData.getURLConfig=function(){var c="/stationmaps/gmap_modeldata.asp";if(this.options_.subdomain){c+="?server="+this.options_.subdomain}return c};wundermap.layers.ModelData.requestConfig=function(){var d=this.getURLConfig();var c=this;a.ajax({url:d,dataType:"json",success:function(f,e){var g=(c.config==null);c.config=f;if(!f){google.maps.event.trigger(c,"loaderror","empty or invalid config file")}else{if(f.ERROR){google.maps.event.trigger(c,"loaderror","error reading config file: "+jsonObj.ERROR)}else{c.handleConfigSuccess({firstTime:g,refresh:true})}}},error:function(h,f,g){google.maps.event.trigger(c,"loaderror","failed to load config file")}});if(this.debug_>0){wui.log(d)}};wundermap.layers.ModelData.handleConfigSuccess=function(c){var c=c||{};this.requestConfigLastUpdate=new Date();this.setDisabled(true);if(c.firstTime){this.populateModelOptions();this.populateMaptypeOptions()}this.populateModelrunOptions();this.populateHourOptions({firstTime:c.firstTime});if(this.disabled_by_timelord_){this.disabled_=false}else{this.setDisabled(false)}if(c.refresh){this.refresh()}};wundermap.layers.ModelData.checkRequestConfig=function(){if(!this.initialized_){return}var c=new Date();if(!this.requestConfigLastUpdate||this.requestConfigLastUpdate.getTime()<c.getTime()-10*60*1000){this.requestConfig()}};wundermap.layers.ModelData.refresh=function(c){this.checkRequestConfig();wundermap.Layer.prototype.refresh.call(this,c)};wundermap.layers.ModelData.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var c=this;var d=this.findId("model")[0];if(d){var f=google.maps.event.addDomListener(d,"change",function(){c.populateMaptypeOptions();c.populateModelrunOptions();c.populateHourOptions({useSaved:true})});this.listeners_.push(f)}var d=this.findId("maptype")[0];if(d){var f=google.maps.event.addDomListener(d,"change",function(){c.updateMaptypeDescription();google.maps.event.trigger(c,"settings_changed");c.refresh()});this.listeners_.push(f)}var d=this.findId("modelrun")[0];if(d){var f=google.maps.event.addDomListener(d,"change",function(){c.modelrunEpoch=c.getModelrunInitEpoch();c.populateHourOptions({useSaved:true})});this.listeners_.push(f)}this.animateStart=this.findId("animate_start");this.animateStop=this.findId("animate_stop");var e=this.findId("hour_slider");if(this.animateStart[0]&&this.animateStop[0]&&e[0]){var f=google.maps.event.addDomListener(this.animateStart[0],"click",function(){c.setAnimationLoopToggle(true)});this.listeners_.push(f);var f=google.maps.event.addDomListener(this.animateStop[0],"click",function(){c.setAnimationLoopToggle(false)});this.listeners_.push(f)}var f=google.maps.event.addListener(this.map_,"click",function(g){c.handleMapClick(g)});this.listeners_.push(f);var f=google.maps.event.addListener(this,"tabsshow",function(g){var h=g.panel.id;if(h==c.sidebarPrefix_+"_displayArea"){c.clickBehavior="1"}else{if(h==c.sidebarPrefix_+"_displayArea2"){c.clickBehavior="2"}else{c.clickBehavior="0"}}});this.listeners_.push(f);var f=google.maps.event.addListener(this.map_,"mousemove",function(h){if(this.disabled_||this.disabled_by_timelord_){return}if(c.clickBehavior=="2"&&c.incompleteCrossSection>=0&&!c.isDraggingMarker){var g=c.clkObjects[c.incompleteCrossSection];if(!g||!g.marker1){return}var k=g.marker1.getPosition();var l=h.latLng;c.adjustCrossSectionLine(g,k,l,1);if(!g.line){g.line=c.makeCrossSectionLine(g,l)}}});this.listeners_.push(f);var f=google.maps.event.addDomListener(window,"beforeunload",function(g){c.closePopouts()});this.listeners_.push(f)};wundermap.layers.ModelData.handleMapClick=function(h){var f=h.latLng;var g=this.clkObjects.length;var l=this.options_.maxClkObjects;var k=this.clickBehavior;var n=this;if(this.disabled_||this.disabled_by_timelord_){return}if(this.numClkObjects>=l){google.maps.event.trigger(this,"loaderror","Maximum of "+l+" profiles or cross sections at a time, please close some to continue.");return}else{if(k=="1"){this.numClkObjects++;var m="Skew-T: "+(g+1);var d={marker1:new google.maps.Marker({clickable:true,draggable:true,map:this.map_,position:f,raiseOnDrag:false,title:m}),index:g,container:a("<p></p>"),img:a("<img></img>"),isLoaded:false,popout:null,popoutUrl:"",popoutImg:null,type:"profile"};this.clkObjects[g]=d;google.maps.event.addListener(d.marker1,"dragend",function(o){n.profileRequest(d)});this.profileRequest(d)}else{if(k=="2"&&this.incompleteCrossSection>=0){this.numClkObjects++;var c=this.clkObjects[this.incompleteCrossSection];var m="Cross Section: "+(c.index+1);c.marker2=new google.maps.Marker({clickable:true,draggable:true,map:this.map_,position:f,raiseOnDrag:false,title:m});this.snapToLine(c.marker1,c.marker2);if(!c.line){c.line=this.makeCrossSectionLine(c)}google.maps.event.addListener(c.marker1,"dragend",function(o){n.crossSectionDragEnd(c,1)});google.maps.event.addListener(c.marker2,"dragend",function(o){n.crossSectionDragEnd(c,2)});google.maps.event.addListener(c.marker1,"drag",function(o){var p=c.marker2.getPosition();n.adjustCrossSectionLine(c,p,o.latLng,0)});google.maps.event.addListener(c.marker2,"drag",function(o){var p=c.marker1.getPosition();n.adjustCrossSectionLine(c,p,o.latLng,1)});this.incompleteCrossSection=-1;this.isDraggingMarker=0;this.crossSectionRequest(c)}else{if(k=="2"){var m="Cross Section: "+(g+1);var c={marker1:new google.maps.Marker({clickable:true,draggable:true,map:this.map_,position:f,raiseOnDrag:true,title:m}),marker2:null,line:null,index:g,container:a("<p></p>"),img:a("<img></img>"),isLoaded:false,popout:null,popoutUrl:"",popoutImg:null,type:"crossSection"};this.clkObjects[g]=c;this.incompleteCrossSection=g;google.maps.event.addListener(c.marker1,"dragstart",function(o){if(n.incompleteCrossSection==g){n.isDraggingMarker=1;if(c.line){c.line.setMap(null);c.line=null}}});google.maps.event.addListener(c.marker1,"dragend",function(o){n.isDraggingMarker=0})}}}}};wundermap.layers.ModelData.setAnimationLoopToggle=function(c){if(this.disabled_||this.disabled_by_timelord_){return}this.setAnimateToggle(c);var e=1000;if(this.animateTimer){window.clearTimeout(this.animateTimer);this.animateTimer=null}if(c){var d=this;var f=this.findId("hour_slider");this.animateTimer=window.setInterval(function(){if(d.loading_||d.disabled_||d.disabled_by_timelord_||!d.active_){window.clearTimeout(d.animateTimer);d.animateTimer=null;return}var h=f.slider("value");var g=f.slider("option","max");h=(h<g)?(h+1):0;f.slider("value",h)},e)}};wundermap.layers.ModelData.populateModelOptions=function(){var h=this.findId("model");for(var e in this.config.MODEL){var d=e;var g=d;var f=(d==this.options_.model)?true:false;var c=new Option(g,d,f,f);h[0].options[h[0].length]=c}};wundermap.layers.ModelData.populateMaptypeOptions=function(){var e=this.findId("maptype");var h=this.getModel();var f=this.getMaptype();var c=this.config.MODEL[h].MAP;e[0].length=0;this.maptypeKeyLookup={};for(var g in c){var m=c[g].key;var l=c[g].abbreviation||m;var k=(m==f)?true:false;var d=new Option(l,m,k,k);e[0].options[e[0].length]=d;this.maptypeKeyLookup[m]=g}this.updateMaptypeDescription()};wundermap.layers.ModelData.populateModelrunOptions=function(){var e=this.findId("modelrun");var g=this.getModel();var d=this.config.MODEL[g].modelrun;var v=this.modelrunEpoch;var k=-1;var o=false;var p=0;var r=[];for(var l in d){var w=d[l];if(w.initialization&&w.initialization.epoch){r.push({key:l,value:w})}else{var f="Missing initialization.epoch for "+g+" modelrun: "+l;google.maps.event.trigger(this,"loaderror",f)}}r.sort(function(z,y){return b(z.value.initialization.epoch)-b(y.value.initialization.epoch)});r.reverse();if(v){var n=[];for(var q=0;q<r.length;q++){n.push(b(r[q].value.initialization.epoch,10))}k=wundermap.utils.indexOfClosest(n,v)}e[0].length=0;for(var q=0;q<r.length;q++){var t=r[q].value.initialization.epoch;var h=r[q].value.finished;if(h!="1"){o=true;p+=1}var s=false;if(k>=0){if(q==k){s=true}}else{if(q==p){s=true}}var u=wui.date.strftime("%a, %d %b, %H:%M GMT",new Date(t*1000),true);var x=u;var c=new Option(x,r[q].key,s,s);e[0].options[e[0].length]=c}this.modelrunEpoch=this.getModelrunInitEpoch();var m=this.findId("unfinished");if(o){m.html("unfinished modelrun available")}else{m.empty()}};wundermap.layers.ModelData.populateHourOptions=function(d){var d=d||{};var s=d.useSaved||false;var c=d.firstTime||false;var n=this.getModel();var f=this.getModelrun();var m=this.config.MODEL[n].modelrun[f];if(!m){google.maps.event.trigger(this,"loaderror","invalid modelrun name: "+f);return}var r=this.hourEpoch;var k=this.hourEpochSave;var o=0;this.periods=[];for(var h in m.period){var p=m.period[h];if(p.exists=="1"){this.periods.push(p)}}this.periods.sort(function(u,t){return b(u.period)-b(t.period)});this.periodEpochs=[];for(var h in this.periods){var p=this.periods[h];this.periodEpochs.push(parseInt(p.valid,10))}if(s&&this.hourEpochSave){o=wundermap.utils.indexOfClosest(this.periodEpochs,this.hourEpochSave)}else{if(r){o=wundermap.utils.indexOfClosest(this.periodEpochs,r)}else{if(c){var q=this.options_.hour;q=parseInt(q,10);if(q>0){for(var l=0;l<this.periods.length;l++){if(this.periods[l].hour==q){o=l;break}}}}}}var e=this.findId("hour_slider");var g=this.getElementValue("hour_slider","slider",this.options_.hour);e.slider("option","max",this.periods.length-1);e.slider("value",o);if(o==g){}if(s){if(k){this.hourEpochSave=k}else{this.hourEpochSave=r}}};wundermap.layers.ModelData.calculateHour=function(c){try{this.hour=parseInt(this.periods[c].hour,10)}catch(d){this.hour=0}};wundermap.layers.ModelData.getHourString=function(g,f){try{this.hourEpoch=parseInt(this.periods[g].valid,10);var h=this.hourEpoch;var f=f||{};var c=(f.local!==true);var d=wui.date.strftime("%a, %d %b, %H:%M GMT",new Date(h*1000),c);return d}catch(k){return"unknown"}};wundermap.layers.ModelData.getModelrunInitReadable=function(){try{var c=this.getModel();var g=this.getModelrun();var d=this.config.MODEL[c].modelrun[g];return d.initialization.readable}catch(f){return"0"}};wundermap.layers.ModelData.getModelrunInitEpoch=function(){try{var c=this.getModel();var g=this.getModelrun();var d=this.config.MODEL[c].modelrun[g];return parseInt(d.initialization.epoch,10)}catch(f){return 0}};wundermap.layers.ModelData.handleHourMoveChange=function(d){this.calculateHour(d);var c=this.getHour();this.findId("hour_value").text(c)};wundermap.layers.ModelData.handleHourMoveComplete=function(d){var c=this.getHourString(d,{local:false});this.hourStringSave=c;this.hourEpochSave=null;if(this.active_){if(!this.disabled_&&!this.disabled_by_timelord_){this.findId("date").show().text(c)}google.maps.event.trigger(this,"settings_changed");this.refresh()}};wundermap.layers.ModelData.updateMaptypeDescription=function(){var h=this.findId("title");if(h[0]){var d=this.getModel();var c=this.getMaptype();var g=this.maptypeKeyLookup[c];var f=this.config.MODEL[d].MAP[g];var e=f.description||"no description available";h.text(e)}};wundermap.layers.ModelData.getModel=function(){return this.getElementValue("model","select",this.options_.model)};wundermap.layers.ModelData.getMaptype=function(){return this.getElementValue("maptype","select",this.options_.maptype)};wundermap.layers.ModelData.getModelrun=function(){return this.getElementValue("modelrun","select",this.options_.modelrun)};wundermap.layers.ModelData.getHour=function(){if(this.hour||this.hour===0){return b(this.hour)}else{return 0}};wundermap.layers.ModelData.handleKeystroke=function(x){try{var l=74;var m=76;var s=65;var f=68;var w=73;var u=75;var h=87;var p=83;var k=82;var o=70;var c=x.target.nodeName.toLowerCase();if(c=="input"||c=="textarea"){return}if(x.altKey||x.ctrlKey||x.metaKey||x.shiftKey){return}var t=this.findId("hour_slider");if(x.which==l){var y=t.slider("value");t.slider("value",y-1)}else{if(x.which==m){var y=t.slider("value");t.slider("value",y+1)}else{if(x.which==s){var v=this.hourEpoch-86400;var r=wundermap.utils.indexOfClosest(this.periodEpochs,v);t.slider("value",r)}else{if(x.which==f){var v=this.hourEpoch+86400;var r=wundermap.utils.indexOfClosest(this.periodEpochs,v);t.slider("value",r)}else{if(a.inArray(x.which,[w,u,h,p,k,o])>-1){var d=null;if(a.inArray(x.which,[k,o])>-1){d=this.findId("model")}else{if(a.inArray(x.which,[w,u])>-1){d=this.findId("maptype")}else{if(a.inArray(x.which,[h,p])>-1){d=this.findId("modelrun")}}}var n=d[0].selectedIndex;var g=0;if(a.inArray(x.which,[k,w,h])>-1){g=wundermap.utils.limit(n-1,0,d[0].length-1)}else{g=wundermap.utils.limit(n+1,0,d[0].length-1)}if(n!=g){d[0].selectedIndex=g;google.maps.event.trigger(d[0],"change")}}}}}}}catch(q){google.maps.event.trigger(this,"loaderror",'error capturing keystroke: "'+x.key+'" ('+q.message+")")}};wundermap.layers.ModelData.determinePositionsLayout=function(e,c){var d=google.maps.geometry.spherical.computeHeading(e,c);if((d>45&&d<135)||(d>225&&d<315)||(d<-45&&d>-135)){return 1}else{return -1}};wundermap.layers.ModelData.adjustCrossSectionLine=function(d,f,g,c){var e=this.determinePositionsLayout(f,g);if(e>0){g=new google.maps.LatLng(f.lat(),g.lng())}else{g=new google.maps.LatLng(g.lat(),f.lng())}if(d.line){d.line.getPath().removeAt(c);d.line.getPath().insertAt(c,g)}};wundermap.layers.ModelData.profileDragEnd=function(c){this.profileRequest(c)};wundermap.layers.ModelData.crossSectionDragEnd=function(d,c){if(c==1){this.snapToLine(d.marker2,d.marker1)}else{if(c==2){this.snapToLine(d.marker1,d.marker2)}}d.line.setMap(null);d.line=null;d.line=this.makeCrossSectionLine(d);this.crossSectionRequest(d)};wundermap.layers.ModelData.snapToLine=function(e,d){var g=e.getPosition();var h=d.getPosition();var f=this.determinePositionsLayout(g,h);if(f>0){var c=new google.maps.LatLng(g.lat(),h.lng())}else{var c=new google.maps.LatLng(h.lat(),g.lng())}d.setPosition(c)};wundermap.layers.ModelData.profileRequest=function(g){google.maps.event.trigger(this,"loadstart");var f=850/4;var d=1100/4;var c=600;var h=800;g.img.css("width",f);g.img.css("height",d);var k="http://modelmaps.wunderground.com/php/skewt.php";var l={model:this.getModel(),script:"plotskew",hour:this.getHour(),modelrun:this.getModelrunInitReadable(),maxlat:g.marker1.getPosition().lat(),maxlon:g.marker1.getPosition().lng()};g.popoutUrl=k+"?"+a.param(l)+"&width="+c+"&height="+h;var e=k+"?"+a.param(l)+"&width="+f+"&height="+d;if(this.debug_>0){wui.log(e)}this.showDisplayAreaImage(e,c,h,g);google.maps.event.trigger(this,"loadend")};wundermap.layers.ModelData.crossSectionRequest=function(f){google.maps.event.trigger(this,"loadstart");var g=200;var d=150;var c=800;var h=600;f.img.css("width",g);f.img.css("height",d);var k="http://modelmaps.wunderground.com/php/cross.php";var l={model:this.getModel(),script:"cross",hour:this.getHour(),modelrun:this.getModelrunInitReadable(),maxlat:Math.max(f.marker1.getPosition().lat(),f.marker2.getPosition().lat()),maxlon:Math.max(f.marker1.getPosition().lng(),f.marker2.getPosition().lng()),minlat:Math.min(f.marker1.getPosition().lat(),f.marker2.getPosition().lat()),minlon:Math.min(f.marker1.getPosition().lng(),f.marker2.getPosition().lng())};f.popoutUrl=k+"?"+a.param(l)+"&width="+c+"&height="+h;var e=k+"?"+a.param(l)+"&width="+g+"&height="+d;if(this.debug_>0){wui.log(e)}this.showDisplayAreaImage(e,c,h,f);google.maps.event.trigger(this,"loadend")};wundermap.layers.ModelData.showDisplayAreaImage=function(d,k,f,m){var c=this.elt_displayAreaTab;if(m.type=="crossSection"){c=this.elt_displayAreaTab2}var g=!!(c&&c[0]);if(g&&!m.isLoaded){var n=this;var h=m.index;var l=m.index+1;var e=a('<a href="javascript:void(0);">(close)</a>');e.bind("click",function(p){n.closePopout(h);n.removeClkObject(h);google.maps.event.trigger(n,"loadend")});var o=a('<a href="javascript:void(0);">(pop out)</a>');o.bind("click",function(p){if(m.popout){if(window.focus){m.popout.focus()}}else{m.popout=n.popoutImage(k,f,m.index,m.type)}});m.img.bind("click",function(p){o.triggerHandler("click")});m.container.append(l+" ");m.container.append(e);m.container.append(" ");m.container.append(o);m.container.append("<br />");m.container.append(m.img);m.container.addClass(this.sidebarPrefix_+"_thumbContainer");m.container.css("width",m.img.css("width"));c.append(m.container)}if(!m.isLoaded){m.popout=this.popoutImage(k,f,m.index,m.type)}m.isLoaded=true;if(m.popout){if(m.popout.closed||!m.popout.location){m.popout=this.popoutImage(k,f,m.index,m.type)}else{if(m.popoutImg){m.popoutImg.src=m.popoutUrl;if(window.focus){m.popout.focus()}}}}if(g){var n=this;m.img.bind("load",function(){google.maps.event.trigger(n,"loadend")});m.img[0].src=d}};wundermap.layers.ModelData.popoutImage=function(g,c,e,f){var h=this.clkObjects[e];h.popout=window.open("/stationmaps/gmap_popout.asp?index="+e+"&type="+f,e,"width="+g+",height="+c+",resizable=yes,scrollbars=yes");var d=h.popout;if(window.focus){d.focus()}return d};wundermap.layers.ModelData.popoutLoaded=function(d){var f=this.clkObjects[d];google.maps.event.trigger(this,"loadend");var c=f.popout.document.getElementById("canvas");var e=f.popout.document.createElement("img");e.src=f.popoutUrl;c.appendChild(e);f.popoutImg=e};wundermap.layers.ModelData.popoutClosed=function(c){if(this.clkObjects&&this.clkObjects[c]){if(this.elt_displayAreaTab[0]){this.clkObjects[c].popout=null}else{this.removeClkObject(c)}}};wundermap.layers.ModelData.makeCrossSectionLine=function(d,e){var c=[];if(d.marker1){c.push(d.marker1.getPosition())}if(d.marker2){c.push(d.marker2.getPosition())}if(e){c.push(e)}return new google.maps.Polyline({clickable:false,map:this.map_,path:c})};wundermap.layers.ModelData.closePopouts=function(){for(var c=this.clkObjects.length-1;c>=0;c--){this.closePopout(c)}};wundermap.layers.ModelData.closePopout=function(d){if(this.clkObjects[d]){var c=this.clkObjects[d].popout;if(c&&(!c.closed)){c.close();this.clkObjects[d].popout=null}}};wundermap.layers.ModelData.removeClkObjects=function(){for(var c=this.clkObjects.length-1;c>=0;c--){this.removeClkObject(c)}this.incompleteCrossSection=-1;this.isDraggingMarker=0;this.numClkObjects=0};wundermap.layers.ModelData.removeClkObject=function(c){if(this.clkObjects[c]){var d=this.clkObjects[c].marker1;if(d){google.maps.event.clearInstanceListeners(d);d.setMap(null);this.clkObjects[c].marker1=null}var d=this.clkObjects[c].marker2;if(d){google.maps.event.clearInstanceListeners(d);d.setMap(null);this.clkObjects[c].marker2=null}var d=this.clkObjects[c].line;if(d){google.maps.event.clearInstanceListeners(d);d.setMap(null);this.clkObjects[c].line=null}var d=this.clkObjects[c].container;if(d&&d[0]){this.clkObjects[c].container.empty();this.clkObjects[c].container.remove();this.clkObjects[c].container=null}this.clkObjects[c]=null;this.numClkObjects--}};wundermap.layers.NDFD=new wundermap.Layer();wundermap.layers.NDFD.className="NDFD";wundermap.layers.NDFD.initialize=function(f,d){var e={name:"ndfd",sidebarPrefix:"LayerNDFD",title:"U.S. Forecast",opacity:70,hour:"0",variable:"temp"};d=a.extend(true,{},e,d);wundermap.Layer.prototype.initialize.call(this,f,d);var c=this;this.addOpacityListener();this.addSliderListener("hour",{min:0,max:0,value:this.options_.hour,slide:function(g,h){c.handleHourMoveChange(h.value)},change:function(g,h){c.handleHourMoveChange(h.value);c.handleHourMoveComplete(h.value)}});this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)});this.setDisabled(true);this.periodEpochs=[];this.modelrunEpoch=0;this.hourEpoch=0;this.hourEpochSave=null;this.config=null;this.requestConfigInterval=600*1000;this.requestConfigLastUpdate=null;google.maps.event.addListener(this,"layertoggled",function(g){if(g){c.checkRequestConfig();a(document).bind("keydown."+c.sidebarPrefix_,function(h){c.handleKeystroke(h)})}else{a(document).unbind("."+c.sidebarPrefix_)}})};wundermap.layers.NDFD.getPrefs=function(c){var d={"var":this.getVariable(),hour:this.getHour(),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)};return d};wundermap.layers.NDFD.getURL=function(l,o,f,m,e,r,c){var h=this.getHour();var g=this.getVariable();var q=this.config.ndfdimagery[g].info.changeperiod-1;var p=this.config.ndfdimagery[g].info.changefactor;h++;var n=h;if(h>=q){n=(q+(h-q)*p)}if(g=="wx"){var d="http://modelmaps.wunderground.com/cgi-bin/mapgen?"+a.param({minlat:f,minlon:m,maxlat:l,maxlon:o,size:e+"x"+r,theme:"wx",proj:"automerc",format:"gif",alpha:"1",stdout:"1",data:"TPR_exp_wx"+b(h+1),rand:Math.floor((new Date()).getTime()/60000)})}else{var k=this.options_.subdomain||"modelmaps";var d="http://"+k+".wunderground.com/php/ndfd.php?"+a.param({maxlat:l,maxlon:o,minlat:f,minlon:m,width:e,height:r,script:"NDFD_"+g,model:"NDFD",hour:n,rand:Math.floor((new Date()).getTime()/60000)})}return d};wundermap.layers.NDFD.getURLConfig=function(){var c="/stationmaps/gmap_NDFD.asp";return c};wundermap.layers.NDFD.requestConfig=function(){var d=this.getURLConfig();var c=this;a.ajax({url:d,dataType:"json",success:function(f,e){var g=(c.config==null);c.config=f;if(!f){google.maps.event.trigger(c,"loaderror","empty or invalid config file")}else{if(f.ERROR){google.maps.event.trigger(c,"loaderror","error reading config file: "+jsonObj.ERROR)}else{c.requestConfigLastUpdate=new Date();c.populateHourOptions({firstTime:g});c.setDisabled(false);c.refresh()}}},error:function(h,f,g){google.maps.event.trigger(c,"loaderror","failed to load config file")}})};wundermap.layers.NDFD.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var c=this;var f=document.getElementsByName(this.sidebarPrefix_+"_var");for(var d=0;d<f.length;d++){var e=google.maps.event.addDomListener(f[d],"click",function(){c.populateHourOptions()});this.listeners_.push(e)}};wundermap.layers.NDFD.getVariable=function(){return this.getElementsValue("var","radiogroup",this.options_.variable)};wundermap.layers.NDFD.handleKeystroke=function(h){try{var c=74;var g=76;var l=h.target.nodeName.toLowerCase();if(l=="input"||l=="textarea"){return}var d=this.findId("hour_slider");if(h.which==c){var k=d.slider("value");d.slider("value",k-1)}else{if(h.which==g){var k=d.slider("value");d.slider("value",k+1)}}}catch(f){google.maps.event.trigger(this,"loaderror",'error capturing keystroke: "'+h.key+'" ('+f.message+")")}};wundermap.layers.NDFD.populateHourOptions=function(){var e=this.getVariable();if(!e){google.maps.event.trigger(this,"loaderror","missing variable name from getVariable()");return}var d=0;var k=this.config.ndfdimagery[e].periods;var h=0;for(var c in k){h++}var g=this.findId("hour_slider");var f=this.getElementValue("hour_slider","slider",this.options_.hour);g.slider("option","max",h-1);g.slider("value",d);if(d==f){this.handleHourMoveChange(d);this.handleHourMoveComplete(d)}};wundermap.layers.NDFD.getHourString=function(f,c){try{var g=this.getVariable();var l=this.config.ndfdimagery;var h=f+1;this.hourEpoch=parseInt(l[g].periods["node_"+h].us.epochvalid,10);var d=this.hourEpoch;var c=c||{};var n=(c.local!==true);var m=wui.date.strftime("%a, %d %b, %H:%M GMT",new Date(d*1000),n);return m}catch(k){return"unknown"}};wundermap.layers.NDFD.handleHourMoveChange=function(d){this.hour=d;var c=this.getHourString(d,{local:false});this.findId("hour_value").text(c)};wundermap.layers.NDFD.handleHourMoveComplete=wundermap.layers.ModelData.handleHourMoveComplete;wundermap.layers.NDFD.checkRequestConfig=wundermap.layers.ModelData.checkRequestConfig;wundermap.layers.NDFD.refresh=wundermap.layers.ModelData.refresh;wundermap.layers.NDFD.getHour=wundermap.layers.ModelData.getHour;wundermap.layers.Fire=new wundermap.Layer();wundermap.layers.Fire.className="Fire";wundermap.layers.Fire.initialize=function(g,d){var f={name:"fire",sidebarPrefix:"LayerFire",title:"Fire",timelord:{text:"from 7 days ago until present",showTooltip:true,min:new Date((new Date()).getTime()-7*24*3600*1000),max:new Date((new Date()).getTime()+3600*1000)},clickable:true,opacity:100,sat:"1",smk:"1",perim:"1",mode:"0"};d=a.extend(true,{},f,d);wundermap.Layer.prototype.initialize.call(this,g,d);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this),fn_useDataNodes:a.proxy(this.displayDataTable,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLPerimeters,this)});this.addMarkerLayer({fn_getURL:a.proxy(this.getURLSmoke,this),ajaxOptions:{},ignoreEvents:["idle"],fn_getURLDataCallback:a.proxy(this.drawSmoke,this)});this.addMarkerLayer({fn_getURL:a.proxy(this.getURLPerimetersCenters,this),ajaxOptions:{},ignoreEvents:["idle"],fn_getURLDataCallback:a.proxy(this.drawPerimeters,this)});this.setElementValue("sat","checkbox",this.options_.sat);this.setElementValue("smk","checkbox",this.options_.smk);this.setElementValue("perim","checkbox",this.options_.perim);this.setElementsValue("mode","radiogroup",this.options_.mode);this.addElementsListeners("mode","click");this.addOpacityListener([1]);var c=this.getPrefs();var e=wundermap.utils.isCheckedValue(c.sat);this.imagelayers_[0].setDisabled(!e);var e=wundermap.utils.isCheckedValue(c.smk);this.markerlayers_[0].setDisabled(!e);var e=wundermap.utils.isCheckedValue(c.perim);this.imagelayers_[1].setDisabled(!e);this.markerlayers_[1].setDisabled(!e)};wundermap.layers.Fire.getPrefs=function(c){var d={sat:this.getElementValue("sat","checkbox",this.options_.sat)?"1":"0",smk:this.getElementValue("smk","checkbox",this.options_.smk)?"1":"0",perim:this.getElementValue("perim","checkbox",this.options_.perim)?"1":"0",mode:this.getElementsValue("mode","radiogroup",this.options_.mode),opa:this.getElementValue("opacity_slider","slider",this.options_.opacity)};return d};wundermap.layers.Fire.getURL=function(h,m,f,l,e,n,c){var k=this.getElementsValue("mode","radiogroup",this.options_.mode);this.key_=(k=="0")?"firenorthamerica":"fireglobal";var g={minlat:f,minlon:l,maxlat:h,maxlon:m,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.date.btw":wui.date.strftime("%Y-%m-%d 00:00:00,%Y-%m-%d 23:59:59",wundermap.date,true)};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.Fire.getURLPerimeters=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,size:e+"x"+m,theme:"fire",proj:"automerc",format:"gif",alpha:"1",stdout:"1",rand:(new Date()).getUTCDate()};var d="http://wumaps.wunderground.com/cgi-bin/mapgen";d+="?"+a.param(g);return d};wundermap.layers.Fire.getURLPerimetersCenters=function(d,g,f,h,k,c,l){var e="/stationmaps/gmap_fire.asp";return e};wundermap.layers.Fire.getURLSmoke=function(g,m,f,k,e,n,c){var h=new Date(wundermap.date.getTime());h.setDate(h.getDate()-1);var l=wui.date.strftime("%Y%m%d",h,true);var d="/stationmaps/gmap_smoke.asp?date="+l;return d};wundermap.layers.Fire.getMarkerTitle=function(c){return"Fire detected by "+c.satellite};wundermap.layers.Fire.addComponents=function(){wundermap.Layer.prototype.addComponents.call(this);var n=this;var f=document.getElementById(this.sidebarPrefix_+"_sat");var l=document.getElementById(this.sidebarPrefix_+"_sat_mode");var m=this.imagelayers_[0];if(f){var d=google.maps.event.addDomListener(f,"click",function(){if(l){if(f.checked){a(l).removeClass("none")}else{a(l).addClass("none")}}if(m){m.setDisabled(!f.checked);m.refresh();n.removeDataTable(0)}google.maps.event.trigger(n,"settings_changed")});this.listeners_.push(d)}var k=document.getElementById(this.sidebarPrefix_+"_perim");var g=this.imagelayers_[1];var h=this.markerlayers_[1];if(k){var d=google.maps.event.addDomListener(k,"click",function(){if(g){g.setDisabled(!k.checked);g.refresh()}if(h){h.setDisabled(!k.checked);h.refresh();n.removeDataTable(1)}google.maps.event.trigger(n,"settings_changed")});this.listeners_.push(d)}var e=document.getElementById(this.sidebarPrefix_+"_smk");var c=this.markerlayers_[0];if(e&&c){var d=google.maps.event.addDomListener(e,"click",function(){c.setDisabled(!e.checked);c.refresh();google.maps.event.trigger(n,"settings_changed")});this.listeners_.push(d)}};wundermap.layers.Fire.drawSmoke=function(k){var r=this.markerlayers_[0];r.removeOverlays();if(!k||!k.SHAPEFILE){google.maps.event.trigger(self,"loaderror","Current smoke data unavailable");return}for(var o in k.SHAPEFILE.POLYGON){var t=k.SHAPEFILE.POLYGON[o];var m=b(t.VERTICIES);var s=b(t.Density);var f=b(t.Start);var g=b(t.End);var e=parseFloat(t.Area);f/=100;g/=100;if(g<f){g+=24}var d=[];var h=0;for(var p in t.node_1){if(h==m){break}var l=t.node_1[p];var n=parseFloat(l.LAT);var c=parseFloat(l.LON);d.push(new google.maps.LatLng(n,c));h++}var q=new google.maps.Polygon({clickable:false,fillColor:"#000000",fillOpacity:(s/100)*2,map:this.map_,paths:d,strokeColor:"#000000",strokeOpacity:0,strokeWeight:1});r.addMarker(q)}};wundermap.layers.Fire.drawPerimeters=function(g){var f=this.markerlayers_[1];f.removeOverlays();if(!g||!g.SHAPEFILE){google.maps.event.trigger(self,"loaderror","Current smoke data unavailable");return}var d=g.SHAPEFILE.POINT;for(var c in d){var e=d[c];this.drawPerimeter(e,f)}this.displayDataTable(d,1,{})};wundermap.layers.Fire.drawPerimeter=function(e,o){var l=!!(this.options_.clickable);var p=new google.maps.MarkerImage(wundermap.options.iconsdomain+"/graphics/wu2/active_fire.png",new google.maps.Size(28,26),null,new google.maps.Point(14,11));var d=e.FIRE_NAME;var n=e.AGENCY;var f=e.DATE;var g=parseFloat(e.ACRES);if(g<100){return}var m=parseFloat(e.node_1.node_0.LAT);var c=parseFloat(e.node_1.node_0.LON);var k=new google.maps.LatLng(m,c);var h=new google.maps.Marker({clickable:l,flat:true,icon:p,map:wundermap.map,position:k,title:d});if(l){var q=this;a.extend(true,e,{name:d,lat:m,lon:c,date:e.DATE});google.maps.event.addListener(h,"click",function(r){wundermap.openInfoBox({content:q.getBalloonContent(e),marker:this})});e.marker=h}o.addMarker(h)};wundermap.layers.Fire.getTableRowContent=function(h){var g=a("<tr></tr>");var f=a("<td></td>").appendTo(g);var e=f.clone().appendTo(g);var d=f.clone().appendTo(g);if(wui.defined(h.ACRES)){f.html('<a href="javascript:void(0);">'+h.FIRE_NAME+"</a>");e.html(parseFloat(h.ACRES));d.html(h.AGENCY)}else{var c=this.getImagemapAreasHref(h,0,false);f.html('<a href="'+c+'">'+h.city+"</a>");e.html(parseFloat(h.lat).toFixed(3));d.html(parseFloat(h.lon).toFixed(3))}return g};wundermap.layers.Fire.getTableHeadContent=function(h,e){var g=a("<tr></tr>");var f=a("<th></th>").appendTo(g);var d=f.clone().appendTo(g);var c=f.clone().appendTo(g);if(h&&wui.defined(h.ACRES)){f.html("Complex Name").attr("title","Sort by Name");d.html("Acres").attr("title","Sort by Acres");c.html("Agency").attr("title","Sort by Agency")}else{f.html("Nearest City").attr("title","Sort by City");d.html("Latitude").attr("title","Sort by Latitude");c.html("Longitude").attr("title","Sort by Longitude")}return g};wundermap.layers.Fire.getBalloonContent=function(d){var c='<div class="FireBalloon">';if(d&&wui.defined(d.ACRES)){c+='<div class="infobox-title">Active Fire Perimeter</div>'}else{c+='<div class="infobox-title">Satellite Detected Fire</div>'}c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Location: <span>'+d.name+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(d&&wui.defined(d.ACRES)){c+='<tr><td class="vaT nobr">Acres:</td><td class="full"><span class="b">'+parseFloat(d.ACRES).toFixed(2)+"</span></td></tr>";c+='<tr><td class="vaT nobr">Agency:</td><td class="full"><span class="b">'+d.AGENCY+"</span></td></tr>"}else{c+='<tr><td class="vaT nobr">Fire ID:</td><td class="full"><span class="b">'+d.id+"</span></td></tr>";c+='<tr><td class="vaT nobr">Ecosystem ID:</td><td class="full"><span class="b">'+d.ecosys+"</span></td></tr>";c+='<tr><td class="vaT nobr">Satellite:</td><td class="full"><span class="b">'+d.satellite+"</span></td></tr>";c+='<tr><td class="vaT nobr">Method:</td><td class="full"><span class="b">'+d.method+"</span></td></tr>"}c+="</table>";c+='<div class="tm10"><a href="javascript:wundermap.zoomTo('+parseFloat(d.lat).toFixed(2)+","+parseFloat(d.lon).toFixed(2)+',12)">Zoom in for detailed fire perimeter</a></div>';c+="</div>";c+='<div class="contentFooterPad taC brBot5">Last updated: <span>'+d.date+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+d.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.Hurricane=new wundermap.Layer();wundermap.layers.Hurricane.className="Hurricane";wundermap.layers.Hurricane.initialize=function(e,c){var d={name:"hur",sidebarPrefix:"LayerHurricane",zindex:{obs:10,fx:10,cod:5,wr:1,hd:10,mdl:10,gpce:10},fillopacity:40};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="hur";this.units_=wundermap.options.units;this.display_=this.getDisplayProperties();this.baseIconURL_=wundermap.options.iconsdomain+"/i/t/";this.serializedJson_="";this.addMarkerLayer({fn_getURL:a.proxy(this.getURL,this),ignoreEvents:["idle"],fn_getURLDataCallback:a.proxy(this.drawData,this)});this.addImageLayer({fn_getURL:a.proxy(this.getURLImage,this)});this.addElementListener("wr","click");this.addElementListener("cod","click");this.addElementListener("fx","click");this.addElementListener("obs","click");this.addElementListener("hd","click");this.addElementListener("mdl","click");this.addElementListener("gpce","click");this.addOpacityListener();this.addMarkerOpacityListener();this.addElementsListeners("img","click")};wundermap.layers.Hurricane.getURL=function(d,g,f,h,k,c,l){var e="/tropical/?json=TROPICAL_INDEX";return e};wundermap.layers.Hurricane.drawData=function(m){var h=this.markerlayers_[0];h.removeOverlays();this.products_=m.PRODUCTS;this.storms_={};this.skipStorms_={};for(var k in this.products_){var l=this.products_[k];if(!l.storm){continue}var f=l.region;var g=l.regioncode;for(var c in l.storm){var d=l.storm[c];var e=d.prefix;this.storms_[e]=this.parseStorm(d,e,f,g);if(this.getElementValue("obs","checkbox",0)){this.drawPastObs(this.storms_[e])}if(this.getElementValue("fx","checkbox",0)){this.drawForecast(this.storms_[e])}this.drawStorm(this.storms_[e],{drawCatNum:true,zIndex:10});if(this.getElementValue("wr","checkbox",0)){this.drawWindRadii(this.storms_[e])}}}this.displayDataTable(this.storms_,0,{sortable:false})};wundermap.layers.Hurricane.drawWindRadius=function(c,o,n,d,g,f){var p=false;for(var h in this.display_.windradius){if(o==h){p=true}}if(!p){if(this.debug_==1){google.maps.event.trigger(this,"loaderror","Unexpected type of windradius: "+o)}return}var q=this.display_.windradius[o].strokeColor;var k=this.display_.windradius[o].strokeWeight;var l=this.display_.windradius[o].strokeOpacity;var e=this.display_.windradius[o].fillColor;var m=this.options_.fillopacity/100||this.display_.windradius[o].fillOpacity;if(n>0){this.drawCircleWedgeMiles(c,n,0,90,q,k,l,e,m,1)}if(d>0){this.drawCircleWedgeMiles(c,d,90,180,q,k,l,e,m,1)}if(g>0){this.drawCircleWedgeMiles(c,g,180,270,q,k,l,e,m,1)}if(f>0){this.drawCircleWedgeMiles(c,f,270,360,q,k,l,e,m,1)}};wundermap.layers.Hurricane.drawCircleWedge=function(t,c,u,w,h,n,s,e,g,p,m){var q=[];var l=6;for(var r=w;r<=h;r+=l){var k=wundermap.utils.deg2rad(r);var d=c*Math.sin(k);var v=u*Math.cos(k);var o=new google.maps.LatLng(t.lat()+d,t.lng()+v,false);q.push(o)}if(w>0||h<360){q.push(t);q.push(q[0])}var f=new google.maps.Polygon({clickable:false,fillColor:g,fillOpacity:p,map:this.map_,paths:q,strokeColor:n,strokeOpacity:e,strokeWeight:s,zIndex:m});this.markerlayers_[0].addMarker(f)};wundermap.layers.Hurricane.drawCircleWedgeMiles=function(c,k,f,g,s,h,m,d,p,o){var n=3963.19;var l=180/(n*Math.PI);var r=l/Math.cos(wundermap.utils.deg2rad(c.lat()));var q=k*l;var e=k*r;this.drawCircleWedge(c,q,e,f,g,s,h,m,d,p,o)};wundermap.layers.Hurricane.drawCircleWedgeKM=function(c,k,f,g,s,h,m,d,p,o){var n=6378.137;var l=180/(n*Math.PI);var r=l/Math.cos(wundermap.utils.deg2rad(c.lat()));var q=k*l;var e=k*r;this.drawCircleWedge(c,q,e,f,g,s,h,m,d,p,o)};wundermap.layers.Hurricane.parseStorm=function(e,f,h,c){var d=e.STORMHDF.STORM;var g={};g.region=h;g.regioncode=c;g.name=e.name.trim();g.prefix=f;a.extend(g,this.parseStormNode(d,{}));g.obs=e.TRACKHDF.observations;return g};wundermap.layers.Hurricane.parseStormNode=function(g,n){var c=n.dateobj||null;var y={};y.windRadius=g.WINDRADIUS;y.forecast=g.FORECAST;try{var l=parseFloat(g.lat.decimal);var k=parseFloat(g.lon.decimal);if(isNaN(l)||isNaN(k)){throw"error"}}catch(v){if(this.debug_==1){wui.log("missing lat/lon.decimal for current position on storm: "+name)}return{}}y.lat=l;y.lon=k;y.winds="";if(g.WINDS){var u;if(typeof(g.WINDS.KNOTS)!="undefined"){u=g.WINDS.KNOTS}else{if(typeof(g.WINDS.node_0_VALUE)!="undefined"){u=g.WINDS.node_0_VALUE}else{if(typeof(g.WINDS.node_0)!="undefined"){u=g.WINDS.node_0}else{if(typeof(g.WINDS)!="undefined"){u=g.WINDS}}}}y.winds=wundermap.utils.convertKnotsIntoWindString(this.units_,parseFloat(u))}y.gusts="";if(g.GUSTS){var p;if(typeof(g.GUSTS.KNOTS)!="undefined"){p=g.GUSTS.KNOTS}else{if(typeof(g.GUSTS.node_0_VALUE)!="undefined"){p=g.GUSTS.node_0_VALUE}else{if(typeof(g.GUSTS.node_0)!="undefined"){p=g.GUSTS.node_0}else{if(typeof(g.GUSTS)!="undefined"){p=g.GUSTS}}}}y.gusts=wundermap.utils.convertKnotsIntoWindString(this.units_,parseFloat(p))}y.pressure="";if(g.PRESSURE){if(wundermap.utils.isValidMeasurement(g.PRESSURE.MB)){y.pressure=g.PRESSURE.MB+" mb"}}try{y.epoch=b(g.GMT.epoch)*1000}catch(v){if(this.debug_==1){wui.log("missing epoch for storm: "+name)}}if(c){y.date=c.toDateString()+" "+c.getHours()+":00 GMT"}else{var q="UTC";var w=g.GMT;if(!w){w=g.LOCALTIME;q=g.TIMEZONE||g.LOCALTIME.TIMEZONE||n.timezone||""}y.timezone=q;y.date="";var h=w.WEEKDAY;if(!h){h=w.weekday_abbrev}if(!h){h=w.WEEKDAY||""}if(!h){h=w.weekday||""}var x=w.MONTH;if(!x){x=w.mon_abbrev}if(!x){x=w.MONTH}if(!x){x=w.month}var s=b(x);if(isNaN(x)){s=wundermap.utils.convertMonthStringToInt(x)}var t=w.DAY;if(!t){t=w.day}if(!t){t=w.mday}var o=w.YEAR;if(!o){o=w.year}var m=w.HOUR;if(!m){m=w.hour}m=wundermap.utils.fixHour(m);var r=w.min||0;if(w){var f=new Date(o,s-1,t,m,0,0,0);y.date=f.toDateString()+" "+f.getHours()+":00 GMT";y.year=o;y.month=s;y.day=t;y.hour=m}}if(g.NAME){y.name=g.TYPE+" "+g.NAME}else{y.name=n.name}y.cat="";if(g.category){if(g.category.node_0){y.cat=g.category.node_0}else{if(g.category){y.cat=g.category}}}y.movement="";if(g.MOVEMENT){velocity=wundermap.utils.convertKnotsIntoWindString(this.units_,parseFloat(g.MOVEMENT.VELOCITY));y.movement=g.MOVEMENT_VALUE+" ("+g.MOVEMENT.DEGREES+"&deg;) at "+velocity}return y};wundermap.layers.Hurricane.drawStorm=function(g,h){var e=this;var k=this.getIconName(g.cat,(h.drawCatNum||false),(g.lat<0));var f=this.makeIcon(k);var c=new google.maps.LatLng(g.lat,g.lon);var d=new google.maps.Marker({clickable:true,icon:f,map:this.map_,position:c,title:g.name,zIndex:h.zIndex||5});google.maps.event.addListener(d,"click",function(l){wundermap.openInfoBox({title:g.name,content:e.getBalloonContent(g.name,g.prefix,g.epoch,g.date,g.winds,g.gusts,g.pressure,g.movement,g.lat,g.lon,g.cat,g.region),position:c})});this.markerlayers_[0].addMarker(d)};wundermap.layers.Hurricane.drawWindRadii=function(g){var f=g.windRadius;var c=new google.maps.LatLng(g.lat,g.lon);for(var l in f){var k=parseFloat(f[l].NE.node_0);if(isNaN(k)){k=parseFloat(f[l].NE)}var e=parseFloat(f[l].NW.node_0);if(isNaN(e)){e=parseFloat(f[l].NW)}var d=parseFloat(f[l].SW.node_0);if(isNaN(d)){d=parseFloat(f[l].SW)}var h=parseFloat(f[l].SE.node_0);if(isNaN(h)){h=parseFloat(f[l].SE)}this.drawWindRadius(c,l,k,e,d,h)}};wundermap.layers.Hurricane.drawPastObs=function(e){var c=this;var g=e.obs;if(!g){return}var f=[];a.each(g,function(s,l){try{var r=parseFloat(l.lat.decimal);var h=parseFloat(l.lon.decimal);if(isNaN(r)||isNaN(h)){throw"error"}var p=new google.maps.LatLng(r,h)}catch(q){if(this.debug_>=-1){wui.log("missing lat/lon decimal for past ob: "+s)}return}var n="";if(l.mphwindspeed){if(typeof(l.mphwindspeed)!="undefined"){n=wundermap.utils.convertWindIntoUnits(this.units_,l.mphwindspeed,0)}}var k="";if(wundermap.utils.isValidMeasurement(l.pressuremb)){k=l.pressuremb}var v="";if(l.category){v=l.category}var w=new Date(l.year,l.month,l.day,l.hour,0,0,0);w.setUTCFullYear(l.year,l.month-1,l.day);w.setUTCHours(l.hour);var m=w.toUTCString();if(r==e.lat&&h==e.lon&&v==e.cat){return}f.push(p);var u=c.getIconName(v,false,(r<0));var t=c.makeIcon(u);var o=new google.maps.Marker({clickable:true,icon:t,map:wundermap.map,position:p,title:m,zIndex:1});google.maps.event.addListener(o,"click",function(x){wundermap.openInfoBox({title:e.name+" Track History",content:c.getBalloonContent(e.name,e.prefix,e.epoch,m,n,"",k,"",r,h,v,e.region),position:p})});c.markerlayers_[0].addMarker(o)});f.push(new google.maps.LatLng(e.lat,e.lon));var d=new google.maps.Polyline({clickable:false,map:wundermap.map,path:f,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:3,zIndex:3});this.markerlayers_[0].addMarker(d)};wundermap.layers.Hurricane.getHour=function(c){var d=c.match("[0-9]+");if(c.search("DAY")>=0){return d*24}else{return d}};wundermap.layers.Hurricane.drawForecast=function(f){if(!f.forecast){return}var E=["12HR","24HR","36HR","48HR","72HR","4DAY","5DAY"];var r=f.lat;var o=f.lon;var d=0;for(var F=0;F<E.length;F++){var H=E[F];var B=f.forecast["node_"+H];if(!B){continue}var K=new Date(f.year,f.month-1,f.day,f.hour,0,0,0);var x=this.getHour(H);K.setTime(K.getTime()+x*1000*3600);B=this.parseStormNode(B,{dateobj:K,timezone:f.timezone,name:f.name+" "+H+" Forecast"});var p=B.lat;var k=B.lon;this.drawStorm(B,{zIndex:5,drawCatNum:false});if(this.getElementValue("wr","checkbox",0)){this.drawWindRadii(B)}if(this.getElementValue("cod","checkbox",0)){var s=this.display_.defaults[f.regioncode];if(!s){s=this.display_.defaults.wp}var C=new google.maps.LatLng(p,k);try{var m=parseFloat(s.error["node_"+F]);if(this.debug_==1){GLog.write("i = "+F+", radius = "+m)}this.drawCircleWedge(C,m,m,0,360,"#E3AA22",1,1,"#E3DF35",this.options_.fillopacity/100||0.4,2)}catch(J){if(this.debug_==1){google.maps.event.trigger(this,"loaderror","cannot draw cone of death due to missing defaults error for hour: "+H)}continue}var G=p-r;var A=k-o;if(A<-180){A+=360}if(A>180){A=360-A}var z=Math.atan(G/A);if(this.debug_==1){}if(A<0){z+=Math.PI}var c=Math.sqrt(A*A+G*G);var w=m-d;var q=Math.asin(w/c);var y=q+Math.PI/2;var D=[];D[0]=y+z;D[1]=(-1)*y+z;for(var L=0;L<D.length;L++){var I=D[L];if(!I){continue}var v=d*Math.sin(I);var n=d*Math.cos(I);var u=m*Math.sin(I);var l=m*Math.cos(I);var h=new google.maps.LatLng(r+v,o+n,false);var g=new google.maps.LatLng(p+u,k+l,false);var t=new google.maps.Polyline({clickable:false,map:this.map_,path:[h,g],strokeColor:"#E3AA22",strokeWeight:1,strokeOpacity:1,zIndex:2});this.markerlayers_[0].addMarker(t)}r=p;o=k;d=m}}};wundermap.layers.Hurricane.drawConeOfDeath=function(c){};wundermap.layers.Hurricane.fillDataTab=function(){};wundermap.layers.Hurricane.getIconName=function(c,e,f){var d="";switch(c){case"1":d="c1";break;case"2":d="c2";break;case"3":d="c3";break;case"4":d="c4";break;case"5":d="c5";break;case"ts":d="ts";break;case"td":d="td";break;case"invest":d="invest";break;default:d="invest"}var g="ico_"+d;if(d=="invest"){g+="-active.png"}else{if(e&&f){g+="-active-s.png"}else{if(e&&!f){g+="-active.png"}else{if(!e&&f){g+="-blank-s.png"}else{g+="-text.png"}}}}return g};wundermap.layers.Hurricane.makeIcon=function(g){if(0){}else{var f=22;var c=21;var d=this.baseIconURL_;d=d+g;var e=new google.maps.MarkerImage(d,new google.maps.Size(f,c),null,new google.maps.Point(f/2,c/2));return e}};wundermap.layers.Hurricane.getURLImage=function(h,n,f,l,e,p,c){var k=this.getElementsValue("img","radiogroup","0");var d="";var g={minlat:f,minlon:l,maxlat:h,maxlon:n,width:e,height:p};if(k=="srg"){d="http://wumaps.wunderground.com/cgi-bin/mapgen";var m={proj:"automerc",theme:"HUR_LAYERS/dynamic/gmapSurge",stdout:"1",size:e,x:p,alpha:"1",format:"gif",rand:Math.floor((new Date()).getTime()/60000)};a.extend(g,m)}else{if(k=="sst"){d="http://wublast.wunderground.com/cgi-bin/WUBLAST";var o={key:"global_sst",proj:"me",rand:Math.floor((new Date()).getTime()/60000)};a.extend(g,o)}else{return""}}d+="?"+a.param(g);return d};wundermap.layers.Hurricane.getURLSST=function(h,l,f,k,e,m,c){var d="http://wublast.wunderground.com/cgi-bin/WUBLAST";var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,key:"global_sst",proj:"me",rand:Math.floor((new Date()).getTime()/60000)};d+="?"+a.param(g);return d};wundermap.layers.Hurricane.getMarkerTitle=function(c){return c.Type+": "+c.DateTime};wundermap.layers.Hurricane.getBalloonContent=function(p,l,e,q,f,h,d,g,m,c,o,n){var k='<div class="HurricaneBalloon">';k+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';if(o=="ts"){k+='<td class="full">Strength: <span>Tropical Storm</span></td>'}else{if(o=="td"){k+='<td class="full">Strength: <span>Tropical Depression</span></td>'}else{if(o=="1"){k+='<td class="full">Strength: <span>Category 1</span></td>'}else{if(o=="2"){k+='<td class="full">Strength: <span>Category 2</span></td>'}else{if(o=="3"){k+='<td class="full">Strength: <span>Category 3</span></td>'}else{if(o=="4"){k+='<td class="full">Strength: <span>Category 4</span></td>'}else{if(o=="5"){k+='<td class="full">Strength: <span>Category 5</span></td>'}else{k+='<td class="full">Strength: <span>'+o+"</span></td>"}}}}}}}k+='<td class="vaT nobr dtr">Lat: <span>'+m+'</span></td><td class="vaT nobr">Lon: <span>'+c+"</span></td></tr></table>";k+='<div class="grt p10">';k+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(g){k+='<tr><td class="nobr">Movement:</td><td class="full b">'+g+"</td></tr>"}if(f){k+='<tr><td class="nobr">Wind Speeed:</td><td class="full b">'+f+"</td></tr>"}if(h){k+='<tr><td class="nobr">Wind Gusts:</td><td class="full b">'+h+"</td></tr>"}if(d){k+='<tr><td class="nobr">Pressure:</td><td class="full b">'+d+"</td></tr>"}k+="</table>";if(l){k+='<div class="tm10"><a href="/tropical/tracking/'+l+'.html" class="b med newWin" target="new">View Storm Details</a></div>'}k+="</div>";k+='<div class="contentFooterPad taC brBot5">Timestamp: <span>'+q+"</span></div>";k+="</div>";return k};wundermap.layers.Hurricane.getTableRowContent=function(g){var f=a("<tr></tr>");var d=a("<td></td>").appendTo(f);var c=d.clone().appendTo(f);var e=this.baseIconURL_+this.getIconName(g.cat,true,(g.lat<0));d.html('<img src="'+e+'" alt="" />');c.html(""+g.name+'<br /><span class="grey">('+g.region+")</span><br />"+g.winds+", "+g.movement+"<br />"+g.date);f.click(function(){var h=new google.maps.LatLng(g.lat,g.lon);wundermap.map.setOptions({center:h,zoom:5})});return f};wundermap.layers.Hurricane.getDisplayProperties=function(){return{windradius:{node_34:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:0.5,fillColor:"#7AFE00",fillOpacity:0.9},node_50:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:0.5,fillColor:"#CAFF69",fillOpacity:0.9},node_64:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:0.5,fillColor:"#FFFF00",fillOpacity:0.9},node_100:{strokeColor:"#000000",strokeOpacity:1,strokeWeight:0.5,fillColor:"#FF0000",fillOpacity:0.9}},iconcache:{},defaults:{wp:{error:{node_0:"0.6",node_1:"1.2",node_2:"1.7",node_3:"2.2",node_4:"3.2",node_5:"4.2",node_6:"5.2",node_7:"5.2",node_8:"5.2",node_9:"5.2"}},at:{error:{node_0:"0.60",node_1:"1.03",node_2:"1.42",node_3:"1.8",node_4:"2.68",node_5:"2.68",node_6:"3.66",node_7:"3.66",node_8:"4.75",node_9:"4.75"}},ep:{error:{node_0:"0.6",node_1:"0.98",node_2:"1.36",node_3:"1.7",node_4:"2.3",node_5:"2.3",node_6:"2.9",node_7:"2.9",node_8:"3.66",node_9:"3.66"}}},models:{}}};wundermap.layers.InterstateBatteries=new wundermap.Layer();wundermap.layers.InterstateBatteries.className="InterstateBatteries";wundermap.layers.InterstateBatteries.initialize=function(e,c){var d={name:"ib",sidebarPrefix:"LayerInterstateBatteries",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="ib";this.as5000_="FIRE-00070";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.InterstateBatteries.getBalloonContent=function(c){return wundermap.Layer.prototype.getBalloonContentAds.call(this,c)};wundermap.layers.InterstateBatteries.getBalloonContentAdsTitle=function(c){return"Interstate Batteries"};wundermap.layers.DunkinDonuts=new wundermap.Layer();wundermap.layers.DunkinDonuts.className="DunkinDonuts";wundermap.layers.DunkinDonuts.initialize=function(e,c){var d={name:"dd",sidebarPrefix:"LayerDunkinDonuts",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="dunkindonuts";this.as5000_="HILL-00091";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.DunkinDonuts.getBalloonContent=function(c){return wundermap.Layer.prototype.getBalloonContentAds.call(this,c)};wundermap.layers.DunkinDonuts.getMarkerTitle=function(c){return"Dunkin Donuts in "+c.name};wundermap.layers.DunkinDonuts.getClusterTitle=function(c){return c.clustercount+" Dunkin Donuts locations near here"};wundermap.layers.DunkinDonuts.getBalloonContentAdsTitle=function(c){return"Dunkin Donuts"};wundermap.layers.Mitsubishi=new wundermap.Layer();wundermap.layers.Mitsubishi.className="Mitsubishi";wundermap.layers.Mitsubishi.initialize=function(e,c){var d={name:"mits",sidebarPrefix:"LayerMitsubishi",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="mitsubishidealers";this.as5000_="PHDN-00027";this.as5000image_=wundermap.options.iconsdomain+"/ads/images/mitsubishi_350x190.jpg";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.Mitsubishi.getBalloonContent=function(c){return wundermap.Layer.prototype.getBalloonContentAds.call(this,c)};wundermap.layers.Mitsubishi.getMarkerTitle=function(c){return"Mitsubishi Dealership in "+c.name};wundermap.layers.Mitsubishi.getBalloonContentAdsTitle=function(c){return"Mitsubishi Dealership"};wundermap.layers.Extremes=new wundermap.Layer();wundermap.layers.Extremes.className="Extremes";wundermap.layers.Extremes.initialize=function(g,d){var f={name:"extremes",sidebarPrefix:"LayerExtremes",addListeners:1,dateDisplayFormat:"yy-mm-dd",drawTableOpts:null,station_id:"94732",startenddatediff:1,refreshTimeout:360000,sqllimit:500,usedatanodes:1};d=a.extend(true,{},f,d);wundermap.Layer.prototype.initialize.call(this,g,d);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});var c=this;this.key_=this.options_.db;this.station_id_=this.options_.station_id;this.changeBurtOptionsOnFirstDisplay_=1;this.lastClickedWxvar_="maxt";this.setupDatepickers();this.onChangeDB();this.onChangeAllDates();this.drawTableAjaxRequest();if(this.options_.addListeners){this.addElementsListeners("type","click");this.addElementsListeners("wxvar","click");this.addElementListener("startdate","change");this.addElementListener("enddate","change");this.addElementsListeners("db","change");this.addElementListener("alldates","change");a('input[name="'+this.sidebarPrefix_+'_db"]').bind("change",function(){c.onChangeDB()});a('input[name="'+this.sidebarPrefix_+'_wxvar"]').bind("click",function(){var h=a(this);c.lastClickedWxvar_=h.val();c.onChangeWxvar()});a("#"+this.sidebarPrefix_+"_alldates").bind("click",function(){c.onChangeAllDates()});var e=google.maps.event.addListener(this,"loadstart",function(){a("#"+c.sidebarPrefix_+"_ajax-spinner").removeClass("none")});this.listeners_.push(e);var e=google.maps.event.addListener(this,"loadend",function(){a("#"+c.sidebarPrefix_+"_ajax-spinner").addClass("none")});this.listeners_.push(e)}if(this.options_.drawTableOpts!=null){var e=google.maps.event.addListener(this,"settings_changed",function(){c.drawTableAjaxRequest()});this.listeners_.push(e)}};wundermap.layers.Extremes.getPrefs=function(){var c=this.getDateRange({startdate:this.getElementValue("startdate","input","01-01-2000"),enddate:this.getElementValue("enddate","input","01-01-2020")}).split(",");return{db:this.getElementsValue("db","radiogroup","ncdc"),alldates:(this.getElementValue("alldates","checkbox",0))?"1":"0",maxt:(this.getElementValue("maxt","checkbox",0))?"1":"0",mint:(this.getElementValue("mint","checkbox",0))?"1":"0",lomx:(this.getElementValue("lomx","checkbox",0))?"1":"0",himn:(this.getElementValue("himn","checkbox",0))?"1":"0",prcp:(this.getElementValue("prcp","checkbox",0))?"1":"0",prcp_min:(this.getElementValue("prcp_min","checkbox",0))?"1":"0",snow:(this.getElementValue("snow","checkbox",0))?"1":"0",alltime:(this.getElementValue("alltime","checkbox",0))?"1":"0",yearly:(this.getElementValue("yearly","checkbox",0))?"1":"0",monthly:(this.getElementValue("monthly","checkbox",0))?"1":"0",daily:(this.getElementValue("daily","checkbox",0))?"1":"0",storm:(this.getElementValue("storm","checkbox",0))?"1":"0",startdate:this.getElementValue("startdate","input",this.options_.startdate),enddate:this.getElementValue("enddate","input",this.options_.enddate)}};wundermap.layers.Extremes.getURL=function(h,l,f,k,e,m,c){this.key_="extremes_"+this.getElementsValue("db","radiogroup","ncdc");var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",gmapzoom:this.map_.getZoom(),units:wundermap.options.units||"english"};a.extend(g,this.extendURLParams());var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.Extremes.extendURLParams=function(l){var r="extremes_"+this.getElementsValue("db","radiogroup","ncdc");var n=this.getElementsValue("type","checkboxgroup","alltime");var f=this.getElementsValue("wxvar","checkboxgroup","maxt");var g={key:r,"filter.wxvar.any":f,"filter.record_type.any":n};var d=this.getElementValue("alldates","checkbox",false);if(d){if(this.key_.match("burt")){}else{if(this.key_.match("ncdc")&&!l){a.extend(g,{"filter.iscurrentrecord.eq":1});var k=g["filter.record_type.any"];if(k.match("alltime")){if(g["filter.iscurrentrecord.eq"]==1){g["filter.record_type.any"]="alltime"}else{g["filter.record_type.any"]=""}}}}}else{var c=this.map_.getBounds();if(c){var p=c.getSouthWest();var q=c.getNorthEast();var h=q.lat();var o=q.lng();var e=p.lat();var m=p.lng();if(Math.abs(h-e)>10&&Math.abs(o-m)>10){a.extend(g,{"extend.overview":1})}}a.extend(g,{"filter.date.btw":this.getDateRange({})})}return g};wundermap.layers.Extremes.getDataURL=function(h,l,f,k,e,m,c){this.key_="extremes_"+this.getElementsValue("db","radiogroup","ncdc");var g={minlat:-1000,minlon:-1000,maxlat:89.99,maxlon:179.99,width:e,height:m,proj:"me",extension:"js",gmapzoom:this.map_.getZoom(),units:wundermap.options.units||"english"};a.extend(g,this.extendDataURLParams());var d="/cgi-bin/ICONBLAST";d+="?"+a.param(g);return d};wundermap.layers.Extremes.extendDataURLParams=function(){return this.extendURLParams()};wundermap.layers.Extremes.drawTableAjaxRequest=function(){var e=this.options_.drawTableOpts;if(e!=null){var c=this;var d=a("#"+this.sidebarPrefix_+"_"+e.containerid);if(!d){wui.log("No value set for wundermap.layers.Extremes.options_.drawTableOpts.containerid")}d.html("Loading table...");a.ajax({url:c.getDataURL(90,179,-90,-180,640,480,{}),success:function(f){c.jsonCallback(f.ICONS)},error:function(){google.maps.event.trigger(c,"loaderror","failed to load details for id: "+id)}})}};wundermap.layers.Extremes.jsonCallback=function(d,e,c){var f=[];for(i=0;i<d.length;i++){if(d[i].clusternodes){f=f.concat(d[i].clusternodes)}else{f=f.concat(d[i])}}this.jsonData_=f;var k=wundermap.layers.Extremes.getTableFields();a("#"+this.sidebarPrefix_+"_dynamiclegend").html("");a("#"+this.sidebarPrefix_+"_dynamiclegend").html(this.getCompleteOptionsListHTML());a("#"+this.sidebarPrefix_+"_numresults").html(this.getTableTitle(f.length,true));if(f.length==0){a("#"+this.sidebarPrefix_+"_isdata").html("NO").css("color","red");var g=this.options_.drawTableOpts.containerid||"datatable_container";g=this.sidebarPrefix_+"_"+g;a("#"+g).html("")}else{a("#"+this.sidebarPrefix_+"_isdata").html("YES").css("color","green");if(this.options_.drawTableOpts!=null){var l={};var m=this.key_.split("_")[1];a.extend(l,k[m].columns);var h={json:f,startdate:this.startdate_,enddate:this.enddate_,fields:l,sort:k[m].sort,sorttype:k[m].sorttype};a.extend(h,this.options_.drawTableOpts);this.drawTable(h)}}};wundermap.layers.Extremes.getDetailsURL=function(f,d){var e=f.split(",");var c="";if(e.length>1){c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.station_id="+e[0]+"&id.wxvar="+e[1]+"&id.record_type="+e[2]+"&id.record="+e[4]+"&id.date="+e[3]}else{c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+f}return c};wundermap.layers.Extremes.onClick=function(h,g){var f=h.ICONS[0];if(!f){google.maps.event.trigger(this,"loaderror","failed to load detailed click.");return}var e=this.getBalloonContent(f);if(this.options_.infopane){this.options_.infopane.showHTML(e)}else{var k=parseFloat(f.lat);var l=parseFloat(f.lon);var c=new google.maps.LatLng(k,l);if(g&&g>0){var d=this.map_.maxZoom;if(g>d){g=d}this.map_.setZoom(g)}wundermap.openInfoBox({content:e,position:c})}};wundermap.layers.Extremes.getMarkerTitle=function(f,c){var h="";if(!c){h+=this.getLocationString(f)+": "}var g=f.record_type;var e=f.wxvar;var d=f.date;h+=this.getCleanType(g,d)+" "+this.getCleanVariable(e)+" of "+this.getCleanRecord(f.record,e)+" on "+d;return h};wundermap.layers.Extremes.getClusterTitle=function(d){var c=d.clusternodes[0];var e=this.getLocationString(c);return d.clustercount+" records set near "+e};wundermap.layers.Extremes.getTableTitle=function(e,h){var c="";var d="";if(h){if(e==0){c='style="color:red;"'}else{c='style="color:green;"'}}if(this.options_.sqllimit&&e>=this.options_.sqllimit){d=" (limited to "+this.options_.sqllimit+")"}var g='Showing <span class="b" '+c+">"+e+"</span>"+d;if(this.getElementValue("alldates","checkbox",false)){g+=" current standing records"}else{var f=this.getDateRange({}).split(",");g+=' records from <span class="b">'+this.getCleanDate(f[0],"MM d, yy")+'</span> to <span class="b">'+this.getCleanDate(f[1],"MM d, yy")+"</span>"}return g};wundermap.layers.Extremes.onChangeDB=function(){var c=this;this.key_=this.getElementsValue("db","radiogroup","ncdc");if(this.key_.match("burt")&&this.changeBurtOptionsOnFirstDisplay_){this.setBurtDefaultOptions()}if(this.key_.match("burtcity")){this.onChangeWxvar()}this.strikeInvalidCheckboxes();wui.glossary.stop();wui.glossary.start()};wundermap.layers.Extremes.onChangeWxvar=function(){if(this.key_.match("burtcity")){a('[name="'+this.sidebarPrefix_+'_wxvar"]').removeAttr("checked");a("#"+this.sidebarPrefix_+"_"+this.lastClickedWxvar_).attr("checked","checked");this.strikeInvalidCheckboxes()}};wundermap.layers.Extremes.onChangeAllDates=function(e){if(e===undefined){var e={ncdc:["prcp_min","yearly","monthly","daily","storm"]}}this.strikeInvalidCheckboxes();if(this.getElementValue("alldates","checkbox",false)){a("#"+this.sidebarPrefix_+"_startdate").attr("disabled",true);a("#"+this.sidebarPrefix_+"_enddate").attr("disabled",true);var d=this.getElementsValue("db","radiogroup","ncdc");if(d.match("ncdc")){a("div#"+this.sidebarPrefix_+"_options label").parent().parent().removeClass("none");for(var c=0;c<e.ncdc.length;c++){a('[for="'+this.sidebarPrefix_+"_"+e.ncdc[c]+'"]').parent().parent().addClass("none")}}}else{a("#"+this.sidebarPrefix_+"_startdate").removeAttr("disabled");a("#"+this.sidebarPrefix_+"_enddate").removeAttr("disabled")}};wundermap.layers.Extremes.onChangeDatepicker=function(){this.refresh();this.drawTableAjaxRequest();google.maps.event.trigger(this,"settings_changed")};wundermap.layers.Extremes.setBurtDefaultOptions=function(){this.setElementsValue("type","checkbox",false);this.setElementValue("alltime","checkbox",true);this.setElementsValue("wxvar","checkbox",false);this.setElementValue("maxt","checkbox",true);this.setElementValue("alldates","checkbox",true);this.changeBurtOptionsOnFirstDisplay_=0};wundermap.layers.Extremes.strikeInvalidCheckboxes=function(){var d=this;var f=this.getElementsValue("db","radiogroup","ncdc");var c=wundermap.layers.Extremes.getTableFields();var g=c[f].dfn.wxvar;a("div#"+this.sidebarPrefix_+"_options label").parent().parent().addClass("none");if(f=="burtcity"){a.each(g,function(k,l){var m=d;var h=a('[for="'+d.sidebarPrefix_+"_"+k+'"]');h.parent().parent().removeClass("none");h.html(l.title);if(k==d.lastClickedWxvar_){a.each(l.type,function(o,p){var n=a('[for="'+m.sidebarPrefix_+"_"+o+'"]');n.parent().parent().removeClass("none");n.html(p)})}})}else{a.each(g,function(k,l){var h=a('[for="'+d.sidebarPrefix_+"_"+k+'"]');h.parent().parent().removeClass("none");h.html(l)});var e=c[f].dfn.type;a.each(e,function(k,l){var h=a('[for="'+d.sidebarPrefix_+"_"+k+'"]');h.parent().parent().removeClass("none");h.html(l)})}};wundermap.layers.Extremes.getCompleteVariableList=function(){var d='<span class="'+this.sidebarPrefix_+'_selectedlisttitle"> Selected Variables: </span>';var c=this.getElementsValue("wxvar","checkboxgroup","maxt").split(",");for(i=0;i<c.length;i++){d+=this.getCleanVariable(c[i]);if(i!=c.length-1){d+=", "}}return d};wundermap.layers.Extremes.getCompleteTypeList=function(){var d='<span class="'+this.sidebarPrefix_+'_selectedlisttitle"> Selected Types: </span>';var c=this.getElementsValue("type","checkboxgroup","alltime").split(",");for(i=0;i<c.length;i++){d+=this.getCleanType(c[i]);if(i!=c.length-1){d+=", "}}return d};wundermap.layers.Extremes.getCompleteOptionsListHTML=function(){html="";html+='<div id="multiple"><img src="http://icons.wxug.com/i/climate/extremes/multiple.png" /><span>Multiple Records</span></div>';var c='<br class="clear" />';var d=this.getElementsValue("type","checkboxgroup","alltime").split(",");var e=this.getElementsValue("wxvar","checkboxgroup","maxt").split(",");for(i=0;i<e.length;i++){for(j=0;j<d.length;j++){if(!d[j]||!e[i]){continue}if(d[j]=="storm"){if(e[i]=="maxt"||e[i]=="himn"||e[i]=="lomx"||e[i]=="mint"){continue}}html+='<div id="'+e[i]+"_"+d[j]+'"><img src="http://icons.wxug.com/i/climate/extremes/'+e[i]+"_"+d[j]+'.png" alt="" /><span>'+this.getCleanType(d[j])+" "+this.getCleanVariable(e[i])+"</span></div>"}}html+=c;return html};wundermap.layers.Extremes.getBalloonContent=function(g){var f=g.field;var e=g.wxvar;var d=g.record_type;var k=false;if(this.getElementsValue("db","radiogroup","ncdc")=="burtworld"){k=true}var h=this.getLocationString(g,k);var c='<div class="ExtremesBalloon">';c+='<div class="infobox-title">'+h+"</div>";c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Date: <span>'+this.getCleanDate(g.date,"M d, yy")+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(g.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(g.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(k){c+='<tr><td class="vaT nobr">City:</td><td class="full">'+this.getLocationString(g,!k)+"</td></tr>"}if(g.country){c+='<tr><td class="vaT nobr">Country:</td><td class="full">'+g.country+"</td></tr>"}if(g.record){c+='<tr><td class="vaT nobr">Record:</td><td class="full"><span class="">'+this.getCleanRecord(g.record,g.wxvar)+"</span></td></tr>"}if(g.record_type){c+='<tr><td class="vaT nobr">Record Type:</td><td class="full"><span class="">'+this.getCleanType(g.record_type,g.date)+"</span></td></tr>"}if(g.wxvar&&!this.key_.match("burtcity")){c+='<tr><td class="vaT nobr">Weather Variable:</td><td class="full"><span class="">'+this.getCleanVariable(g.wxvar)+"</span></td></tr>"}if(g.previous_record){c+='<tr><td class="vaT nobr">Previous Record:</td><td class="full">'+this.getCleanRecord(g.previous_record,g.wxvar)+" ("+this.getCleanDate(g.previous_date,"mm-dd-yy")+")</td></tr>"}if(g.por){c+='<tr><td class="vaT nobr">Period of Record (Years):</td><td class="full"><span class="">'+g.por+"</span></td></tr>"}if(g.footnotes){c+='<tr><td class="vaT nobr">Footnotes:</td><td class="full">'+g.footnotes+"</td></tr>"}c+="</table>";c+="</div>";c+='<div class="contentFooterPad taC brBot5"><a href="/climate/local_extremes.asp?extremesstation.db='+this.key_.split("_")[1]+"&extremesstation.station_id="+g.station_id+'" target="_blank">View this station on the Local Extremes page</a></div>';c+="</div>";return c};wundermap.layers.Extremes.getBalloonContentCluster=function(p){var k='<div class="'+this.className+'Balloon">';k+='<div class="infobox-title">'+this.getClusterTitle(p)+"</div>";k+='<div class="contentData">';var o={};var e=p.clusternodes;var n=p.clusterindex;for(var h=0;h<e.length;h++){var g=e[h];var l=null;if(o[g.station_id]){l=o[g.station_id]}else{l="<div>"+this.getLocationString(g)+"</div><ul>";o[g.station_id]=l}if(p.cluster_hasDetailedResults){var d="javascript:wundermap.layers."+this.className+".getDetailsCached("+n+","+h+","+this.map_.zoom+")"}else{var d=this.getImagemapAreasHref(g,h,false,this.map_.zoom)}var f=true;l+='<li><a href="'+d+'">'+this.getMarkerTitle(g,f)+"</a></li>";o[g.station_id]=l}a.each(o,function(q,r){k+=r+"</ul>"});k+="<ul>";var m=(p.clustercount-p.clustercount_limited);if(m>0){k+="<li>and "+m+" more&hellip;</li>"}k+="</ul>";var d="javascript:wundermap.zoomIn()";k+='<div class="p10"><a href="'+d+'">Zoom in for a closer look</a></div>';if(this.as5000_){var c="http://www.wunderground.com/cgi-bin/tally?node="+this.as5000_+"."+wundermap.options.source+"&value=cluster";k+='<div class="none"><img src="'+c+'" alt="" /></div>'}k+="</div></div>";return k};wundermap.layers.Extremes.drawTable=function(c){var u=c.json||this.jsonData_||null;var q=c.fields||{station_id:"Implement opts.fields in extremes.drawTable!"};var k=c.containerid||"dataTableContainer";var e=c.tableid||"dataTable";var g=c.classes||"tablesorter contentTable borderAll";var r=c.headerTitle||"Extremes Data Table";var n=c.sort||[[0,"desc"]];var d=c.sorttype||[];k=this.sidebarPrefix_+"_"+k;e=this.sidebarPrefix_+"_"+e;a("#"+k).empty();var p='<div class="titleThin brTop5" id="'+this.sidebarPrefix_+'_datatable_header">'+this.getTableTitle(u.length)+"</div>";p+='<table cellspacing="0" cellpadding="0" id="'+e+'" class="'+g+'">';p+="<thead><tr>";var f=0;a.each(q,function(v,w){p+="<th>"+w+"</th>";f++});p+="</tr></thead><tbody>";if(u.length>0){var o=c.startrecord||0;var s=c.endrecord||u.length;if(o>s||o<0){o=0}if(s>u.length||s<o){s=u.length}for(var m=o;m<s;m++){p+=this.getTableRow(u[m],q)}}p+="</tbody></table>";a("#"+k).html(p);a("#"+e).dataTable({oLanguage:{sSearch:'<dfn data-definition="'+this.getFilterResultsDefn()+'">Filter Results</dfn>: ',sInfoEmpty:"No results.",sZeroRecords:"No filtered results.",sLengthMenu:'Display <select><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option><option value="-1">All</option></select> records'},bAutoWidth:false,sScrollX:"100%",aaSorting:n,sPaginationType:"full_numbers",iDisplayLength:25,aoColumns:d});a("#"+e).dataTable().fnSettings().aoDrawCallback.push({fn:function(v){wui.glossary.stop();wui.glossary.start()},sName:"user"});p+='<div class="LayerExtremes_selectedlist">'+this.getCompleteVariableList()+'</div><div class="LayerExtremes_selectedlist">'+this.getCompleteTypeList()+"</div>";var l=a("<div></div>").addClass(this.sidebarPrefix_+"_selectedlist").html(this.getCompleteVariableList());var t=a("<div></div>").addClass(this.sidebarPrefix_+"_selectedlist").html(this.getCompleteTypeList());var h="#"+k+" .dataTables_scroll";t.insertAfter(h);l.insertAfter(h);wui.glossary.stop();wui.glossary.start()};wundermap.layers.Extremes.drawTableMetadata=function(c){var n=c.json||null;var l=c.fields||{station_id:"Implement opts.fields in extremes.drawTable!"};var f=c.containerid||"dataTableContainer";var d=c.tableid||"dataTable";var e=c.classes||"tablesorter contentTable borderAll brBot5 bm12";var k=c.startrecord||0;var m=c.endrecord||n.length;var h=c.header||"Add header with opts.header";f=this.sidebarPrefix_+"_"+f;d=this.sidebarPrefix_+"_"+d;a("#"+f).html();var g='<div class="titleThin" id="'+this.sidebarPrefix_+'_datatable_header">'+h+"</div>";g+='<table cellspacing="0" cellpadding="0" id="'+d+'" class="'+e+'">';if(n.station_id){a.each(l,function(o,q){var p=n[o];if(!p){return true}g+="<tr><td>"+q+"</td><td>"+p+"</td></tr>"})}else{g+='<tr><td colspan="2">No data.</td></tr>'}g+="</tbody></table>";a("#"+f).html(g)};wundermap.layers.Extremes.getDateRange=function(h){var c=h.dateFormat||"mm-dd-yy";var g=h.startdate||this.getElementValue("startdate","input","01-01-2000");var f=h.enddate||this.getElementValue("enddate","input","01-01-2020");try{var n=a.datepicker.parseDate(c,g)}catch(k){console.log("Extremes.getDateRange:: date2init invalid date: "+g+". "+k.toString())}try{var m=a.datepicker.parseDate(c,f)}catch(k){console.log("Extremes.getDateRange:: date2init invalid date: "+f+". "+k.toString())}var o=null;if(n.getTime()>m.getTime()){o=m;m=n;n=o}var l=a.datepicker.formatDate("yy-mm-dd",n);var d=a.datepicker.formatDate("yy-mm-dd",m);return l+","+d};wundermap.layers.Extremes.getLocationString=function(d,c){if(c&&d.country){return a.trim(d.country).titlizer()}var e=a.trim(d.place).titlizer();if(d.state){e+=", "+a.trim(d.state)}return e};wundermap.layers.Extremes.getTableRow=function(g,c){var h=this.getLocationString(g);var e="<tr>";var d="";var f="";if(g.footnotes&&g.footnotes!=""){d='<dfn data-definition="'+g.footnotes+'">';f="</dfn>"}e+="<td>"+this.getCleanDate(g.date,"mm-dd-yy")+"</td>";if(c.place){e+="<td>"+h+"</td>"}if(c.country&&g.country){e+="<td>"+g.country+"</td>"}if(g.continent){e+="<td>"+g.continent+"</td>"}if(c.wxvar&&g.wxvar&&!this.key_.match("burtcity")){e+="<td>"+this.getCleanVariable(g.wxvar)+"</td>"}e+="<td>"+this.getCleanType(g.record_type,g.date)+"</td>";e+="<td>"+d+this.getCleanRecord(g.record,g.wxvar)+f+"</td>";if(c.previous_record&&g.previous_record&&g.previous_date){e+="<td>"+this.getCleanRecord(g.previous_record,g.wxvar)+" ("+this.getCleanDate(g.previous_date,"mm-dd-yy")+")</td>"}e+="</tr>";return e};wundermap.layers.Extremes.getCleanDate=function(f,h){try{var d=f.split("-");if(!f){return"00-00-0000"}else{if(f.match("0000")||f.match("-00")){return d[1]+"-"+d[2]+"-"+d[0]}else{var c=a.datepicker.parseDate("yy-mm-dd",f);return a.datepicker.formatDate(h,c)}}}catch(g){return f}};wundermap.layers.Extremes.getCleanVariable=function(f){var c=wundermap.layers.Extremes.getTableFields();var e=this.getElementsValue("db","radiogroup","ncdc");var d=c[e].dfn;if(d){if(d.wxvar[f].title){return d.wxvar[f].title}else{return d.wxvar[f]}}return f};wundermap.layers.Extremes.getCleanType=function(e,f,h){var c=wundermap.layers.Extremes.getTableFields();var g=this.getElementsValue("db","radiogroup","ncdc");var d=c[g].dfn;if(d.type){return d.type[e]}else{if(this.lastClickedWxvar_){return d.wxvar[this.lastClickedWxvar_].type[e]}}return e};wundermap.layers.Extremes.getCleanRecord=function(d,h){var g=parseFloat(d);if(!isNaN(g)){var f=wundermap.utils;var e=wundermap.options.units;if(h=="prcp"||h=="snow"||h=="prcp_min"){var c=2;if(h.match("snow")){c=1}if(g==-1){return"Trace"}else{return f.convertRainIntoUnitsMM(e,d,c)+" "+f.getRainUnitsMM(e)}}else{var c=0;if(this.key_.match("burt")){c=1}return f.convertTempIntoUnits(e,d,c)+" &deg;"+f.getTempUnits(e)}}else{return"NaN"}};wundermap.layers.Extremes.getTableFields=function(){return{ncdc:{columns:{date:"Date",place:"Location",wxvar:"Variable",record_type:"Type",record:"Record",previous_record:"Prev Record"},sort:[[0,"desc"],[3,"asc"],[4,"asc"],[5,"desc"]],sorttype:[{sType:"us_date"},null,null,null,{sType:"numeric-stripchars"},null],dfn:{type:{alltime:"All-Time Record",monthly:"Monthly Record",daily:"Daily Record"},wxvar:{maxt:"High Maximum Temp",lomx:"Low Maximum Temp",himn:"High Minimum Temp",mint:"Low Minimum Temp",prcp:"Maximum Rainfall",snow:"Maximum Snowfall"}}},burtcity:{columns:{date:"Date",place:"Location",record_type:"Type",record:"Record"},sort:[[0,"desc"]],sorttype:[{sType:"us_date"},null,null,{sType:"numeric-stripchars"}],dfn:{wxvar:{maxt:{title:"High Temp",type:{alltime:"All-Time Warmest Temp",yearly:"All-Time Warmest Summer",monthly:"All-Time Warmest Month"}},mint:{title:"Low Temp",type:{alltime:"All-Time Coldest Temp",yearly:"All-Time Coldest Winter",monthly:"All-Time Coldest Month"}},snow:{title:"Snowfall",type:{alltime:"All-Time Greatest Snow Depth",yearly:"Most Snow in a Season",monthly:"Most Snow in a Month",daily:"Most Snow in 24 Hours",storm:"Most Snow in a Single Storm"}},prcp:{title:"Rainfall",type:{yearly:"Most Rain in a Year",monthly:"Most Rain in a Month",daily:"Most Rain in 24 Hours"}}}}},burtworld:{columns:{date:"Date",place:"Location",country:"Country",continent:"Continent",wxvar:"Variable",record_type:"Type",record:"Record"},sort:[[0,"desc"]],sorttype:[{sType:"us_date"},null,null,null,null,null,{sType:"numeric-stripchars"}],dfn:{type:{alltime:"All-Time Record"},wxvar:{maxt:"High Temp",mint:"Low Temp"}}},defaultlist:{columns:{station_id:"Station Id",date:"Date",record:"Record"},sort:[[1,"desc"]],sorttype:[{sType:"us_date"},null,{sType:"numeric-stripchars"}],dfn:{}}}};wundermap.layers.Extremes.setupDatepickers=function(){var n=this;var d=new Date();var m=new Date();var l=this.options_.startenddatediff||1;m.setDate(d.getDate()-l);if(this.options_.startdate){try{var f=wundermap.utils.cleanDate(this.options_.startdate);m=a.datepicker.parseDate("mm-dd-yy",f)}catch(h){wui.log("Invalid start date "+f+" in query string. Defaulting to "+m.toDateString()+". "+h.toString())}}else{this.options_.startdate=wui.date.strftime("%m-%d-%Y",m)}if(this.options_.enddate){try{var k=wundermap.utils.cleanDate(this.options_.enddate);d=a.datepicker.parseDate("mm-dd-yy",k)}catch(h){wui.log("Invalid end date "+k+" in query string. Defaulting to "+d.toDateString()+". "+h.toString())}}else{this.options_.enddate=wui.date.strftime("%m-%d-%Y",d)}var c=a("#"+this.sidebarPrefix_+"_startdate");var g=a("#"+this.sidebarPrefix_+"_enddate");c.val(a.datepicker.formatDate("mm-dd-yy",m));g.val(a.datepicker.formatDate("mm-dd-yy",d));c.datepicker({minDate:new Date(1800,1,1),maxDate:new Date(),changeMonth:true,changeYear:true,yearRange:"1850:2020",dateFormat:"mm-dd-yy",onChangeMonthYear:function(e,p,o){c.val(a.datepicker.formatDate("mm-dd-yy",new Date(e,p-1,1)))},onClose:function(o,e){n.onChangeDatepicker()}});g.datepicker({defaultDate:null,minDate:new Date(1800,1,1),maxDate:new Date(),changeMonth:true,changeYear:true,yearRange:"1850:2020",dateFormat:"mm-dd-yy",onChangeMonthYear:function(e,p,o){g.val(a.datepicker.formatDate("mm-dd-yy",new Date(e,p-1,1)))},onClose:function(o,e){n.onChangeDatepicker()}})};wundermap.layers.Extremes.getMonthString=function(d){var c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return c[d-1]};wundermap.layers.Extremes.getFilterResultsDefn=function(){return"<div>Try filtering table rows by entering a space separated list of search keys.<br />For example: 'phila trace 2011'. This would display Philadelphia precip records from 2011 where a trace amount of precip was recorded, if any exist in the table.<br />Search terms are case-insensitive.</div>"};wundermap.layers.Tide=new wundermap.Layer();wundermap.layers.Tide.className="Tide";wundermap.layers.Tide.initialize=function(e,c){var d={name:"tide",sidebarPrefix:"LayerTide"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="tide";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.Tide.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.Tide.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.Tide.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.Tide.getDetails=function(f,e){var c=this;var d=this.getDetailsURL(f,e);if(this.debug_>0){wui.log("getDetailsURL: "+d)}setMarineTide(f)};wundermap.layers.Beach=new wundermap.Layer();wundermap.layers.Beach.className="Beach";wundermap.layers.Beach.initialize=function(e,c){var d={name:"beach",sidebarPrefix:"LayerBeach"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="beach";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.Beach.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.Beach.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.Beach.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.Beach.getDetails=function(d,c){setSelectedBeach(d)};wundermap.layers.Marine=new wundermap.Layer();wundermap.layers.Marine.className="Marine";wundermap.layers.Marine.initialize=function(e,c){var d={name:"mar",sidebarPrefix:"LayerMarine"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="marine";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.Marine.getURL=function(h,l,f,k,e,m,c){var g={minlat:f,minlon:k,maxlat:h,maxlon:l,width:e,height:m,proj:"me",extension:(c.isDataURL===true)?"js":"png",key:this.key_};var d="/cgi-bin/ICONBLAST?"+a.param(g);return d};wundermap.layers.Marine.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id="+e;return c};wundermap.layers.Marine.getDetails=function(d,c){setMarineBuoy(d)};wundermap.layers.Marine.getCluster=function(d){var c=this.recallCluster(d);wundermap.zoomTo(c.cluster_point.lat(),c.cluster_point.lng(),wundermap.map.getZoom()+1)};wundermap.layers.ghcn=new wundermap.Layer();wundermap.layers.ghcn.className="ghcn";wundermap.layers.ghcn.initialize=function(e,c){var d={name:"ghcn",sidebarPrefix:"LayerGHCN",mode:"TAVG"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="ghcn";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)});this.setElementsValue("var","radiogroup",this.options_.mode);this.addElementsListeners("var","click")};wundermap.layers.ghcn.getMarkerTitle=function(c){return c.name+" ("+c.id+")"};wundermap.layers.ghcn.getURL=function(k,m,g,l,e,n,c){var f=this.getElementsValue("var","radiogroup","TAVG");if("wxvar" in c){f=c.wxvar}var h={minlat:g,minlon:l,maxlat:k,maxlon:m,width:e,height:n,proj:"me",extension:(c.isDataURL===true)?"js":wundermap.imageFormat,key:this.key_,"filter.wxvar.eq":f};var d="/cgi-bin/ICONBLAST";d+="?"+a.param(h);return d};wundermap.layers.ghcn.getDetailsURL=function(e,d){var c="/cgi-bin/ICONBLAST?key="+this.key_+"&id.id="+e+"&id.wxvar="+this.getElementsValue("var","radiogroup","TAVG");return c};wundermap.layers.ghcn.getBalloonContent=function(d){var c='<div class="GHCNBalloon">';c+='<div class="infobox-title">'+d.name.titlizer()+"</div>";c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Station ID: <span>'+d.id+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(d.start_year){c+='<tr><td class="vaT nobr">Start Year:</td><td class="full">'+d.start_year+"</td></tr>"}if(d.end_year){c+='<tr><td class="vaT nobr">End Year:</td><td class="full">'+d.end_year+"</td></tr>"}c+="</table>";c+="</div>";c+='<div class="contentFooterPad taC brBot5"><a href="/climate/local.html?id='+d.id+"&var="+d.wxvar+'" >View This Station</a></div>';c+="</div>";return c};wundermap.layers.OAR=new wundermap.Layer();wundermap.layers.OAR.className="OAR";wundermap.layers.OAR.initialize=function(e,c){var d={name:"oar",sidebarPrefix:"LayerOAR",refreshTimeout:null,timelord:false};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.key_="oar";this.addImageLayer({fn_getURL:a.proxy(this.getURL,this),fn_getDataURL:a.proxy(this.getURL,this),fn_getImagemapAreas:a.proxy(this.getImagemapAreas,this)})};wundermap.layers.OAR.getMarkerTitle=function(c){return c.name};wundermap.layers.OAR.getBalloonContent=function(d){var c='<div class="OARBalloon">';c+='<div class="infobox-title">'+d.name+"</div>";c+='<table cellspacing="0" cellpadding="0" class="infoTable grey"><tr>';c+='<td class="full">Date: <span>'+d.prettydate+"</span></td>";c+='<td class="vaT nobr dtr">Lat: <span>'+parseFloat(d.lat).toFixed(2)+'</span></td><td class="vaT nobr">Lon: <span>'+parseFloat(d.lon).toFixed(2)+"</span></td></tr></table>";c+='<div class="grt p10">';c+='<table cellspacing="0" cellpadding="0" class="cleanTable full">';if(d.type=="dhl_usa"){c+='<tr><td class="vaT nobr">Location:</td><td class="full">'+d.location+"</td></tr>";c+='<tr><td class="vaT nobr">Distance:</td><td class="full">'+d.distance+" mi.</td></tr>"}else{c+='<tr><td class="vaT nobr">Distance:</td><td class="full">'+d.distance+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Heading:</td><td class="full">'+d.heading+" &deg;</td></tr>";c+='<tr><td class="vaT nobr">Distance from start:</td><td class="full">'+d.distance_from_start+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Distance from finish:</td><td class="full">'+d.distance_from_finish+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Progress total:</td><td class="full">'+d.progress_total+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Progress today:</td><td class="full">'+d.progress_today+" mi.</td></tr>";c+='<tr><td class="vaT nobr">Progress average:</td><td class="full">'+d.progress_average+" mi. per day</td></tr>";c+='<tr><td class="vaT nobr">Days remaining:</td><td class="full">'+d.days_remaining+"</td></tr>"}c+="</table>";c+="</div>";c+='<div class="contentFooterPad taC brBot5">Date: <span>'+d.prettydate+'</span> (<a href="javascript:void(0);" onclick="wundermap.timelord.set('+d.epoch+')">Sync Layers to this Date</a>)</div>';c+="</div>";return c};wundermap.layers.SST=new wundermap.Layer();wundermap.layers.SST.className="SST";wundermap.layers.SST.initialize=function(e,c){var d={title:"Sea Surface Temperature",name:"sst",sidebarPrefix:"LayerSST"};c=a.extend(true,{},d,c);wundermap.Layer.prototype.initialize.call(this,e,c);this.addImageLayer({fn_getURL:a.proxy(this.getURL,this)})};wundermap.layers.SST.getURL=wundermap.layers.Hurricane.getURLSST})(jQuery);